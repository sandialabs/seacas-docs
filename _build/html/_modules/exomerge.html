<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>exomerge &mdash; SEACAS 2023/07/12 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SEACAS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SEACAS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">exomerge</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for exomerge</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Exomerge is a lightweight Python interface for manipulating ExodusII files.</span>

<span class="sd">Copyright(C) 1999-2020, 2022, 2023, 2024 National Technology &amp; Engineering Solutions</span>
<span class="sd">of Sandia, LLC (NTESS).  Under the terms of Contract DE-NA0003525 with</span>
<span class="sd">NTESS, the U.S. Government retains certain rights in this software.</span>

<span class="sd">See packages/seacas/LICENSE for details</span>

<span class="sd">Author: Tim Kostka (tdkostk@sandia.gov)</span>
<span class="sd">Created: May 3, 2012</span>

<span class="sd">Simple example:</span>
<span class="sd">&gt;&gt;&gt; import exomerge</span>
<span class="sd">&gt;&gt;&gt; model = exomerge.import_model(&#39;results.e&#39;)</span>
<span class="sd">&gt;&gt;&gt; model.delete_element_block(1)</span>
<span class="sd">&gt;&gt;&gt; model.export_model(&#39;most_results.e&#39;)</span>

<span class="sd">Documentation can be accessed online through Python&#39;s pydoc utility:</span>
<span class="sd">$ pydoc exomerge</span>
<span class="sd">$ pydoc exomerge.ExodusModel.delete_element_block</span>

<span class="sd">Documentation and sample scripts can be found in the following report.</span>
<span class="sd">&quot;Exomerge User&#39;s Manual: A lightweight Python interface for manipulating</span>
<span class="sd">Exodus files&quot; (SAND2013-0725)</span>

<span class="sd">For additional information or to provide feedback or feature requests, please</span>
<span class="sd">contact the author.</span>

<span class="sd">This is the python-3 version</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># import standard modules</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">import</span> <span class="nn">colorsys</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
        <span class="s2">&quot;Python-3 version. If using python-2, try `import exomerge2 as exomerge`&quot;</span>
    <span class="p">)</span>

<span class="c1"># import exodus module</span>
<span class="c1"># (exodus.py should be in the same directory as this file)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">exodus</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">exodus3</span> <span class="k">as</span> <span class="nn">exodus</span>

<span class="c1"># informal version number of this module</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;8.6.1&quot;</span>
<span class="n">VERSION</span> <span class="o">=</span> <span class="n">__version__</span>

<span class="c1"># contact person for issues</span>
<span class="n">CONTACT</span> <span class="o">=</span> <span class="s2">&quot;Tim Kostka &lt;tdkostk@sandia.gov&gt;&quot;</span>

<span class="c1"># show the banner on first use</span>
<span class="n">SHOW_BANNER</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># if true, will crash if warnings are generated</span>
<span class="n">EXIT_ON_WARNING</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># if true, will suppress output from exodus.py</span>
<span class="c1"># this will not suppress the banner output</span>
<span class="n">SUPPRESS_EXODUS_OUTPUT</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># a list of deprecated or renamed functions</span>
<span class="c1"># When the user calls one of these, it will issue a warning message</span>
<span class="c1"># saying it is deprecated.  If it has simply been renamed, we will call that</span>
<span class="c1"># function.  If it has been deleted, we will error out.</span>
<span class="c1"># This is a dict where the key is the deprecated function name and the value</span>
<span class="c1"># is the renamed function, or None.</span>
<span class="c1"># e.g. DEPRECATED_FUNCTIONS[&#39;build_hex8_cube&#39;] = &#39;create_hex8_cube&#39;</span>
<span class="n">DEPRECATED_FUNCTIONS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">DEPRECATED_FUNCTIONS</span><span class="p">[</span><span class="s2">&quot;write&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;export&quot;</span>


<div class="viewcode-block" id="DummyFile"><a class="viewcode-back" href="../exomerge.html#exomerge.DummyFile">[docs]</a><span class="k">class</span> <span class="nc">DummyFile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dummy class used to suppress output to stdout.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DummyFile.write"><a class="viewcode-back" href="../exomerge.html#exomerge.DummyFile.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ignore the write command.&quot;&quot;&quot;</span></div></div>


<div class="viewcode-block" id="import_model"><a class="viewcode-back" href="../exomerge.html#exomerge.import_model">[docs]</a><span class="k">def</span> <span class="nf">import_model</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load information from an ExodusII file.</span>

<span class="sd">    This function is a wrapper around &#39;ExodusModel.import_model(...)&#39; and is</span>
<span class="sd">    provided for convenience.  Internally, this is equivalent to executing the</span>
<span class="sd">    following two statements.</span>

<span class="sd">    &gt;&gt;&gt; model = ExodusModel()</span>
<span class="sd">    &gt;&gt;&gt; model.import_model(...)</span>

<span class="sd">    See &#39;ExodusModel.import_model&#39; for additional information.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ExodusModel</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">import_model</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span></div>


<div class="viewcode-block" id="ExodusModel"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel">[docs]</a><span class="k">class</span> <span class="nc">ExodusModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class holds all information stored within an ExodusII file.&quot;&quot;&quot;</span>

    <span class="c1"># define translation from two faces to a 3D cohesive element</span>
    <span class="n">COHESIVE_FORMULA</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">COHESIVE_FORMULA</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>
    <span class="n">COHESIVE_FORMULA</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
    <span class="n">COHESIVE_FORMULA</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>

    <span class="c1"># define calculation for element length/area/volume</span>
    <span class="n">VOLUME_FORMULA</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;line2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;line3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;line2&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;quad6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;quad8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;tet10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mf">0.5</span><span class="p">,</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mf">1.0</span><span class="p">,</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;hex20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span>

    <span class="c1"># define mapping of the external faces of an element</span>
    <span class="n">FACE_MAPPING</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;hex20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">13</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">14</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;tet10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;quad6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;quad8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">11</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;tri6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;quad6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;quad8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;line3&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;line2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">0</span><span class="p">])),</span> <span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">]))]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;line3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;line2&quot;</span><span class="p">]</span>
    <span class="n">FACE_MAPPING</span><span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># define all standard element types</span>
    <span class="n">STANDARD_ELEMENT_TYPES</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">FACE_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># define a connectivity permutation which inverts the element</span>
    <span class="c1"># for 2d elements, this flips the element normal</span>
    <span class="c1"># for 1d elements, this changes the direction</span>
    <span class="n">INVERTED_CONNECTIVITY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;hex20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">16</span><span class="p">,</span>
        <span class="mi">17</span><span class="p">,</span>
        <span class="mi">18</span><span class="p">,</span>
        <span class="mi">19</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">,</span>
        <span class="mi">11</span><span class="p">,</span>
        <span class="mi">12</span><span class="p">,</span>
        <span class="mi">13</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">,</span>
        <span class="mi">15</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;tet10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">12</span><span class="p">,</span>
        <span class="mi">13</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">,</span>
        <span class="mi">11</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">12</span><span class="p">,</span>
        <span class="mi">13</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">,</span>
        <span class="mi">11</span><span class="p">,</span>
        <span class="mi">15</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;quad6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;quad8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;line2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;line3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># define a connectivity permutation which rotates the given 2d face</span>
    <span class="n">ROTATED_CONNECTIVITY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ROTATED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ROTATED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;quad8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">ROTATED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ROTATED_CONNECTIVITY</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># define the topological dimension of each element</span>
    <span class="n">DIMENSION</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;line2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;line3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;quad6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;quad8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;hex20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;tet10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">DIMENSION</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># define the number of nodes per element</span>
    <span class="n">NODES_PER_ELEMENT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">INVERTED_CONNECTIVITY</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="p">)</span>

    <span class="c1"># define how to triangulate faces of 3D elements</span>
    <span class="n">TRIANGULATED_FACES</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">TRIANGULATED_FACES</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">TRIANGULATED_FACES</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
    <span class="n">TRIANGULATED_FACES</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">TRIANGULATED_FACES</span><span class="p">[</span><span class="s2">&quot;quad6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">TRIANGULATED_FACES</span><span class="p">[</span><span class="s2">&quot;quad8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
        <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
    <span class="p">]</span>

    <span class="c1"># define formulas for converting between element types</span>
    <span class="n">ELEMENT_CONVERSIONS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">][</span><span class="s2">&quot;hex20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;hex20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;hex20&quot;</span><span class="p">][</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">))]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">][</span><span class="s2">&quot;tet10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="p">]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;tet10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;tet10&quot;</span><span class="p">][</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">][</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">][</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">][</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">][</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">][</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">][</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
    <span class="p">]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">][</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))]</span>
    <span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">][</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">))]</span>

    <span class="c1"># define the order of each element</span>
    <span class="n">ELEMENT_ORDER</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;hex20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;tet4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;tet10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;wedge6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;wedge12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;wedge15&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;wedge16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;tri6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;quad4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;quad6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;quad8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;line2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;line3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># define components of multi-component fields</span>
    <span class="n">MULTI_COMPONENT_FIELD_SUBSCRIPTS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">MULTI_COMPONENT_FIELD_SUBSCRIPTS</span><span class="p">[</span><span class="s2">&quot;vector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
    <span class="n">MULTI_COMPONENT_FIELD_SUBSCRIPTS</span><span class="p">[</span><span class="s2">&quot;symmetric_3x3_tensor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;xx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;zz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;zx&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">MULTI_COMPONENT_FIELD_SUBSCRIPTS</span><span class="p">[</span><span class="s2">&quot;full_3x3_tensor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;xx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;zz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;zx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;zy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xz&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ALL_MULTI_COMPONENT_FIELD_SUBSCRIPTS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">MULTI_COMPONENT_FIELD_SUBSCRIPTS</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model.&quot;&quot;&quot;</span>
        <span class="c1"># (only) the first time this module is used, show an info banner</span>
        <span class="k">global</span> <span class="n">SHOW_BANNER</span>
        <span class="k">if</span> <span class="n">SHOW_BANNER</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">You are using Exomerge v</span><span class="si">%s</span><span class="s2"> -- A lightweight Python &quot;</span>
                    <span class="s2">&quot;interface for manipulating</span><span class="se">\n</span><span class="s2">ExodusII files. (Python-3 version)&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">VERSION</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># print out the exodus banner after formatting it to fit within</span>
            <span class="c1"># 79 characters</span>
            <span class="n">exodus_text</span> <span class="o">=</span> <span class="n">exodus</span><span class="o">.</span><span class="n">EXODUS_PY_COPYRIGHT</span>
            <span class="n">exodus_text</span> <span class="o">=</span> <span class="n">exodus_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">exodus_text</span> <span class="o">=</span> <span class="n">exodus_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;. &quot;</span><span class="p">,</span> <span class="s2">&quot;.  &quot;</span><span class="p">)</span>
            <span class="n">exodus_text</span> <span class="o">=</span> <span class="n">exodus_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.   &quot;</span><span class="p">,</span> <span class="s2">&quot;.  &quot;</span><span class="p">)</span>
            <span class="n">exodus_text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">exodus_text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">79</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">exodus_text</span><span class="p">))</span>
            <span class="n">SHOW_BANNER</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># list of [x, y, z] coordinates for each node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># self.node_fields[name] = values</span>
        <span class="c1"># with values[timestep_index][node_index]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># self.global_variables[name] = values</span>
        <span class="c1"># with values[timestep_index]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># self.element_blocks[id] = [name, info, connectivity, fields]</span>
        <span class="c1"># with name = string name of element block or &#39;&#39; if unnamed</span>
        <span class="c1"># with info = [&#39;hex8&#39;, elements, 8, 0]</span>
        <span class="c1"># with connectivity a shallow list of connectivity</span>
        <span class="c1"># with fields[&#39;eqps&#39;] = values</span>
        <span class="c1"># with values[timestep][local_element_index]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># self.side_sets[side_set_id] = [name, members, fields]</span>
        <span class="c1"># with name = string name of side set or &#39;&#39; if unnamed</span>
        <span class="c1"># with members = list of (element_block_id, element_index, side_index)</span>
        <span class="c1"># with fields[name] = values</span>
        <span class="c1"># with values[timestep_index][local_member_index]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># self.node_sets[node_set_id] = [name, members, fields]</span>
        <span class="c1"># with name = string name of node set or &#39;&#39; if unnamed</span>
        <span class="c1"># with members = list of node indices</span>
        <span class="c1"># with fields[name] = values</span>
        <span class="c1"># with values[timestep_index][local_member_index]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># list of timesteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of info records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of qa records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># title of the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ExodusModel.__getattr__"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.__getattr__">[docs]</a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to find the given attribute.</span>

<span class="sd">        This is a special Python method which gets called if the attribute</span>
<span class="sd">        cannot be found.  We use to to suggest similar names in the case the</span>
<span class="sd">        user made a typo.</span>

<span class="sd">        We also use this to alias the plural forms of the delete functions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># for special methods, use default behavior</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span>
        <span class="c1"># get non-special function names</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]</span>
        <span class="c1"># if the name appears to be singular, search for the plural version</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
            <span class="n">trial</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
            <span class="k">if</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">)</span>
        <span class="c1"># if the name appears to be plural, search for the singular version</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
            <span class="n">trial</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">trial</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">)</span>
        <span class="c1"># we can&#39;t find the name, so find names close to it to offer as</span>
        <span class="c1"># suggestions</span>
        <span class="c1"># filter names by closeness</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">ratio</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
        <span class="n">sorted_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">iter</span><span class="p">(</span><span class="n">names</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="c1"># get the closest 5 matching function names</span>
        <span class="n">closest_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sorted_names</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]]</span>
        <span class="c1"># in an interactive shell, just issue a warning, else</span>
        <span class="c1"># issue an error an exit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_interactive</span><span class="p">():</span>
            <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error</span>
        <span class="n">call</span><span class="p">(</span>
            <span class="s2">&quot;Function not found.&quot;</span><span class="p">,</span>
            <span class="s1">&#39;The function &quot;</span><span class="si">%s</span><span class="s1">&quot; does not exist.  Perhaps you meant to &#39;</span>
            <span class="s2">&quot;call one of the following functions:</span><span class="se">\n\n</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">closest_names</span><span class="p">)),</span>
        <span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_interactive</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if we&#39;re in an interactive shell.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">__main__</span> <span class="k">as</span> <span class="nn">main</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="s2">&quot;__file__&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="n">condition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise a &#39;ValueError&#39; if the given condition is not true.</span>

<span class="sd">        Unlike the assert builtin function, this checks the condition</span>
<span class="sd">        regardless of the state of &#39;__debug__&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">condition</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cubic_interpolation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return proportions using the cubic interpolation formula.</span>

<span class="sd">        Find the proportions of &#39;y0&#39;, &#39;y1&#39;, &#39;y2&#39;, &#39;y3&#39; to take to find &#39;y(x)&#39;</span>
<span class="sd">        for &#39;x1 &lt;= x &lt;= x2&#39;.  This requires &#39;x0 &lt; x1 &lt; x2 &lt; x3&#39;.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._cubic_interpolation(1.71, 0.0, 1.0, 2.0, 3.0)</span>
<span class="sd">        [-0.0298555, 0.2766165, 0.8263335, -0.0730945]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">x0</span> <span class="o">&lt;</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="n">x2</span> <span class="o">&lt;</span> <span class="n">x3</span>
        <span class="k">assert</span> <span class="n">x1</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x2</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># proportion of y0</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="c1"># proportion of y1</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x2</span><span class="p">))</span>
                        <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x3</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x3</span>
                        <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x3</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x3</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># proportion of y2</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="n">x0</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">))</span> <span class="o">+</span> <span class="n">x0</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x2</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># proportion of y3</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">_new_element_block_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an element block id which is not used in the model.&quot;&quot;&quot;</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_block_exists</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
            <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">id_</span>

    <span class="k">def</span> <span class="nf">_new_side_set_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a side set id which is not used in the model.&quot;&quot;&quot;</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_exists</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
            <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">id_</span>

    <span class="k">def</span> <span class="nf">_new_node_set_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a node set id which is not used in the model.&quot;&quot;&quot;</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set_exists</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
            <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">id_</span>

    <span class="k">def</span> <span class="nf">_new_element_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an element field name which is not used in the model.</span>

<span class="sd">        If &#39;quantity=1&#39;, this will return a single string.  Else, it will</span>
<span class="sd">        return a list of strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">quantity</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
            <span class="k">while</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">():</span>
                <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">names</span>

    <span class="k">def</span> <span class="nf">_new_node_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a node field name which is not used in the model.&quot;&quot;&quot;</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
        <span class="k">while</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">():</span>
            <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">_new_side_set_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a side set field name which is not used in the model.&quot;&quot;&quot;</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
        <span class="k">while</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">():</span>
            <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">_new_node_set_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a node set field name which is not used in the model.&quot;&quot;&quot;</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
        <span class="k">while</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">():</span>
            <span class="n">id_</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;temp</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">_delete_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">element_indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the specified elements from the given element block.</span>

<span class="sd">        This will also delete all references to those elements in element</span>
<span class="sd">        fields, side sets, and side set fields.  This will also delete nodes</span>
<span class="sd">        which were used by those elements which are no longer used.</span>

<span class="sd">        Element indices are local to that element block.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># validate input</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span><span class="p">(</span><span class="n">element_indices</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span>
        <span class="c1"># get element block information</span>
        <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="c1"># if not deleting any indices, we&#39;re done</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">element_indices</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># error if values are outside valid range</span>
        <span class="n">max_element_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">element_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_element_index</span> <span class="o">&gt;=</span> <span class="n">element_count</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid element indices&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The element index list contains invalid entries.  &quot;</span>
                <span class="s2">&quot;There are only </span><span class="si">%d</span><span class="s2"> elements in this element block and &quot;</span>
                <span class="s2">&quot;the list contains a reference to index </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_element_index</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="c1"># select valid elements</span>
        <span class="n">indices_to_delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">invalid_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">duplicate_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">element_count</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices_to_delete</span><span class="p">:</span>
                    <span class="n">indices_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">duplicate_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">invalid_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># warn about duplicate indices</span>
        <span class="k">if</span> <span class="n">duplicate_indices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicate element indices&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The element index list contains duplicate &quot;</span>
                <span class="s2">&quot;indices.  Elements can only be deleted once so &quot;</span>
                <span class="s2">&quot;duplicates will be ignored.  There were </span><span class="si">%d</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;duplicates.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicate_indices</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="k">del</span> <span class="n">duplicate_indices</span>
        <span class="c1"># error if invalid indices encountered</span>
        <span class="k">if</span> <span class="n">invalid_indices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid element indices&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The element index list contains invalid entries.  &quot;</span>
                <span class="s2">&quot;There were a total of </span><span class="si">%d</span><span class="s2"> invalid indices.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_indices</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">del</span> <span class="n">invalid_indices</span>
        <span class="c1"># create list of nodes used by elements to delete</span>
        <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">used_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="n">indices_to_delete</span><span class="p">:</span>
            <span class="n">used_nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="n">used_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">used_nodes</span><span class="p">)</span>
        <span class="c1"># remove references to these elements within each side set</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="c1"># look for members to delete</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">members_to_delete</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">members</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">element_block_id</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">indices_to_delete</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># delete those members (if any exist)</span>
            <span class="k">if</span> <span class="n">members_to_delete</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">members_to_delete</span><span class="p">)</span>
        <span class="c1"># create translation list</span>
        <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">remaining_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">indices_to_delete</span><span class="p">))</span>
        <span class="c1"># create element map</span>
        <span class="c1"># old element i is new element new_index[i]</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="n">element_count</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">remaining_indices</span><span class="p">):</span>
            <span class="n">new_index</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="c1"># delete elements from element fields</span>
        <span class="k">del</span> <span class="n">indices_to_delete</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">this_field</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">this_field</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">remaining_indices</span><span class="p">]</span> <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">this_field</span>
            <span class="p">]</span>
        <span class="c1"># delete elements from the block</span>
        <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="n">remaining_indices</span><span class="p">:</span>
            <span class="n">new_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="c1"># set the new connectivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">new_connectivity</span>
        <span class="c1"># set the number of elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_indices</span><span class="p">)</span>
        <span class="c1"># change side set element numbering</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">new_members</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">element_block_id</span><span class="p">:</span>
                    <span class="n">new_members</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_index</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">member</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
            <span class="n">members</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">new_members</span>
        <span class="c1"># make sure we didn&#39;t mess anything up</span>
        <span class="c1"># find nodes which are not used by any element</span>
        <span class="n">abandoned_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_unreferenced_nodes</span><span class="p">())</span>
        <span class="c1"># find nodes to delete</span>
        <span class="n">nodes_to_delete</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">abandoned_nodes</span> <span class="o">&amp;</span> <span class="n">used_nodes</span><span class="p">)</span>
        <span class="c1"># delete those nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_nodes</span><span class="p">(</span><span class="n">nodes_to_delete</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.threshold_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.threshold_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">threshold_element_blocks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">expression</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">,</span>
        <span class="n">new_element_block_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete elements which do not satisfy a condition.</span>

<span class="sd">        The expression can contain element field values.</span>

<span class="sd">        If &#39;new_element_block_id&#39; is given, all elements which don&#39;t pass</span>
<span class="sd">        the threshold will be moved into that element block.  Else, they are</span>
<span class="sd">        deleted.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.threshold_element_block(&#39;all&#39;, &#39;eqps &gt;= 0.01&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">new_element_block_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_block_exists</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_error</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">,</span> <span class="s2">&quot;element block&quot;</span><span class="p">)</span>
        <span class="c1"># create a temporary field name on these elements</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_field_name</span><span class="p">()</span>
        <span class="c1"># evaluate the expression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_element_field</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">),</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="n">element_block_ids</span>
        <span class="p">)</span>
        <span class="c1"># go through each element block and delete elements</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_values</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="o">=</span><span class="n">id_</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span>
            <span class="p">)</span>
            <span class="c1"># if we&#39;re saving elements, duplicate the block, and delete the</span>
            <span class="c1"># ones we&#39;re keeping</span>
            <span class="k">if</span> <span class="n">new_element_block_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">indices_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
                <span class="n">temporary_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_element_block</span><span class="p">(</span>
                    <span class="n">id_</span><span class="p">,</span> <span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">duplicate_nodes</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_elements</span><span class="p">(</span><span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">indices_to_keep</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temporary_element_block_id</span> <span class="o">!=</span> <span class="n">new_element_block_id</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_block_exists</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">combine_element_blocks</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">new_element_block_id</span><span class="p">],</span>
                            <span class="n">new_element_block_id</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_block</span><span class="p">(</span>
                            <span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">new_element_block_id</span>
                        <span class="p">)</span>
            <span class="c1"># delete elements which don&#39;t meet the threshold</span>
            <span class="n">indices_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_elements</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">indices_to_delete</span><span class="p">)</span>
        <span class="c1"># delete the temporary element field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_element_block_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="n">new_element_block_id</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_list_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of list ids found within a variable.</span>

<span class="sd">        This handles lists, dictionaries, and nested combinations of these.</span>
<span class="sd">        Other objects are ignored.</span>

<span class="sd">        This method is used to check aliasing of lists.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">thing</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">other_thing</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_list_ids</span><span class="p">(</span><span class="n">other_thing</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">ids</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">other_thing</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_list_ids</span><span class="p">(</span><span class="n">other_thing</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">def</span> <span class="nf">_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_aliased_lists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify model information is valid and arrays are appropriately sized.</span>

<span class="sd">        If there is a problem somewhere, this method will throw an error</span>
<span class="sd">        message and exit.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestep_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># verify self.node_fields</span>
            <span class="n">node_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">timestep_count</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">node_count</span><span class="p">)</span>
            <span class="c1"># verify self.element_blocks</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">connectivity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">node_count</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">timestep_count</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># verify self.node_sets</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">members</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">members</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">members</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">node_count</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">timestep_count</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">member_count</span><span class="p">)</span>
            <span class="c1"># verify self.side_sets</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">members</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">members</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="n">element_index</span> <span class="o">&lt;</span> <span class="n">element_count</span><span class="p">[</span><span class="n">id_</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">timestep_count</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">member_count</span><span class="p">)</span>
            <span class="c1"># verify self.global_variables</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">timestep_count</span><span class="p">)</span>
            <span class="c1"># optionally verify that no lists are aliases of one another</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_aliased_lists</span><span class="p">:</span>
                <span class="c1"># hold list ids for later use</span>
                <span class="n">list_ids</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                        <span class="n">list_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_list_ids</span><span class="p">(</span><span class="n">thing</span><span class="p">))</span>
                <span class="c1"># ensure none are copies</span>
                <span class="n">unique_list_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">list_ids</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_list_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_ids</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># get the code line the assertion failed on</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="n">error_line</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">extract_tb</span><span class="p">(</span><span class="n">trace</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">error_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;self._assert(&quot;</span><span class="p">):</span>
                <span class="n">error_line</span> <span class="o">=</span> <span class="n">error_line</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">error_line_number</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">extract_tb</span><span class="p">(</span><span class="n">trace</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># write out the error/warning message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Corrupted database information.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The finite element model information failed a validity &quot;</span>
                <span class="s2">&quot;check.  The following assertion failed:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">] </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;This resulted from one of the two scenarios:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;* You changed information in the database &quot;</span>
                <span class="s2">&quot;inconsistently.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;* There is a bug within the code.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;If you believe it is the latter, please contact support &quot;</span>
                <span class="s2">&quot;with as much information as necessary.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;* Support contact: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_line_number</span><span class="p">,</span> <span class="n">error_line</span><span class="p">,</span> <span class="n">CONTACT</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_print_message</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">79</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print out a nicely formatted message which fits in a specified width.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; exomerge.ExodusModel._print_message(</span>
<span class="sd">        ...     [(&quot;ERROR: &quot;, &quot;I&#39;m sorry, Dave&quot;),</span>
<span class="sd">        ...      (&quot;Message: &quot;, &quot;I&#39;m afraid I can&#39;t let you do that.&quot;)],</span>
<span class="sd">        ...     width=30)</span>

<span class="sd">        ***********************************</span>
<span class="sd">        *                                 *</span>
<span class="sd">        *  ERROR: I&#39;m sorry, Dave.        *</span>
<span class="sd">        *                                 *</span>
<span class="sd">        *  Message: I&#39;m afraid I can&#39;t    *</span>
<span class="sd">        *           let you do that.      *</span>
<span class="sd">        *                                 *</span>
<span class="sd">        ***********************************</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># format messages</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">messages</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">messages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="c1"># store the message width</span>
        <span class="n">max_header_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">max_header_width</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span>
        <span class="c1"># print the top frame after a blank line</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span><span class="p">))</span>
        <span class="c1"># process each message</span>
        <span class="c1"># *  Header: Text             *</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># format text into broken lines</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">message</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># remove trailing newlines</span>
            <span class="k">while</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># break into a list</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># process each line</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">),</span> <span class="n">txt</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;*  </span><span class="si">%s</span><span class="s2">  *&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span><span class="p">))</span>
        <span class="c1"># print the bottom frame</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_trace</span><span class="p">(</span><span class="n">omitted_frames</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a compressed stack trace.&quot;&quot;&quot;</span>
        <span class="n">last_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="n">omitted_frames</span><span class="p">:]:</span>
            <span class="n">this_file</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">this_file</span> <span class="o">!=</span> <span class="n">last_file</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="n">this_file</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
                <span class="n">last_file</span> <span class="o">=</span> <span class="n">this_file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_file</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="n">frame</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">_bug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="s2">&quot;Possible bug&quot;</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">exit_code</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print out an error message possibly caused by a bug and exit.</span>

<span class="sd">        As opposed to the _error function, this also outputs support contact</span>
<span class="sd">        information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;  ERROR: &quot;</span><span class="p">,</span> <span class="n">short</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">detailed</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Message: &quot;</span><span class="p">,</span> <span class="n">detailed</span><span class="p">))</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;Support: &quot;</span><span class="p">,</span>
                <span class="s2">&quot;This error may have been caused by a bug in the &quot;</span>
                <span class="s2">&quot;code.  If you believe this is the case, please &quot;</span>
                <span class="s2">&quot;contact support and provide enough information &quot;</span>
                <span class="s2">&quot;to duplicate the issue.</span><span class="se">\n\n</span><span class="s2">Support contact: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">CONTACT</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;  Trace: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trace</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">exit_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="s2">&quot;Unspecified error&quot;</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">exit_code</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out an error message and exit.&quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;  ERROR: &quot;</span><span class="p">,</span> <span class="n">short</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">detailed</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Message: &quot;</span><span class="p">,</span> <span class="n">detailed</span><span class="p">))</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;  Trace: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trace</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">exit_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="s2">&quot;Unspecified warning&quot;</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out a warning message, but don&#39;t exit.&quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;WARNING: &quot;</span><span class="p">,</span> <span class="n">short</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">detailed</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Message: &quot;</span><span class="p">,</span> <span class="n">detailed</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">EXIT_ON_WARNING</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;  Trace: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trace</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">EXIT_ON_WARNING</span><span class="p">:</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_qa_record</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new qa record for this program.</span>

<span class="sd">        QA records are stored within the ExodusII file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;exomerge&quot;</span><span class="p">,</span> <span class="n">VERSION</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ensure_acceptable_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">this_id</span><span class="p">,</span> <span class="n">acceptable_ids</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure ID is acceptable, or error out.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">this_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">acceptable_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entity</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span><span class="s2">&quot;Reference to undefined entity.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">id_list</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">acceptable_ids</span><span class="p">])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Reference to undefined </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">),</span>
                    <span class="s1">&#39;A reference to </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; was encountered but is &#39;</span>
                    <span class="s2">&quot;not defined.  There are </span><span class="si">%d</span><span class="s2"> defined </span><span class="si">%s</span><span class="s2">s: </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">this_id</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">),</span> <span class="n">entity</span><span class="p">,</span> <span class="n">id_list</span><span class="p">),</span>
                <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_matching_strings</span><span class="p">(</span><span class="n">string_pattern</span><span class="p">,</span> <span class="n">list_of_strings</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of string which match the pattern.</span>

<span class="sd">        The pattern can contain a single wildcard character (*) which</span>
<span class="sd">        represents any number of characters.  No other special regex</span>
<span class="sd">        characters are allowed.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._get_matching_strings(&#39;f*x&#39;,</span>
<span class="sd">        ...                             [&#39;fox&#39;, &#39;faux&#39;, &#39;far&#39;, &#39;fx&#39;, &#39;foxes&#39;])</span>
<span class="sd">        [&#39;fox&#39;, &#39;faux&#39;, &#39;fx&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># convert pattern to a regex expression</span>
        <span class="n">regex_pattern</span> <span class="o">=</span> <span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="n">string_pattern</span> <span class="o">+</span> <span class="s2">&quot;$&quot;</span>
        <span class="n">regex_pattern</span> <span class="o">=</span> <span class="n">regex_pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_strings</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_pattern</span><span class="p">,</span> <span class="n">x</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_plural</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the likely plural form of the given word.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._plural(&#39;rose&#39;)</span>
<span class="sd">        roses</span>
<span class="sd">        &gt;&gt;&gt; model._plural(&#39;bunny&#39;)</span>
<span class="sd">        bunnies</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;ies&quot;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>

    <span class="k">def</span> <span class="nf">_format_element_block_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a validated list of element block IDs.&quot;&quot;&quot;</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="s2">&quot;element block&quot;</span>
        <span class="c1"># get element block translations</span>
        <span class="n">tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># ensure element block names are unique</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicate </span><span class="si">%s</span><span class="s2"> names&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                <span class="s2">&quot;At least two </span><span class="si">%s</span><span class="s2"> have the same name.  &quot;</span>
                <span class="s2">&quot;This may cause problems.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plural</span><span class="p">(</span><span class="n">entity</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">id_list</span><span class="p">,</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">translator</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">tuples</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_side_set_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a validated list of side set IDs.&quot;&quot;&quot;</span>
        <span class="n">ssets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="s2">&quot;side set&quot;</span>
        <span class="c1"># get element block translations</span>
        <span class="n">tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ssets</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># ensure element block names are unique</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicate </span><span class="si">%s</span><span class="s2"> names&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                <span class="s2">&quot;At least two </span><span class="si">%s</span><span class="s2"> have the same name.  &quot;</span>
                <span class="s2">&quot;This may cause problems.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plural</span><span class="p">(</span><span class="n">entity</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">id_list</span><span class="p">,</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">ssets</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">translator</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">tuples</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_node_set_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a validated list of node set IDs.&quot;&quot;&quot;</span>
        <span class="n">nsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="s2">&quot;node set&quot;</span>
        <span class="c1"># get element block translations</span>
        <span class="n">tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nsets</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># ensure element block names are unique</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicate </span><span class="si">%s</span><span class="s2"> names&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                <span class="s2">&quot;At least two </span><span class="si">%s</span><span class="s2"> have the same name.  &quot;</span>
                <span class="s2">&quot;This may cause problems.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plural</span><span class="p">(</span><span class="n">entity</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">id_list</span><span class="p">,</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">nsets</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">translator</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">tuples</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_id_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">id_list</span><span class="p">,</span>
        <span class="n">acceptable_ids</span><span class="p">,</span>
        <span class="n">entity</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">single</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">translator</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a validated list of IDs.</span>

<span class="sd">        If &#39;single&#39; is &#39;True&#39;, this will error out if zero or more than one id</span>
<span class="sd">        is returned.</span>

<span class="sd">        If &#39;empty_list_okay=False&#39;, this will error out if the list is</span>
<span class="sd">        empty.</span>

<span class="sd">        If &#39;translator&#39; is given, it must be a dictionary which converts</span>
<span class="sd">        strings to ids.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">id_</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="n">new_id_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">id_</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">acceptable_ids</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                        <span class="s2">&quot;Empty entity list.&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;The &quot;first&quot; identifier was used to refer to a </span><span class="si">%s</span><span class="s1"> &#39;</span>
                        <span class="s2">&quot;but no </span><span class="si">%s</span><span class="s2">s exist.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="n">new_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">id_</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">acceptable_ids</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                        <span class="s2">&quot;Empty entity list.&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;The &quot;last&quot; identifier was used to refer to a </span><span class="si">%s</span><span class="s1"> &#39;</span>
                        <span class="s2">&quot;but no </span><span class="si">%s</span><span class="s2">s exist.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="n">new_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">id_</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                        <span class="s2">&quot;Ambiguous reference.&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;The &quot;auto&quot; identifier was used to refer to a </span><span class="si">%s</span><span class="s1"> &#39;</span>
                        <span class="s2">&quot;but exactly one </span><span class="si">%s</span><span class="s2"> does not exist.  There are </span><span class="si">%d</span><span class="s2"> &quot;</span>
                        <span class="s2">&quot;defined </span><span class="si">%s</span><span class="s2">s.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">),</span> <span class="n">entity</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="n">new_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">id_</span> <span class="o">==</span> <span class="s2">&quot;last_if_any&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">acceptable_ids</span><span class="p">:</span>
                    <span class="n">new_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">id_</span> <span class="o">==</span> <span class="s2">&quot;first_if_any&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">acceptable_ids</span><span class="p">:</span>
                    <span class="n">new_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
        <span class="n">id_list</span> <span class="o">=</span> <span class="n">new_id_list</span>
        <span class="c1"># now apply the translation list</span>
        <span class="k">if</span> <span class="n">translator</span><span class="p">:</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">translator</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">translator</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">]</span>
        <span class="c1"># for ids with a wildcard, find all that match</span>
        <span class="k">if</span> <span class="n">id_list</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">))):</span>
                <span class="n">this_id</span> <span class="o">=</span> <span class="n">id_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">this_id</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">id_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">new_id</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_matching_strings</span><span class="p">(</span><span class="n">this_id</span><span class="p">,</span> <span class="n">acceptable_ids</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">id_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">new_id</span><span class="p">)</span>
        <span class="c1"># do not allow duplicates</span>
        <span class="c1"># and ensure all given ids are valid</span>
        <span class="n">found</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">unique_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">acceptable_ids</span><span class="p">:</span>
                    <span class="n">unique_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">id_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">acceptable_ids</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                        <span class="s2">&quot;Reference to undefined </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">),</span>
                        <span class="s1">&#39;A reference to </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; was encountered but is &#39;</span>
                        <span class="s2">&quot;not defined.  This </span><span class="si">%s</span><span class="s2"> will not be included in the &quot;</span>
                        <span class="s2">&quot;operation.</span><span class="se">\n\n</span><span class="s2">There are </span><span class="si">%d</span><span class="s2"> defined </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="n">entity</span><span class="p">,</span>
                            <span class="n">id_</span><span class="p">,</span>
                            <span class="n">entity</span><span class="p">,</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_plural</span><span class="p">(</span><span class="n">entity</span><span class="p">),</span>
                            <span class="n">id_list</span><span class="p">,</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
        <span class="c1"># return the unique list</span>
        <span class="n">id_list</span> <span class="o">=</span> <span class="n">unique_ids</span>
        <span class="c1"># if only a single item was requested, ensure it exists</span>
        <span class="k">if</span> <span class="n">single</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">id_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;No </span><span class="si">%s</span><span class="s2"> specified.&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                    <span class="s2">&quot;A single </span><span class="si">%s</span><span class="s2"> is required but none &quot;</span> <span class="s2">&quot;were specified.&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Multiple </span><span class="si">%s</span><span class="s2">s specified.&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                <span class="s2">&quot;A single </span><span class="si">%s</span><span class="s2"> is required but </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">s were specified: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">),</span> <span class="n">entity</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">])),</span>
            <span class="p">)</span>
        <span class="c1"># if list is empty and that&#39;s a problem, error out</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">empty_list_okay</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;No </span><span class="si">%s</span><span class="s2">s specified.&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                <span class="s2">&quot;We require at least one </span><span class="si">%s</span><span class="s2"> to be specified for this &quot;</span>
                <span class="s2">&quot;operation but none were specified.</span><span class="se">\n\n</span><span class="s2">There are </span><span class="si">%d</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;defined </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">entity</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">acceptable_ids</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_plural</span><span class="p">(</span><span class="n">entity</span><span class="p">),</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">acceptable_ids</span><span class="p">]),</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">id_list</span>

    <span class="k">def</span> <span class="nf">_get_standard_element_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a standardized string for the given element type.</span>

<span class="sd">        Within an ExodusII file, the element type is stored as a string.</span>
<span class="sd">        Because of this, there is no standardized way to store this field</span>
<span class="sd">        and different codes can and do use different strings for the same</span>
<span class="sd">        element type.  This translation function interprets this field and</span>
<span class="sd">        returns a standardized name if possible.</span>

<span class="sd">        If an element type is not recognized and &#39;warning=True&#39;, a warning</span>
<span class="sd">        message will be issued.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._get_standard_element_type(&#39;HEX&#39;)</span>
<span class="sd">        &#39;hex8&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element_type</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="n">element_type</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="n">element_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">translation_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hex&quot;</span><span class="p">:</span> <span class="s2">&quot;hex8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tet&quot;</span><span class="p">:</span> <span class="s2">&quot;tet4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tetra&quot;</span><span class="p">:</span> <span class="s2">&quot;tet4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tetra10&quot;</span><span class="p">:</span> <span class="s2">&quot;tet10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tri&quot;</span><span class="p">:</span> <span class="s2">&quot;tri3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;triangle&quot;</span><span class="p">:</span> <span class="s2">&quot;tri3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;quad&quot;</span><span class="p">:</span> <span class="s2">&quot;quad4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shell4&quot;</span><span class="p">:</span> <span class="s2">&quot;quad4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wedge&quot;</span><span class="p">:</span> <span class="s2">&quot;wedge6&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">element_type</span> <span class="ow">in</span> <span class="n">translation_list</span><span class="p">:</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="n">translation_list</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">warning</span> <span class="ow">and</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STANDARD_ELEMENT_TYPES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Nonstandard element type&quot;</span><span class="p">,</span>
                <span class="s1">&#39;The element type &quot;</span><span class="si">%s</span><span class="s1">&quot; is not a standard &#39;</span>
                <span class="s2">&quot;element type.  This may cause issues with &quot;</span>
                <span class="s2">&quot;handling element blocks with elements of &quot;</span>
                <span class="s2">&quot;this type.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">element_type</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">element_type</span>

    <span class="k">def</span> <span class="nf">_get_default_field_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the default value for a field with the given name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_displacement_field_prefix</span><span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]):</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_displacement_field_prefix</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return &#39;True&#39; if name is a displacement field prefix.&quot;&quot;&quot;</span>
        <span class="n">default_name</span> <span class="o">=</span> <span class="s2">&quot;displacement&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">default_name</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_get_displacement_field_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the prefix of the displacement field.</span>

<span class="sd">        If no displacement field exists, this will return the default prefix.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;disp&quot;</span>
        <span class="k">for</span> <span class="n">node_field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">():</span>
            <span class="c1"># if it doesn&#39;t end in &quot;_x&quot;, it&#39;s not a prefix</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">node_field_name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># check against acceptable names</span>
            <span class="n">this_prefix</span> <span class="o">=</span> <span class="n">node_field_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_displacement_field_prefix</span><span class="p">(</span><span class="n">this_prefix</span><span class="p">):</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">this_prefix</span>
        <span class="k">return</span> <span class="n">prefix</span>

    <span class="k">def</span> <span class="nf">_get_element_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all element faces.</span>

<span class="sd">        Note that internal element faces will be duplicated in the list.</span>

<span class="sd">        A list is returned with members of the form:</span>
<span class="sd">        * &#39;(element_block_id, element_index, face_index)&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                <span class="n">members</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">id_</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">))])</span>
        <span class="k">return</span> <span class="n">members</span>

    <span class="k">def</span> <span class="nf">_get_block_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the info of an element block.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_external_element_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of external element faces.</span>

<span class="sd">        External faces are element faces which are shared by no other elements.</span>

<span class="sd">        A list is returned with members of the form:</span>
<span class="sd">        * &#39;(element_block_id, element_index, face_index)&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">external_faces</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_block_info</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">face_index</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">face_mapping</span><span class="p">):</span>
                    <span class="n">sorted_nodes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">sorted_nodes</span> <span class="ow">in</span> <span class="n">external_faces</span><span class="p">:</span>
                        <span class="n">external_faces</span><span class="p">[</span><span class="n">sorted_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">this_face</span> <span class="o">=</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">)</span>
                        <span class="n">external_faces</span><span class="p">[</span><span class="n">sorted_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_face</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">external_faces</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_mean</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the mean of a list of values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_order_element_faces_by_block</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort element faces by element block id.</span>

<span class="sd">        This takes in a list of members of the form:</span>
<span class="sd">        * &#39;(element_block_id, element_index, face_index)&#39;</span>

<span class="sd">        This outputs a dictionary with the form</span>
<span class="sd">        * &#39;output[element_block_id] = list of (element_index, face_index)&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">members_by_block</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element_block_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">members_by_block</span><span class="p">:</span>
                <span class="n">members_by_block</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">members_by_block</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">members_by_block</span>

    <span class="k">def</span> <span class="nf">_get_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dimension of the given element type.&quot;&quot;&quot;</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIMENSION</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_triangulated_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the rule for how to triangulate the given 2D face.&quot;&quot;&quot;</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIANGULATED_FACES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                <span class="s2">&quot;Invalid element type.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;We do not know how to subdivide an element of type &quot;</span>
                <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; into triangles.&#39;</span> <span class="o">%</span> <span class="n">element_type</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIANGULATED_FACES</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_convert_side_set_to_triangle_block</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="p">,</span> <span class="n">new_element_block_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new &#39;tri3&#39; element block composed of the given side set.</span>

<span class="sd">        The side set must contain faces of three dimensional elements.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_element_block_id</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">new_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># find members of all the given side sets by block</span>
        <span class="n">members_by_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_element_faces_by_block</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="c1"># ensure all blocks are 3D</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">members_by_block</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dimension</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dimension</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Incompatible element dimension.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;We expect the side set to contain faces of 3D &quot;</span>
                    <span class="s2">&quot;elements.  However, the side set contains at &quot;</span>
                    <span class="s2">&quot;least one face from element block </span><span class="si">%d</span><span class="s2"> which &quot;</span>
                    <span class="s1">&#39;contains </span><span class="si">%d</span><span class="s1">D elements of type &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">dimension</span><span class="p">,</span> <span class="n">element_type</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="c1"># Now we need to create the triangles from each member of the side set.</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">members</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">members_by_block</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="n">face_element_map</span> <span class="o">=</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_element_map</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">face_element_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
                    <span class="n">faces</span><span class="p">[</span><span class="n">face_element_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">local_node</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">faces</span><span class="p">[</span><span class="n">face_element_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_node</span><span class="p">)</span>
        <span class="c1"># now triangulate each face</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">next_node_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">connectivity_list</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">triangulated_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_triangulated_faces</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">local_face_indices</span> <span class="ow">in</span> <span class="n">connectivity_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">face_indices</span> <span class="ow">in</span> <span class="n">triangulated_faces</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">face_indices</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                            <span class="n">connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_face_indices</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                            <span class="k">continue</span>
                        <span class="n">averaged_nodes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">local_face_indices</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_nodes</span> <span class="ow">or</span> <span class="n">new_nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">averaged_nodes</span><span class="p">:</span>
                            <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">averaged_nodes</span><span class="p">)</span>
                            <span class="n">next_node_index</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_node_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># create the new nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_averaged_nodes</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># create the new element block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
            <span class="n">new_element_block_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">connectivity</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_sign</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the sign of a value.</span>

<span class="sd">        This returns 1 if the value positive, -1 if negative, and 0 otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_partition_triangle_block_from_node_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_block_id</span><span class="p">,</span>
        <span class="n">new_element_block_id</span><span class="p">,</span>
        <span class="n">node_field_name</span><span class="p">,</span>
        <span class="n">timestep</span><span class="p">,</span>
        <span class="n">interval_list</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subdivide a &#39;tri3&#39; element block based on the given field intervals.</span>

<span class="sd">        The target element block will have a element field named &#39;interval&#39;</span>
<span class="sd">        corresponding to the given interval the element falls into.</span>

<span class="sd">        This is a helper function for generating nice looking WRL files.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">node_field_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">(),</span> <span class="s2">&quot;node field&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="c1"># verify block is actually a tri3 block</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;tri3&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid element type&quot;</span><span class="p">,</span>
                <span class="s2">&quot;This function can only be used to divide element &quot;</span>
                <span class="s1">&#39;blocks composed of &quot;tri3&quot; elements.&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">element_interval_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">triangles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">connectivity</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_list</span><span class="p">):</span>
            <span class="c1"># hold new vertices we have to create</span>
            <span class="c1"># edge = (x, y)</span>
            <span class="c1"># new_vertex[edge] = mid_edge_vertex_index</span>
            <span class="c1"># we do this to keep the mesh watertight</span>
            <span class="n">new_vertex</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">next_node_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">tri</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
                    <span class="n">edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="n">d2</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_sign</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">d</span><span class="p">]]</span> <span class="o">-</span> <span class="n">upper_bound</span><span class="p">)</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sign</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">d2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">upper_bound</span><span class="p">)</span>
                        <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="n">edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_vertex</span><span class="p">:</span>
                            <span class="n">opposite_edge</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
                            <span class="n">new_vertex</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_node_index</span>
                            <span class="n">new_vertex</span><span class="p">[</span><span class="n">opposite_edge</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_node_index</span>
                            <span class="n">next_node_index</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper_bound</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">d</span><span class="p">]])</span> <span class="o">/</span> <span class="p">(</span>
                                <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">d2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">d</span><span class="p">]]</span>
                            <span class="p">)</span>
                            <span class="n">new_node</span> <span class="o">=</span> <span class="p">((</span><span class="n">tri</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="n">d2</span><span class="p">],</span> <span class="n">phi</span><span class="p">))</span>
                            <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_averaged_nodes</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">,</span> <span class="p">[])</span>
            <span class="c1"># now form new triangles</span>
            <span class="n">new_triangles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">this_partition</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">tri</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span>
                    <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span>
                    <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span>
                <span class="p">):</span>
                    <span class="n">this_partition</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">upper_bound</span>
                    <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">upper_bound</span>
                    <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">upper_bound</span>
                <span class="p">):</span>
                    <span class="n">new_triangles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># find vertex below the bound</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="p">(</span>
                        <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">d</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">upper_bound</span>
                        <span class="ow">or</span> <span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">upper_bound</span>
                    <span class="p">):</span>
                        <span class="n">d</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">tri</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tri</span><span class="p">[(</span><span class="n">d</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
                    <span class="n">case</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_sign</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span> <span class="o">-</span> <span class="n">upper_bound</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">m1</span> <span class="o">=</span> <span class="n">new_vertex</span><span class="p">[(</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                        <span class="n">m2</span> <span class="o">=</span> <span class="n">new_vertex</span><span class="p">[(</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
                        <span class="c1"># below triangles</span>
                        <span class="n">this_partition</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m1</span><span class="p">,</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="n">this_partition</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="c1"># above triangles</span>
                        <span class="n">new_triangles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m1</span><span class="p">,</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m2</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">case</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">m1</span> <span class="o">=</span> <span class="n">new_vertex</span><span class="p">[(</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                        <span class="n">m2</span> <span class="o">=</span> <span class="n">new_vertex</span><span class="p">[(</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                        <span class="c1"># below triangles</span>
                        <span class="n">this_partition</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">))</span>
                        <span class="c1"># above triangles</span>
                        <span class="n">new_triangles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m1</span><span class="p">,</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m2</span><span class="p">))</span>
                        <span class="n">new_triangles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m2</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">case</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">m1</span> <span class="o">=</span> <span class="n">new_vertex</span><span class="p">[(</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                        <span class="c1"># below triangles</span>
                        <span class="n">this_partition</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m1</span><span class="p">))</span>
                        <span class="c1"># above triangles</span>
                        <span class="n">new_triangles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m1</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">case</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">m1</span> <span class="o">=</span> <span class="n">new_vertex</span><span class="p">[(</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                        <span class="c1"># below triangles</span>
                        <span class="n">this_partition</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m1</span><span class="p">,</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="c1"># above triangles</span>
                        <span class="n">new_triangles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m1</span><span class="p">,</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span><span class="s2">&quot;Unknown case&quot;</span><span class="p">)</span>
            <span class="n">triangles</span> <span class="o">=</span> <span class="n">new_triangles</span>
            <span class="n">new_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">this_partition</span><span class="p">))</span>
            <span class="n">element_interval_values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_partition</span><span class="p">))</span>
        <span class="c1"># add rest of triangle to last partition</span>
        <span class="n">new_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">triangles</span><span class="p">))</span>
        <span class="n">element_interval_values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interval_list</span><span class="p">))]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangles</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
            <span class="n">new_element_block_id</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;tri3&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">new_connectivity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_field</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="n">new_element_block_id</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
            <span class="n">field</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">element_interval_values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_coordinates_at_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the node coordinates list at the given timestep.</span>

<span class="sd">        This includes the displacement if it exists.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Ambiguous timestep.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;More than one timestep was specified.  We expected &quot;</span>
                <span class="s2">&quot;one or zero timesteps.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">timestep</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timestep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">displacement_values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_values</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="n">dz</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="o">*</span><span class="n">displacement_values</span><span class="p">)</span>
        <span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.export_wrl_model"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.export_wrl_model">[docs]</a>    <span class="k">def</span> <span class="nf">export_wrl_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">node_field_name</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">,</span>
        <span class="n">field_range</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">intervals</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
        <span class="n">colorspace</span><span class="o">=</span><span class="s2">&quot;rgb&quot;</span><span class="p">,</span>
        <span class="n">displacement_timestep</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">export_exodus_copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the exterior of the model to a colored WRL file.</span>

<span class="sd">        The WRL file format is used by 3D printing software.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.export_wrl_model(&#39;colored_eqps_model.wrl&#39;, &#39;eqps&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">node_field_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">(),</span> <span class="s2">&quot;node field&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">displacement_timestep</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_field_exists</span><span class="p">():</span>
                <span class="n">displacement_timestep</span> <span class="o">=</span> <span class="n">timestep</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">displacement_timestep</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">[</span><span class="n">displacement_timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
                <span class="p">[</span><span class="n">displacement_timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="c1"># all element blocks should either be 3D elements, or &#39;tri3&#39; elements</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">element_dimensions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_dimension</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_types</span><span class="p">)</span>
        <span class="c1"># if we have all 3D elements, create a skin</span>
        <span class="k">if</span> <span class="n">element_dimensions</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">triangle_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
            <span class="n">external_side_set_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_side_set_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span>
                <span class="n">external_side_set_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_external_element_faces</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_side_set_to_triangle_block</span><span class="p">(</span>
                <span class="n">external_side_set_id</span><span class="p">,</span> <span class="n">triangle_element_block_id</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_side_set</span><span class="p">(</span><span class="n">external_side_set_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">element_dimensions</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="n">element_types</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;tri3&quot;</span><span class="p">]):</span>
            <span class="c1"># merge all blocks into another block</span>
            <span class="n">ids_to_merge</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="n">ids_to_merge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_element_block</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">ids_to_merge</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">triangle_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combine_element_blocks</span><span class="p">(</span><span class="n">ids_to_merge</span><span class="p">,</span> <span class="n">triangle_element_block_id</span><span class="p">)</span>
            <span class="c1"># these blocks better form a watertight enclosure</span>
            <span class="n">external_sides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_external_element_faces</span><span class="p">(</span><span class="n">triangle_element_block_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">external_sides</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Enclosure is not watertight.&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;The &quot;tri3&quot; element blocks passed to this function do not &#39;</span>
                    <span class="s2">&quot;form a watertight enclosure.  An output file will still &quot;</span>
                    <span class="s2">&quot;be created, but it is unlikely to be useful as a WRL &quot;</span>
                    <span class="s2">&quot;model.  We found </span><span class="si">%d</span><span class="s2"> unmatched sides.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">external_sides</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid input.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;We expect a list of 3D element blocks or a list of &quot;</span>
                <span class="s2">&quot;2D element blocks composed of triangles.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># now that we have a triangle block, subdivide it</span>
        <span class="n">subdivided_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
        <span class="c1"># set up intervals</span>
        <span class="k">if</span> <span class="n">field_range</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">triangle_element_block_id</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span>
            <span class="n">this_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
            <span class="n">field_range</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">this_values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">this_values</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">field_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">field_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid field range.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The given field range [</span><span class="si">%g</span><span class="s2"> - </span><span class="si">%g</span><span class="s2">] was not valid.&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">field_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">field_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">intervals</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">field_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">field_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">intervals</span><span class="p">)]</span>
            <span class="p">]</span>
        <span class="c1"># partition that block based on the node field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_partition_triangle_block_from_node_field</span><span class="p">(</span>
            <span class="n">triangle_element_block_id</span><span class="p">,</span>
            <span class="n">subdivided_element_block_id</span><span class="p">,</span>
            <span class="n">node_field_name</span><span class="p">,</span>
            <span class="n">timestep</span><span class="p">,</span>
            <span class="n">intervals</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># save model as an ExodusII file so we can view it</span>
        <span class="k">if</span> <span class="n">export_exodus_copy</span><span class="p">:</span>
            <span class="n">temp_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates_at_time</span><span class="p">(</span><span class="n">displacement_timestep</span><span class="p">)</span>
            <span class="n">exodus_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_wrl.e&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_model</span><span class="p">(</span>
                <span class="n">exodus_filename</span><span class="p">,</span>
                <span class="n">element_block_ids</span><span class="o">=</span><span class="n">subdivided_element_block_id</span><span class="p">,</span>
                <span class="n">element_field_names</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span>
                <span class="n">node_field_names</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">global_variable_names</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">timesteps</span><span class="o">=</span><span class="p">[</span><span class="n">timestep</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">temp_nodes</span>
        <span class="c1"># save triangles to the WRL file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#VRML V2.0 utf8</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Transform {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  translation 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  children Shape {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    appearance Appearance {material Material </span><span class="si">{}</span><span class="s2"> }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    geometry IndexedFaceSet {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      coord Coordinate {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        point [</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates_at_time</span><span class="p">(</span><span class="n">displacement_timestep</span><span class="p">):</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">position</span><span class="p">))</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        ]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      coordIndex [</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">subdivided_element_block_id</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">subdivided_element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">,-1,&quot;</span>
                    <span class="o">%</span> <span class="p">(</span>
                        <span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">      ]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      color Color {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        color [</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colorspace</span> <span class="o">==</span> <span class="s2">&quot;rgb&quot;</span><span class="p">:</span>
                <span class="n">colorspace</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">colorsys</span><span class="o">.</span><span class="n">hls_to_rgb</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colorspace</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Unrecognized colorspace.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;The given colorspace was not recognized.  We &quot;</span>
                    <span class="s1">&#39;expected a string such as &quot;rgb&quot; or a list of &#39;</span>
                    <span class="s2">&quot;length </span><span class="si">%d</span><span class="s2"> with RGB triplets.  Instead, we found &quot;</span>
                    <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">colorspace</span><span class="p">)),</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colorspace</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;          </span><span class="si">%s</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">color</span><span class="p">))</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        ]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      colorIndex [</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;        &quot;</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_values</span><span class="p">(</span>
                <span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="n">subdivided_element_block_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">))</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      ]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      colorPerVertex FALSE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># delete the temporary element blocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_block</span><span class="p">(</span>
            <span class="p">[</span><span class="n">triangle_element_block_id</span><span class="p">,</span> <span class="n">subdivided_element_block_id</span><span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.export_stl_file"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.export_stl_file">[docs]</a>    <span class="k">def</span> <span class="nf">export_stl_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">displacement_timestep</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the exterior of the model to an STL file.</span>

<span class="sd">        By default, if timesteps exist and a displacement field exists, the</span>
<span class="sd">        displacements at the last timestep will be applied.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.export_stl_file(&#39;mesh_surface.stl&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">displacement_timestep</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_field_exists</span><span class="p">():</span>
                <span class="n">displacement_timestep</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">displacement_timestep</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="c1"># create a new element block composed of triangles</span>
        <span class="n">triangle_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
        <span class="n">external_side_set_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_side_set_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span>
            <span class="n">external_side_set_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_external_element_faces</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_side_set_to_triangle_block</span><span class="p">(</span>
            <span class="n">external_side_set_id</span><span class="p">,</span> <span class="n">triangle_element_block_id</span>
        <span class="p">)</span>
        <span class="c1"># export that set</span>
        <span class="n">displacement_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">displacement_timestep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span>
        <span class="p">)</span>
        <span class="c1"># get coordinates at the time we care about</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates_at_time</span><span class="p">(</span><span class="n">displacement_timestep</span><span class="p">)</span>
        <span class="c1"># create the STL file</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">triangle_element_block_id</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;l&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">tri</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
                <span class="n">normal</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">normal</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">)</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;3f&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">normal</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">tri</span><span class="p">:</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;3f&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">vertex</span><span class="p">]))</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;h&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># delete the temporary block we created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_block</span><span class="p">(</span><span class="n">triangle_element_block_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.export"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.export">[docs]</a>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a model based on the filename extension.</span>

<span class="sd">        The following extensions will call the appropriate functions:</span>
<span class="sd">        * &#39;WRL --&gt; export_wrl_model&#39;</span>
<span class="sd">        * &#39;STL --&gt; export_stl_file&#39;</span>
<span class="sd">        * &#39;E, G, EXO --&gt; export_model&#39;</span>

<span class="sd">        Arguments are passed through to the export function.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.export(&#39;result.e&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.export(&#39;result.stl&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.export(&#39;result.wrl&#39;, &#39;eqps&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exporters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">exporters</span><span class="p">[</span><span class="s2">&quot;wrl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_wrl_model</span>
        <span class="n">exporters</span><span class="p">[</span><span class="s2">&quot;stl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_stl_file</span>
        <span class="n">exporters</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_model</span>
        <span class="n">exporters</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_model</span>
        <span class="n">exporters</span><span class="p">[</span><span class="s2">&quot;exo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_model</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exporters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Unrecognized file extension.&quot;</span><span class="p">,</span>
                <span class="s1">&#39;The filename extension &quot;</span><span class="si">%s</span><span class="s1">&quot; was not recognized.  The &#39;</span>
                <span class="s2">&quot;list of recognized extensions is : </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">extension</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">exporters</span><span class="o">.</span><span class="n">keys</span><span class="p">()))),</span>
            <span class="p">)</span>
        <span class="n">exporters</span><span class="p">[</span><span class="n">extension</span><span class="p">](</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_error_evaluating_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Throw an error saying we could not evaluate the given expression.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
            <span class="s2">&quot;Invalid expression&quot;</span><span class="p">,</span>
            <span class="s2">&quot;An error occurred while trying to evaluate the given &quot;</span>
            <span class="s2">&quot;expression.  It is likely that this expression is &quot;</span>
            <span class="s2">&quot;ill-formed, or that the variables it uses do not &quot;</span>
            <span class="s2">&quot;exist:</span><span class="se">\n\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">Defined variables: </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">keys</span><span class="p">()))),</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_transform_eval_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">variable_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform a string expression into one usable by eval.&quot;&quot;&quot;</span>
        <span class="n">eval_expression</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">expression</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">variable_names</span><span class="p">:</span>
            <span class="n">eval_expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="s2">&quot;([^a-zA-Z0-9_])</span><span class="si">%s</span><span class="s2">([^a-zA-Z0-9_])&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;\1var[&#39;</span><span class="si">%s</span><span class="s2">&#39;]\2&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="n">eval_expression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># add &quot;math.&quot; to supported mathematical functions</span>
        <span class="c1"># Note: abs is a built-in function, it is not math.abs</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;atan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sinh&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cosh&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tanh&quot;</span><span class="p">,</span>
            <span class="s2">&quot;exp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sqrt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tan&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">eval_expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="s2">&quot;([^a-zA-Z0-9_])</span><span class="si">%s</span><span class="s2">([^a-zA-Z0-9_])&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;\1math.</span><span class="si">%s</span><span class="s2">\2&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="n">eval_expression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># convert powers to from &quot;^&quot; to &quot;**&quot; format</span>
        <span class="n">eval_expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\^&quot;</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">,</span> <span class="n">eval_expression</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eval_expression</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<div class="viewcode-block" id="ExodusModel.get_element_block_dimension"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_block_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_block_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the dimension of elements within this element block.</span>

<span class="sd">        If this cannot be determined, return -1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIMENSION</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIMENSION</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="ExodusModel.get_nodes_per_element"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_nodes_per_element">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_per_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the nodes per element in the given element block.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_element_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the element type for the given element block.</span>

<span class="sd">        This is a string value stored within the ExodusII file.  There is no</span>
<span class="sd">        standard naming convention and different programs can call the same</span>
<span class="sd">        element type by different names.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">e_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e_type</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">e_type</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e_type</span>

    <span class="k">def</span> <span class="nf">_calculate_element_field_extreme</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_field_names</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="p">,</span>
        <span class="n">function</span><span class="p">,</span>
        <span class="n">function_name</span><span class="p">,</span>
        <span class="n">calculate_block_id</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">calculate_location</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store an element field extreme as a global variable.&quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">element_field_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">),</span>
            <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">element_field_name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_missing_on_entity_error</span><span class="p">(</span>
                        <span class="n">element_field_name</span><span class="p">,</span>
                        <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
                        <span class="n">element_block_id</span><span class="p">,</span>
                        <span class="s2">&quot;element block&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">for</span> <span class="n">element_field_name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">element_field_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">function_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">calculate_location</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_z&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">calculate_block_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_block_id&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">extreme</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">extreme_block_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">extreme_node_indices</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">this_extreme</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">extreme</span> <span class="ow">is</span> <span class="kc">None</span>
                        <span class="ow">or</span> <span class="n">function</span><span class="p">([</span><span class="n">extreme</span><span class="p">,</span> <span class="n">this_extreme</span><span class="p">])</span> <span class="o">==</span> <span class="n">this_extreme</span>
                    <span class="p">):</span>
                        <span class="n">extreme</span> <span class="o">=</span> <span class="n">this_extreme</span>
                        <span class="n">extreme_block_id</span> <span class="o">=</span> <span class="n">element_block_id</span>
                        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                        <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                        <span class="n">element_index</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extreme</span><span class="p">)</span>
                        <span class="n">extreme_node_indices</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                            <span class="n">element_index</span>
                            <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="o">*</span> <span class="n">nodes_per_element</span>
                        <span class="p">]</span>
                <span class="k">if</span> <span class="n">extreme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                        <span class="s2">&quot;No values encountered&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;The element field extreme cannot be &quot;</span>
                        <span class="s2">&quot;calculated because no values are present.&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">extreme</span>
                <span class="k">if</span> <span class="n">calculate_block_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_block_id&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="n">extreme_block_id</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">calculate_location</span><span class="p">:</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">extreme_node_indices</span><span class="p">]</span>
                    <span class="n">centroid</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_z&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.calculate_element_field_maximum"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_element_field_maximum">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_element_field_maximum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_field_names</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">calculate_location</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">calculate_block_id</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store an element field maximum as a global variable.</span>

<span class="sd">        If &#39;calculate_block_id=True&#39;, also store the element block id</span>
<span class="sd">        containing the element with this value.</span>

<span class="sd">        If &#39;calculate_location=True&#39;, also store the location of the centroid</span>
<span class="sd">        of the element with this value.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_element_field_maximum(&#39;eqps&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.global_variables[&#39;eqps_max&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_element_field_extreme</span><span class="p">(</span>
            <span class="n">element_field_names</span><span class="p">,</span>
            <span class="n">element_block_ids</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">,</span>
            <span class="s2">&quot;max&quot;</span><span class="p">,</span>
            <span class="n">calculate_location</span><span class="o">=</span><span class="n">calculate_location</span><span class="p">,</span>
            <span class="n">calculate_block_id</span><span class="o">=</span><span class="n">calculate_block_id</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_element_field_minimum"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_element_field_minimum">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_element_field_minimum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_field_names</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">calculate_location</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">calculate_block_id</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store an element field minimum as a global variable.</span>

<span class="sd">        If &#39;calculate_block_id=True&#39;, also store the element block id</span>
<span class="sd">        containing the element with this value.</span>

<span class="sd">        If &#39;calculate_location=True&#39;, also store the location of the centroid</span>
<span class="sd">        of the element with this value.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_element_field_minimum(&#39;eqps&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.global_variables[&#39;eqps_min&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_element_field_extreme</span><span class="p">(</span>
            <span class="n">element_field_names</span><span class="p">,</span>
            <span class="n">element_block_ids</span><span class="p">,</span>
            <span class="nb">min</span><span class="p">,</span>
            <span class="s2">&quot;min&quot;</span><span class="p">,</span>
            <span class="n">calculate_location</span><span class="o">=</span><span class="n">calculate_location</span><span class="p">,</span>
            <span class="n">calculate_block_id</span><span class="o">=</span><span class="n">calculate_block_id</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_calculate_node_field_extreme</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_field_names</span><span class="p">,</span>
        <span class="n">function</span><span class="p">,</span>
        <span class="n">function_name</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">calculate_location</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store a node field extreme as a global variable.&quot;&quot;&quot;</span>
        <span class="n">node_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">(),</span> <span class="s2">&quot;node field&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">element_block_ids</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">node_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_indices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;No node values&quot;</span><span class="p">,</span>
                <span class="s2">&quot;No nodes were specified, so we cannot calculate the &quot;</span> <span class="s2">&quot;extreme value.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">node_field_name</span> <span class="ow">in</span> <span class="n">node_field_names</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">node_field_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">function_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">calculate_location</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_z&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">]</span>
                <span class="n">extreme</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">extreme</span>
                <span class="k">if</span> <span class="n">calculate_location</span><span class="p">:</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coordinates_at_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">node_index</span> <span class="o">=</span> <span class="n">node_indices</span><span class="p">[</span><span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">extreme</span><span class="p">)]</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_z&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.calculate_node_field_maximum"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_node_field_maximum">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_node_field_maximum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_field_names</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">calculate_location</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a node field maximum as a global variable.</span>

<span class="sd">        If &#39;calculate_location=True&#39;, also store the location of the node with</span>
<span class="sd">        this value.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_node_field_maximum(&#39;temp&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.global_variables[&#39;temp_max&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_node_field_extreme</span><span class="p">(</span>
            <span class="n">node_field_names</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">,</span>
            <span class="s2">&quot;max&quot;</span><span class="p">,</span>
            <span class="n">element_block_ids</span><span class="o">=</span><span class="n">element_block_ids</span><span class="p">,</span>
            <span class="n">calculate_location</span><span class="o">=</span><span class="n">calculate_location</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_node_field_minimum"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_node_field_minimum">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_node_field_minimum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_field_names</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">calculate_location</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a node field minimum as a global variable.</span>

<span class="sd">        If &#39;calculate_location=True&#39;, also store the location of the node with</span>
<span class="sd">        this value.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_node_field_maximum(&#39;temp&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.global_variables[&#39;temp_min&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_node_field_extreme</span><span class="p">(</span>
            <span class="n">node_field_names</span><span class="p">,</span>
            <span class="nb">min</span><span class="p">,</span>
            <span class="s2">&quot;min&quot;</span><span class="p">,</span>
            <span class="n">element_block_ids</span><span class="o">=</span><span class="n">element_block_ids</span><span class="p">,</span>
            <span class="n">calculate_location</span><span class="o">=</span><span class="n">calculate_location</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.output_global_variables"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.output_global_variables">[docs]</a>    <span class="k">def</span> <span class="nf">output_global_variables</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">global_variable_names</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output global variables in CSV format.</span>

<span class="sd">        If &#39;filename=None&#39;, output will be sent to stdout.  Else, it will be</span>
<span class="sd">        output to the given filename.</span>

<span class="sd">        By default, information is output for all timesteps and all global</span>
<span class="sd">        variables.  This may be changed by specifying which timesteps and</span>
<span class="sd">        variables are output.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.output_global_variables(&#39;variables.csv&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.output_global_variables(&#39;variables.csv&#39;, timesteps=&#39;last&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">global_variable_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">global_variable_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">(),</span> <span class="s2">&quot;global variable&quot;</span>
        <span class="p">)</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="c1"># output header</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
        <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">global_variable_names</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># output values</span>
        <span class="k">for</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="n">timesteps</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">timestep</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">global_variable_names</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># output to file or screen</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_global_variable"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_global_variable">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_global_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a global variable calculated from the given expression.</span>

<span class="sd">        The expression may include the following variables:</span>
<span class="sd">        * &#39;time&#39; to refer to the current time</span>
<span class="sd">        * global variables (by name)</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_global_variable(&#39;time_squared = time ^ 2&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_global_variable(&#39;total = potential + kinetic&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid expression&quot;</span><span class="p">,</span>
                <span class="s1">&#39;A &quot;=&quot; sign must be present in the expression but &#39;</span>
                <span class="s2">&quot;was not found.</span><span class="se">\n\n</span><span class="s2">Expression: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
        <span class="c1"># create list of variable names and modify them in the expression</span>
        <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
        <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">())</span>
        <span class="n">eval_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_eval_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">variable_names</span><span class="p">)</span>
        <span class="n">function</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda var: &quot;</span> <span class="o">+</span> <span class="n">eval_expression</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                <span class="n">var</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">new_name</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error_evaluating_expression</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">eval_expression</span><span class="p">),</span> <span class="n">var</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_node_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_node_field">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_node_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a node field calculated from the given expression.</span>

<span class="sd">        The expression may include the following variables:</span>
<span class="sd">        * &#39;time&#39; to refer to the current time</span>
<span class="sd">        * global variables (by name)</span>
<span class="sd">        * node fields (by name)</span>
<span class="sd">        * model coordinates (&#39;X&#39;, &#39;Y&#39;, and &#39;Z&#39;)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_node_field(&#39;temp_C = temp_K - 273.15&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid expression&quot;</span><span class="p">,</span>
                <span class="s1">&#39;A &quot;=&quot; sign must be present in the expression but &#39;</span>
                <span class="s2">&quot;was not found.</span><span class="se">\n\n</span><span class="s2">Expression: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_node_field</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
        <span class="n">new_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span>
        <span class="c1"># create list of variable names and modify them in the expression</span>
        <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
        <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">])</span>
        <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">())</span>
        <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">())</span>
        <span class="n">eval_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_eval_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">variable_names</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">function</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda var: &quot;</span> <span class="o">+</span> <span class="n">eval_expression</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                <span class="c1"># set time</span>
                <span class="n">var</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
                <span class="c1"># set global variables</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">]</span>
                <span class="c1"># go through each node</span>
                <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)):</span>
                    <span class="c1"># set coordinate values</span>
                    <span class="n">var</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">var</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">var</span><span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                    <span class="c1"># set node field values</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                        <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">node_index</span><span class="p">]</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                    <span class="n">new_values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error_evaluating_expression</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">eval_expression</span><span class="p">),</span> <span class="n">var</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_node_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_node_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_node_set_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a node set field calculated from the given expression.</span>

<span class="sd">        The expression may include the following variables:</span>
<span class="sd">        * &#39;time&#39; to refer to the current time</span>
<span class="sd">        * global variables (by name)</span>
<span class="sd">        * node fields (by name)</span>
<span class="sd">        * node set fields (by name)</span>
<span class="sd">        * model coordinates (&#39;X&#39;, &#39;Y&#39;, and &#39;Z&#39;)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_node_set_field(&#39;temp_C = temp_K - 273.15&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid expression&quot;</span><span class="p">,</span>
                <span class="s1">&#39;A &quot;=&quot; sign must be present in the expression but &#39;</span>
                <span class="s2">&quot;was not found.</span><span class="se">\n\n</span><span class="s2">Expression: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># for each node set</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_node_set_field</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span>
            <span class="c1"># create list of variable names and modify them in the expression</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">])</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">())</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">())</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">eval_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_eval_expression</span><span class="p">(</span>
                <span class="n">expression</span><span class="p">,</span> <span class="n">variable_names</span>
            <span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda var: &quot;</span> <span class="o">+</span> <span class="n">eval_expression</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                    <span class="c1"># set time</span>
                    <span class="n">var</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
                    <span class="c1"># set global variables</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                        <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">]</span>
                    <span class="c1"># go through each node</span>
                    <span class="k">for</span> <span class="n">member_index</span><span class="p">,</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                        <span class="c1"># set coordinate values</span>
                        <span class="n">var</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">var</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">var</span><span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                        <span class="c1"># set node fields</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                            <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">node_index</span><span class="p">]</span>
                        <span class="c1"># set node set fields</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                            <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">member_index</span><span class="p">]</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                        <span class="n">new_values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">member_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error_evaluating_expression</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">eval_expression</span><span class="p">),</span> <span class="n">var</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_side_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_side_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_side_set_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a side set field calculated from the given expression.</span>

<span class="sd">        The expression may include the following variables:</span>
<span class="sd">        * &#39;time&#39; to refer to the current time</span>
<span class="sd">        * global variables (by name)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_side_set_field(&#39;temp_C = temp_K - 273.15&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid expression&quot;</span><span class="p">,</span>
                <span class="s1">&#39;A &quot;=&quot; sign must be present in the expression but &#39;</span>
                <span class="s2">&quot;was not found.</span><span class="se">\n\n</span><span class="s2">Expression: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># for each side set</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set_field</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span>
            <span class="c1"># create list of variable names and modify them in the expression</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">())</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">eval_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_eval_expression</span><span class="p">(</span>
                <span class="n">expression</span><span class="p">,</span> <span class="n">variable_names</span>
            <span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda var: &quot;</span> <span class="o">+</span> <span class="n">eval_expression</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                    <span class="c1"># set time</span>
                    <span class="n">var</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
                    <span class="c1"># set global variables</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                        <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">]</span>
                    <span class="c1"># go through each face</span>
                    <span class="k">for</span> <span class="n">member_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)):</span>
                        <span class="c1"># set side set fields</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                            <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">member_index</span><span class="p">]</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                        <span class="n">new_values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">member_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error_evaluating_expression</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">eval_expression</span><span class="p">),</span> <span class="n">var</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_element_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_element_field">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_element_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store an element field calculated from the given expression.</span>

<span class="sd">        The expression may include the following variables:</span>
<span class="sd">        * &#39;time&#39; to refer to the current time</span>
<span class="sd">        * global variables (by name)</span>
<span class="sd">        * element fields (by name)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_element_field(&#39;pressure = (stress_xx + &#39;</span>
<span class="sd">        ...                               &#39;stress_yy + stress_zz) / -3&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid expression&quot;</span><span class="p">,</span>
                <span class="s1">&#39;A &quot;=&quot; sign must be present in the expression but &#39;</span>
                <span class="s2">&quot;was not found.</span><span class="se">\n\n</span><span class="s2">Expression: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expression</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># for each element block</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_element_field</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span>
            <span class="c1"># create list of variable names and modify them in the expression</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">())</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">eval_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_eval_expression</span><span class="p">(</span>
                <span class="n">expression</span><span class="p">,</span> <span class="n">variable_names</span>
            <span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda var: &quot;</span> <span class="o">+</span> <span class="n">eval_expression</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                    <span class="c1"># set time</span>
                    <span class="n">var</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
                    <span class="c1"># set global variables</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                        <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">]</span>
                    <span class="c1"># go through element</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                        <span class="c1"># set element fields</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                            <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                        <span class="n">new_values</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error_evaluating_expression</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">eval_expression</span><span class="p">),</span> <span class="n">var</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.to_lowercase"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.to_lowercase">[docs]</a>    <span class="k">def</span> <span class="nf">to_lowercase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the names of all entities within the model to lowercase.</span>

<span class="sd">        This affects global variables, node fields, element fields, side set</span>
<span class="sd">        fields, and node set fields.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.to_lowercase()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_global_variable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_node_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">id_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rename_side_set_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">id_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rename_node_set_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">id_</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_translate_element_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_translation_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert element blocks to a new element type.</span>

<span class="sd">        &gt;&gt;&gt; model._translate_element_blocks([(1, &#39;hex20&#39;), (2, &#39;tet10&#39;)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># validity check the inputs</span>
        <span class="n">valid_element_block_translation_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">new_element_type</span> <span class="ow">in</span> <span class="n">element_block_translation_list</span><span class="p">:</span>
            <span class="c1"># check if element block exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_block_exists</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_missing_warning</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="s2">&quot;element block&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">old_element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># check if any schemes exist for this element block</span>
            <span class="k">if</span> <span class="n">old_element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_CONVERSIONS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;No element conversion schemes&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;There are no element conversion schemes to &quot;</span>
                    <span class="s1">&#39;convert elements of type &quot;</span><span class="si">%s</span><span class="s1">&quot; into any other &#39;</span>
                    <span class="s2">&quot;element type.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">old_element_type</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># check if the given scheme exists for this element block</span>
            <span class="n">conversions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="n">old_element_type</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">new_element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conversions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid target element type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;There are no element conversion schemes to &quot;</span>
                    <span class="s1">&#39;convert elements of type &quot;</span><span class="si">%s</span><span class="s1">&quot; into elements of &#39;</span>
                    <span class="s1">&#39;type &quot;</span><span class="si">%s</span><span class="s1">&quot;.  Conversions are available to the &#39;</span>
                    <span class="s1">&#39;following element types: &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span>
                    <span class="o">%</span> <span class="p">(</span>
                        <span class="n">old_element_type</span><span class="p">,</span>
                        <span class="n">new_element_type</span><span class="p">,</span>
                        <span class="s1">&#39;&quot;, &quot;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">conversions</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># all is good, keep this one on the list</span>
            <span class="n">valid_element_block_translation_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">id_</span><span class="p">,</span> <span class="n">new_element_type</span><span class="p">])</span>
        <span class="c1"># if we have nothing to do, just exit</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_element_block_translation_list</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># now we need to find the new nodes to create, if any</span>
        <span class="n">averaged_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">new_element_type</span> <span class="ow">in</span> <span class="n">valid_element_block_translation_list</span><span class="p">:</span>
            <span class="n">old_element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="n">old_element_type</span><span class="p">]</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="n">scheme</span><span class="p">[</span><span class="n">new_element_type</span><span class="p">]</span>
            <span class="c1"># find new nodes which need created</span>
            <span class="n">averaged_node_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">scheme</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">new_node</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">:</span>
                    <span class="c1"># if it&#39;s just an integer, we don&#39;t need a new node created</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="c1"># new node</span>
                    <span class="n">averaged_node_list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>
            <span class="c1"># now loop through all elements and create a list of averaged</span>
            <span class="c1"># nodes to create</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="c1"># iterate over each element</span>
            <span class="k">for</span> <span class="n">local_node</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">connectivity</span><span class="p">[</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">nodes_per_element</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">),</span> <span class="n">nodes_per_element</span><span class="p">)</span>
            <span class="p">]:</span>
                <span class="c1"># iterate over each new averaged node formula</span>
                <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">averaged_node_list</span><span class="p">:</span>
                    <span class="n">node_list</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">))</span>
                    <span class="n">averaged_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
        <span class="c1"># create the averaged node mapping</span>
        <span class="n">averaged_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">averaged_nodes</span><span class="p">)</span>
        <span class="n">averaged_node_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">averaged_nodes</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># create new averaged nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_averaged_nodes</span><span class="p">(</span><span class="n">averaged_nodes</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># now create the new element blocks</span>
        <span class="k">for</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">new_element_type</span> <span class="ow">in</span> <span class="n">valid_element_block_translation_list</span><span class="p">:</span>
            <span class="n">old_element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="n">old_element_type</span><span class="p">]</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="n">scheme</span><span class="p">[</span><span class="n">new_element_type</span><span class="p">]</span>
            <span class="c1"># rename some things</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="c1"># create the connectivity for the new element block</span>
            <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">local_node</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">connectivity</span><span class="p">[</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">nodes_per_element</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">),</span> <span class="n">nodes_per_element</span><span class="p">)</span>
            <span class="p">]:</span>
                <span class="k">for</span> <span class="n">new_element</span> <span class="ow">in</span> <span class="n">scheme</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">new_node</span> <span class="ow">in</span> <span class="n">new_element</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                            <span class="n">new_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">new_node</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">node_list</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_node</span><span class="p">))</span>
                            <span class="n">new_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">averaged_node_map</span><span class="p">[</span><span class="n">node_list</span><span class="p">])</span>
            <span class="c1"># create a temporary element block</span>
            <span class="n">temporary_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
            <span class="n">new_nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NODES_PER_ELEMENT</span><span class="p">[</span><span class="n">new_element_type</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
                <span class="n">temporary_element_block_id</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="n">new_element_type</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">new_connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="n">new_nodes_per_element</span><span class="p">,</span>
                    <span class="n">new_nodes_per_element</span><span class="p">,</span>
                    <span class="mi">0</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">new_connectivity</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">temporary_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span>
                <span class="n">temporary_element_block_id</span>
            <span class="p">)</span>
            <span class="n">element_multiplier</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scheme</span><span class="p">)</span>
            <span class="c1"># transfer element values</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>
                <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
                <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">these_values</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_multiplier</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">these_values</span> <span class="ow">in</span> <span class="n">new_values</span>
                <span class="p">]</span>
                <span class="n">temporary_fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>
            <span class="c1"># for each face in the old scheme, find all of its nodes</span>
            <span class="n">old_face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">old_element_type</span><span class="p">)</span>
            <span class="n">old_face_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">old_face_mapping</span><span class="p">]</span>
            <span class="n">new_face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">new_element_type</span><span class="p">)</span>
            <span class="n">face_translation</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_face_nodes</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">new_element_index</span><span class="p">,</span> <span class="n">new_element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scheme</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">new_face_index</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">face_members</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_face_mapping</span><span class="p">):</span>
                    <span class="c1"># find all nodes used by this new face</span>
                    <span class="n">used_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">face_member</span> <span class="ow">in</span> <span class="n">face_members</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_element</span><span class="p">[</span><span class="n">face_member</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                            <span class="n">used_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_element</span><span class="p">[</span><span class="n">face_member</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">used_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_element</span><span class="p">[</span><span class="n">face_member</span><span class="p">])</span>
                    <span class="c1"># see if these are a subset of nodes in the old set</span>
                    <span class="k">for</span> <span class="n">old_face_index</span><span class="p">,</span> <span class="n">old_members</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old_face_nodes</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">used_nodes</span> <span class="o">&lt;=</span> <span class="n">old_members</span><span class="p">:</span>
                            <span class="n">face_translation</span><span class="p">[</span><span class="n">old_face_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">new_element_index</span><span class="p">,</span> <span class="n">new_face_index</span><span class="p">)</span>
                            <span class="p">)</span>
            <span class="c1"># update self.side_sets</span>
            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
                <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="n">old_members</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">member_index</span><span class="p">,</span> <span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="n">old_members</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">block_id</span> <span class="o">==</span> <span class="n">element_block_id</span><span class="p">:</span>
                        <span class="c1"># add some new faces</span>
                        <span class="k">for</span> <span class="n">new_faces</span> <span class="ow">in</span> <span class="n">face_translation</span><span class="p">[</span><span class="n">face_index</span><span class="p">]:</span>
                            <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">(</span>
                                    <span class="n">temporary_element_block_id</span><span class="p">,</span>
                                    <span class="n">element_index</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">scheme</span><span class="p">)</span> <span class="o">+</span> <span class="n">new_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">new_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="c1"># add values for the new faces</span>
                        <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">face_translation</span><span class="p">[</span><span class="n">face_index</span><span class="p">]:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">member_index</span><span class="p">])</span>
            <span class="c1"># delete the old block</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_block</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="c1"># rename the temporary element block</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_block</span><span class="p">(</span><span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.convert_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.convert_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">convert_element_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">new_element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert elements within a block to a new element type.&quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># form the conversion list</span>
        <span class="n">conversion_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">id_</span><span class="p">,</span> <span class="n">new_element_type</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">]</span>
        <span class="c1"># convert each block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_element_blocks</span><span class="p">(</span><span class="n">conversion_list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_change_element_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">target_order</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert elements to the given order.</span>

<span class="sd">        This will attempt to find the best element to convert to given the</span>
<span class="sd">        conversion schemes involved.  If more than one element option exists</span>
<span class="sd">        for a given element type, this will choose the option that produces</span>
<span class="sd">        the fewest nodes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># find all element types we need to convert</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">element_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">))</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_types</span>
        <span class="p">)</span>
        <span class="c1"># ignore non-standard element types</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_types</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STANDARD_ELEMENT_TYPES</span><span class="p">]</span>
        <span class="c1"># find all elements of the target order</span>
        <span class="n">target_element_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STANDARD_ELEMENT_TYPES</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_order</span>
        <span class="p">]</span>
        <span class="c1"># for each element type, find the optimal target type</span>
        <span class="n">element_type_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element_type</span> <span class="ow">in</span> <span class="n">element_types</span><span class="p">:</span>
            <span class="c1"># if no conversion schemes, error out</span>
            <span class="k">if</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_CONVERSIONS</span><span class="p">:</span>
                <span class="c1"># if element type is already the desired order, no warning</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_order</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Unable to convert&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;There is no valid scheme to convert elements &quot;</span>
                    <span class="s1">&#39;of type &quot;</span><span class="si">%s</span><span class="s1">&quot; to an element type of order &#39;</span>
                    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">element_type</span><span class="p">,</span> <span class="n">target_order</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_CONVERSIONS</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>
            <span class="n">possible_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">scheme</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">target_element_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">possible_types</span><span class="p">:</span>
                <span class="c1"># if element type is already the desired order, no warning</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEMENT_ORDER</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_order</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Unable to convert&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;There is no valid scheme to convert elements &quot;</span>
                    <span class="s1">&#39;of type &quot;</span><span class="si">%s</span><span class="s1">&quot; to an element type of order &#39;</span>
                    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">element_type</span><span class="p">,</span> <span class="n">target_order</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="c1"># out of the given options, choose the one that first creates the</span>
            <span class="c1"># least number of elements, and secondly the least number of nodes</span>
            <span class="n">ranking</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scheme</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">scheme</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">scheme</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">possible_types</span>
            <span class="p">]</span>
            <span class="n">ranking</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ranking</span><span class="p">)</span>
            <span class="n">element_type_map</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">ranking</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># create the conversion list</span>
        <span class="n">conversion_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element_type</span> <span class="ow">in</span> <span class="n">element_type_map</span><span class="p">:</span>
                <span class="n">conversion_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">element_block_id</span><span class="p">,</span> <span class="n">element_type_map</span><span class="p">[</span><span class="n">element_type</span><span class="p">])</span>
                <span class="p">)</span>
        <span class="c1"># now translate the elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_element_blocks</span><span class="p">(</span><span class="n">conversion_list</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.make_elements_linear"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.make_elements_linear">[docs]</a>    <span class="k">def</span> <span class="nf">make_elements_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert elements in one or more element blocks to a linear type.</span>

<span class="sd">        This will attempt to find the best element to convert to given the</span>
<span class="sd">        conversion schemes involved.  If more than one element option exists</span>
<span class="sd">        for a given element type, this will choose the option that produces</span>
<span class="sd">        the fewest nodes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_element_order</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.make_elements_quadratic"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.make_elements_quadratic">[docs]</a>    <span class="k">def</span> <span class="nf">make_elements_quadratic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert elements in one or more element blocks to a quadratic type.</span>

<span class="sd">        This will attempt to find the best element to convert to given the</span>
<span class="sd">        conversion schemes involved.  If more than one element option exists</span>
<span class="sd">        for a given element type, this will choose the option that produces</span>
<span class="sd">        the fewest nodes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_element_order</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_translate_element_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">new_element_type</span><span class="p">,</span> <span class="n">scheme</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert elements within a block to a new type.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">old_element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">new_element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">new_element_type</span><span class="p">)</span>
        <span class="n">old_nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NODES_PER_ELEMENT</span><span class="p">[</span><span class="n">old_element_type</span><span class="p">]</span>
        <span class="n">new_nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NODES_PER_ELEMENT</span><span class="p">[</span><span class="n">new_element_type</span><span class="p">]</span>
        <span class="n">element_multiplier</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scheme</span><span class="p">)</span>
        <span class="c1"># Make a list of nodes which need duplicated and nodes which need</span>
        <span class="c1"># averaged.  We will assign indices to these after we determine how</span>
        <span class="c1"># many there are of each.</span>
        <span class="n">duplicate_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">averaged_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
            <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                <span class="n">element_index</span>
                <span class="o">*</span> <span class="n">old_nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">old_nodes_per_element</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">new_element</span> <span class="ow">in</span> <span class="n">scheme</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">new_node</span> <span class="ow">in</span> <span class="n">new_element</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">duplicate_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">new_node</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">averaged_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_node</span><span class="p">))</span>
        <span class="c1"># create new nodes</span>
        <span class="n">next_node_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">duplicate_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">duplicate_nodes</span><span class="p">)</span>
        <span class="n">averaged_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">averaged_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate_nodes</span><span class="p">(</span><span class="n">duplicate_nodes</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_averaged_nodes</span><span class="p">(</span><span class="n">averaged_nodes</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># assign node indices</span>
        <span class="n">duplicate_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">next_node_index</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">duplicate_nodes</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">next_node_index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate_nodes</span><span class="p">)</span>
        <span class="n">averaged_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">next_node_index</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">averaged_nodes</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># create the connectivity for the new element block</span>
        <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
            <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                <span class="n">element_index</span>
                <span class="o">*</span> <span class="n">old_nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">old_nodes_per_element</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">new_element</span> <span class="ow">in</span> <span class="n">scheme</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">new_node</span> <span class="ow">in</span> <span class="n">new_element</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">new_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duplicate_nodes</span><span class="p">[</span><span class="n">local_node</span><span class="p">[</span><span class="n">new_node</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">averaged_nodes</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_node</span><span class="p">)]</span>
                        <span class="p">)</span>
        <span class="c1"># create the new block</span>
        <span class="n">temporary_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
            <span class="n">temporary_element_block_id</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">new_element_type</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">new_connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="n">new_nodes_per_element</span><span class="p">,</span>
                <span class="n">new_nodes_per_element</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">new_connectivity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">temporary_element_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span>
            <span class="n">temporary_element_block_id</span>
        <span class="p">)</span>
        <span class="c1"># transfer element values</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">these_values</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_multiplier</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">these_values</span> <span class="ow">in</span> <span class="n">new_values</span>
            <span class="p">]</span>
            <span class="n">temporary_element_fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="c1"># for each face in the old scheme, find all of its nodes</span>
        <span class="n">old_face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">old_element_type</span><span class="p">)</span>
        <span class="n">old_face_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">old_face_mapping</span><span class="p">]</span>
        <span class="n">new_face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">new_element_type</span><span class="p">)</span>
        <span class="n">face_translation</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_face_nodes</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">new_element_index</span><span class="p">,</span> <span class="n">new_element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scheme</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">new_face_index</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">face_members</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_face_mapping</span><span class="p">):</span>
                <span class="c1"># find all nodes used by this new face</span>
                <span class="n">used_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">face_member</span> <span class="ow">in</span> <span class="n">face_members</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_element</span><span class="p">[</span><span class="n">face_member</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">used_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_element</span><span class="p">[</span><span class="n">face_member</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">used_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_element</span><span class="p">[</span><span class="n">face_member</span><span class="p">])</span>
                <span class="c1"># see if these are a subset of nodes in the old set</span>
                <span class="k">for</span> <span class="n">old_face_index</span><span class="p">,</span> <span class="n">old_members</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old_face_nodes</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">used_nodes</span> <span class="o">&lt;=</span> <span class="n">old_members</span><span class="p">:</span>
                        <span class="n">face_translation</span><span class="p">[</span><span class="n">old_face_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">new_element_index</span><span class="p">,</span> <span class="n">new_face_index</span><span class="p">)</span>
                        <span class="p">)</span>
        <span class="c1"># update self.side_sets</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">old_members</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">member_index</span><span class="p">,</span> <span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">old_members</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">block_id</span> <span class="o">==</span> <span class="n">element_block_id</span><span class="p">:</span>
                    <span class="c1"># add some new faces</span>
                    <span class="k">for</span> <span class="n">new_faces</span> <span class="ow">in</span> <span class="n">face_translation</span><span class="p">[</span><span class="n">face_index</span><span class="p">]:</span>
                        <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">temporary_element_block_id</span><span class="p">,</span>
                                <span class="n">element_index</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">scheme</span><span class="p">)</span> <span class="o">+</span> <span class="n">new_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">new_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="c1"># add values for the new faces</span>
                    <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">face_translation</span><span class="p">[</span><span class="n">face_index</span><span class="p">]:</span>
                                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">member_index</span><span class="p">])</span>
        <span class="c1"># delete the old block and rename the new one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_block</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_block</span><span class="p">(</span><span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.convert_hex8_block_to_tet4_block"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.convert_hex8_block_to_tet4_block">[docs]</a>    <span class="k">def</span> <span class="nf">convert_hex8_block_to_tet4_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;hex24tet&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a block of &#39;hex8&#39; elements to a block of &#39;tet4&#39; elements.</span>

<span class="sd">        Side sets are updated accordingly.</span>

<span class="sd">        Node sets are not modified.</span>

<span class="sd">        Currently, only the &#39;hex24tet&#39; scheme is implemented, which creates 24</span>
<span class="sd">        &#39;tet4&#39; element for eeach &#39;hex8&#39; element in the original mesh.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.convert_hex8_block_to_tet4_block(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="c1"># ensure source block is actually hex8</span>
        <span class="n">source_element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">source_element_type</span> <span class="o">!=</span> <span class="s2">&quot;hex8&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Incompatible element type.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;We were expecting an element block composed of &quot;</span>
                <span class="s1">&#39;&quot;hex8&quot; element but instead encountered one with &quot;</span><span class="si">%s</span><span class="s1">&quot; &#39;</span>
                <span class="s2">&quot;elements.&quot;</span> <span class="o">%</span> <span class="n">source_element_type</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># get the chosen scheme</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">!=</span> <span class="s2">&quot;hex24tet&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Unsupported scheme.&quot;</span><span class="p">,</span> <span class="s1">&#39;The scheme &quot;</span><span class="si">%s</span><span class="s1">&quot; was not recognized.&#39;</span> <span class="o">%</span> <span class="n">scheme</span>
            <span class="p">)</span>
        <span class="c1"># create the scheme</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="s2">&quot;hex8&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">scheme</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">tuple</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">face</span><span class="p">[(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="n">face</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                            <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">face</span><span class="p">)),</span>
                            <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># apply it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">,</span> <span class="s2">&quot;tet4&quot;</span><span class="p">,</span> <span class="n">scheme</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.displacement_field_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.displacement_field_exists">[docs]</a>    <span class="k">def</span> <span class="nf">displacement_field_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the displacement field exists.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.displacement_field_exists()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_prefix</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_field_exists</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_x&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_field_exists</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_y&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_field_exists</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_z&quot;</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.create_displacement_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_displacement_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_displacement_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the displacement field if it doesn&#39;t already exist.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_displacement_field()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_prefix</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]:</span>
            <span class="n">this_name</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">component</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_field_exists</span><span class="p">(</span><span class="n">this_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_node_field</span><span class="p">(</span><span class="n">this_name</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_displacement_field_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of the displacement field names.</span>

<span class="sd">        This will create them if they do not already exist.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_displacement_field</span><span class="p">()</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_prefix</span><span class="p">()</span>
        <span class="n">displacement_field_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]:</span>
            <span class="n">this_name</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">component</span>
            <span class="n">displacement_field_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">this_name</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">displacement_field_list</span>

    <span class="k">def</span> <span class="nf">_apply_displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the displacements to each node.</span>

<span class="sd">        If &#39;dx, dy, dz&#39; are the components of the displacement fields, this</span>
<span class="sd">        applies the following transformation.</span>
<span class="sd">        * &#39;X --&gt; X + dx&#39;</span>
<span class="sd">        * &#39;Y --&gt; Y + dy&#39;</span>
<span class="sd">        * &#39;Z --&gt; Z + dz&#39;</span>

<span class="sd">        The nodal coordinates are modified but the displacement field itself</span>
<span class="sd">        is unchanged.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Ambiguous timestep.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;More than one timestep was specified.  We expected &quot;</span>
                <span class="s2">&quot;one or zero timesteps.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">timestep</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timestep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">displacement_values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_values</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="o">*</span><span class="n">displacement_values</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">new_nodes</span>

    <span class="k">def</span> <span class="nf">_get_local_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">this_id</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="s2">&quot;entity&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the local index corresponding to the given id.</span>

<span class="sd">        If an entity is not present, throw an error.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._get_local_index(10, [10, 20, 30])</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; model._get_local_index(&#39;first&#39;, [10, 20, 30])</span>
<span class="sd">        10</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">this_id</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">id_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Undefined </span><span class="si">%s</span><span class="s2"> reference.&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                    <span class="s2">&quot;A reference to the first </span><span class="si">%s</span><span class="s2"> was encountered but &quot;</span>
                    <span class="s2">&quot;no </span><span class="si">%s</span><span class="s2">s are defined.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">this_id</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">id_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Undefined </span><span class="si">%s</span><span class="s2"> reference.&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                    <span class="s2">&quot;A reference to the last </span><span class="si">%s</span><span class="s2"> was encountered but &quot;</span>
                    <span class="s2">&quot;no </span><span class="si">%s</span><span class="s2">s are defined.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">this_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="n">entity_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Reference to undefined </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">entity</span><span class="p">,</span>
                <span class="s1">&#39;A reference to </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; was encountered but is not &#39;</span>
                <span class="s2">&quot;defined in the model.  There are </span><span class="si">%d</span><span class="s2"> defined </span><span class="si">%s</span><span class="s2">s: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">this_id</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">),</span> <span class="n">entity</span><span class="p">,</span> <span class="n">entity_list</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">id_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">this_id</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.get_element_field_values"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_field_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_field_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of element field values.</span>

<span class="sd">        The actual list of values is returned, so any modifications to it will</span>
<span class="sd">        be stored in the model.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_field_values(&#39;strain&#39;, element_block_id=1)</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_field_values(&#39;strain&#39;, timestep=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_field_values(&#39;strain&#39;,</span>
<span class="sd">        ...                                element_block_id=5,</span>
<span class="sd">        ...                                timestep=&#39;last&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_field_name</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(),</span>
            <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
            <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_missing_on_entity_error</span><span class="p">(</span>
                <span class="n">element_field_name</span><span class="p">,</span> <span class="s2">&quot;element field&quot;</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="s2">&quot;element block&quot;</span>
            <span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.get_side_set_field_values"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_side_set_field_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_field_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">side_set_field_name</span><span class="p">,</span> <span class="n">side_set_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of side set field values.</span>

<span class="sd">        The actual list of values is returned, so any modifications to it will</span>
<span class="sd">        be stored in the model.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_side_set_field_values(&#39;contact_pressure&#39;, side_set_id=1)</span>
<span class="sd">        &gt;&gt;&gt; model.get_side_set_field_values(&#39;contact_pressure&#39;, timestep=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.get_side_set_field_values(&#39;contact_pressure&#39;,</span>
<span class="sd">        ...                                 side_set_id=5,</span>
<span class="sd">        ...                                 timestep=&#39;last&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">([</span><span class="n">side_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">[</span><span class="n">side_set_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">side_set_field_name</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">(),</span>
            <span class="s2">&quot;side set field&quot;</span><span class="p">,</span>
            <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_field_exists</span><span class="p">(</span><span class="n">side_set_field_name</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_missing_on_entity_error</span><span class="p">(</span>
                <span class="n">side_set_field_name</span><span class="p">,</span> <span class="s2">&quot;side set field&quot;</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">,</span> <span class="s2">&quot;side set&quot;</span>
            <span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fields</span><span class="p">[</span><span class="n">side_set_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.get_node_set_field_values"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_node_set_field_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_field_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_set_field_name</span><span class="p">,</span> <span class="n">node_set_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of node set field values.</span>

<span class="sd">        The actual list of values is returned, so any modifications to it will</span>
<span class="sd">        be stored in the model.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_set_field_values(&#39;contact_pressure&#39;, node_set_id=1)</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_set_field_values(&#39;contact_pressure&#39;, timestep=2.0)</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_set_field_values(&#39;contact_pressure&#39;,</span>
<span class="sd">        ...                                 node_set_id=5,</span>
<span class="sd">        ...                                 timestep=&#39;last&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">([</span><span class="n">node_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">[</span><span class="n">node_set_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">node_set_field_name</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">(),</span>
            <span class="s2">&quot;node set field&quot;</span><span class="p">,</span>
            <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set_field_exists</span><span class="p">(</span><span class="n">node_set_field_name</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_missing_on_entity_error</span><span class="p">(</span>
                <span class="n">node_set_field_name</span><span class="p">,</span> <span class="s2">&quot;node set field&quot;</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">,</span> <span class="s2">&quot;node set&quot;</span>
            <span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fields</span><span class="p">[</span><span class="n">node_set_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_is_standard_element_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return &#39;True&#39; if &#39;element_type&#39; is a standard element type.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STANDARD_ELEMENT_TYPES</span>

<div class="viewcode-block" id="ExodusModel.get_element_block_ids"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_block_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_block_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all element block ids.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_block_ids()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="ExodusModel.get_element_block_name"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_block_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_block_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the given element block name.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_block_names()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.get_all_element_block_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_all_element_block_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_element_block_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all element block names.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_all_element_block_names()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">_get_standard_element_block_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of element block ids which use standard element types.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._get_standard_element_block_ids()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_standard_element_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.get_node_set_ids"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_node_set_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all node set ids.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_set_ids()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="ExodusModel.get_side_set_ids"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_side_set_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all side set ids.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_side_set_ids()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="ExodusModel.get_node_field_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_node_field_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all node field names.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_field_names()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_field_names</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>

<div class="viewcode-block" id="ExodusModel.get_node_set_field_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_node_set_field_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all node set field names.</span>

<span class="sd">        By default, this returns node set fields which are defined on any</span>
<span class="sd">        node set.  To return fields which are defined on a particular</span>
<span class="sd">        node set, pass a node set id.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_set_field_names()</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_set_field_names(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">id_</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_field_names</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExodusModel.get_side_set_field_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_side_set_field_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all side set field names.</span>

<span class="sd">        By default, this returns side set fields which are defined on any</span>
<span class="sd">        side set.  To return fields which are defined on a particular</span>
<span class="sd">        side set, pass a side set id.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_side_set_field_names()</span>
<span class="sd">        &gt;&gt;&gt; model.get_side_set_field_names(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_field_names</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExodusModel.get_element_field_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_field_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all element field names.</span>

<span class="sd">        By default, this returns element fields which are defined on any</span>
<span class="sd">        element block.  To return fields which are defined on a particular</span>
<span class="sd">        element block, pass an element block id.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_field_names()</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_field_names(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">id_</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_field_names</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExodusModel.get_global_variable_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_global_variable_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all global variable names.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_global_variable_names()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_field_names</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>

<div class="viewcode-block" id="ExodusModel.get_timesteps"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_timesteps">[docs]</a>    <span class="k">def</span> <span class="nf">get_timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all timesteps.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_timesteps()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_internal_timestep_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the local timestep index.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_element_field_truth_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">field_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the element field truth table.</span>

<span class="sd">        The element field truth table defines which element fields are defined</span>
<span class="sd">        for which element blocks according to the given order of element block</span>
<span class="sd">        ids and field names passed in.  This is needed within the ExodusII</span>
<span class="sd">        file format.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># go through each case and set values to True if they exist</span>
        <span class="n">truth_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_names</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">truth_table</span>

    <span class="k">def</span> <span class="nf">_create_side_set_field_truth_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="p">,</span> <span class="n">field_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the side set field truth table.</span>

<span class="sd">        The side set field truth table defines which side set fields are</span>
<span class="sd">        defined for which side sets according to the given order of side set</span>
<span class="sd">        ids and field names passed in.  This is needed within the ExodusII</span>
<span class="sd">        file format.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># go through each case and set values to True if they exist</span>
        <span class="n">truth_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">side_set_field_exists</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_names</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">truth_table</span>

    <span class="k">def</span> <span class="nf">_create_node_set_field_truth_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="p">,</span> <span class="n">field_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the node set field truth table.</span>

<span class="sd">        The node set field truth table defines which node set fields are</span>
<span class="sd">        defined for which node sets according to the given order of node set</span>
<span class="sd">        ids and field names passed in.  This is needed within the ExodusII</span>
<span class="sd">        file format.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># go through each case and set values to True if they exist</span>
        <span class="n">truth_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_set_field_exists</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_names</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">truth_table</span>

<div class="viewcode-block" id="ExodusModel.get_connectivity"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_connectivity">[docs]</a>    <span class="k">def</span> <span class="nf">get_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the connectivity list of an element block.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_connectivity(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.get_element_block_connectivity"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_block_connectivity">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_block_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for &#39;get_connectivity()&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.get_nodes_in_element_block"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_nodes_in_element_block">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_in_element_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all node indices used in the given element blocks.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_nodes_in_element_block(1)</span>
<span class="sd">        &gt;&gt;&gt; model.get_nodes_in_element_block([1, 3])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">node_list</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_rotate_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">,</span>
        <span class="n">angle_in_degrees</span><span class="p">,</span>
        <span class="n">node_indices</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotate nodes about an axis by the given angle.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">adjust_displacement_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_field_exists</span><span class="p">()</span>
        <span class="c1"># Create rotation matrix.</span>
        <span class="c1"># x --&gt; R * x</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">axis</span><span class="p">))</span>
        <span class="p">(</span><span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">axis</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">angle_in_degrees</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">sint</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="c1"># if angle_in_degrees is a multiple of 90 degrees, then make sin and</span>
        <span class="c1"># cos exactly 0, 1, or -1 to avoid roundoff errors.</span>
        <span class="k">if</span> <span class="n">angle_in_degrees</span> <span class="o">%</span> <span class="mi">90</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sint</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sint</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">cost</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">rxx</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span>
        <span class="n">rxy</span> <span class="o">=</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span> <span class="o">-</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">sint</span>
        <span class="n">rxz</span> <span class="o">=</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">sint</span>
        <span class="n">ryx</span> <span class="o">=</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span> <span class="o">+</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">sint</span>
        <span class="n">ryy</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span>
        <span class="n">ryz</span> <span class="o">=</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span> <span class="o">-</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">sint</span>
        <span class="n">rzx</span> <span class="o">=</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span> <span class="o">-</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">sint</span>
        <span class="n">rzy</span> <span class="o">=</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">sint</span>
        <span class="n">rzz</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">+</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cost</span><span class="p">)</span>
        <span class="c1"># Rotate nodes.</span>
        <span class="k">if</span> <span class="n">node_indices</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">rxx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rxy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">rxz</span> <span class="o">*</span> <span class="n">z</span><span class="p">,</span>
                    <span class="n">ryx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">ryy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">ryz</span> <span class="o">*</span> <span class="n">z</span><span class="p">,</span>
                    <span class="n">rzx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rzy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">rzz</span> <span class="o">*</span> <span class="n">z</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">rxx</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rxy</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rxz</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">ryx</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ryy</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ryz</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">rzx</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rzy</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rzz</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">]</span>
        <span class="c1"># Rotate the displacement field.</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span><span class="p">:</span>
            <span class="p">(</span><span class="n">disp_x</span><span class="p">,</span> <span class="n">disp_y</span><span class="p">,</span> <span class="n">disp_z</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_values</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">node_indices</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                    <span class="n">new_disp_x</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">rxx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rxy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">rxz</span> <span class="o">*</span> <span class="n">z</span>
                        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                            <span class="n">disp_x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                            <span class="n">disp_y</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                            <span class="n">disp_z</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">new_disp_y</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">ryx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">ryy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">ryz</span> <span class="o">*</span> <span class="n">z</span>
                        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                            <span class="n">disp_x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                            <span class="n">disp_y</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                            <span class="n">disp_z</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">new_disp_z</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">rzx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rzy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">rzz</span> <span class="o">*</span> <span class="n">z</span>
                        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                            <span class="n">disp_x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                            <span class="n">disp_y</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                            <span class="n">disp_z</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">disp_x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_disp_x</span>
                    <span class="n">disp_y</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_disp_y</span>
                    <span class="n">disp_z</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_disp_z</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">disp_x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">disp_y</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                        <span class="n">z</span> <span class="o">=</span> <span class="n">disp_z</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">rxx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rxy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">rxz</span> <span class="o">*</span> <span class="n">z</span><span class="p">,</span>
                            <span class="n">ryx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">ryy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">ryz</span> <span class="o">*</span> <span class="n">z</span><span class="p">,</span>
                            <span class="n">rzx</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rzy</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">rzz</span> <span class="o">*</span> <span class="n">z</span><span class="p">,</span>
                        <span class="p">]</span>
                        <span class="n">disp_x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="n">disp_y</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="n">disp_z</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">_translate_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">node_indices</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate nodes by the given offset.&quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">offset</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">node_indices</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="n">dz</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dx</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dz</span>

    <span class="k">def</span> <span class="nf">_scale_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">node_indices</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale nodes in the list by the given scale factor.&quot;&quot;&quot;</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale_factor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">adjust_displacement_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_field_exists</span><span class="p">()</span>
        <span class="c1"># Scale the nodal coordinates.</span>
        <span class="k">if</span> <span class="n">node_indices</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="c1"># Scale the displacement field.</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node_indices</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                        <span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
                            <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_factor</span>

<div class="viewcode-block" id="ExodusModel.rotate_geometry"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rotate_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle_in_degrees</span><span class="p">,</span> <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate the model about an axis by the given angle.</span>

<span class="sd">        The rotation axis includes the origin and points in the direction of</span>
<span class="sd">        the &#39;axis&#39; parameter.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rotate_geometry([1, 0, 0], 90)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_nodes</span><span class="p">(</span>
            <span class="n">axis</span><span class="p">,</span> <span class="n">angle_in_degrees</span><span class="p">,</span> <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="n">adjust_displacement_field</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.translate_geometry"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.translate_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">translate_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translate the model by the given offset.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.translate_geometry([1, 2, 3])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_nodes</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.scale_geometry"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.scale_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">scale_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale the model by the given factor.</span>

<span class="sd">        By default, if it exists, the displacement field will also be scaled</span>
<span class="sd">        accordingly.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.scale_geometry(0.0254)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_nodes</span><span class="p">(</span>
            <span class="n">scale_factor</span><span class="p">,</span> <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="n">adjust_displacement_field</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_ensure_no_shared_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure no nodes are shared outside the given element blocks.</span>

<span class="sd">        If nodes are shared between the given element blocks and all</span>
<span class="sd">        other element block then an error message is output.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">affected_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">nodes_in_other_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">shared_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">affected_nodes</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">nodes_in_other_blocks</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">shared_nodes</span><span class="p">:</span>
            <span class="n">max_nodes_to_display</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">node_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shared_nodes</span><span class="p">[:</span><span class="n">max_nodes_to_display</span><span class="p">]])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_nodes_to_display</span><span class="p">:</span>
                <span class="n">node_list</span> <span class="o">+=</span> <span class="s2">&quot;, ...&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Unable to operate on merged nodes.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;You are attempting to operate on some element blocks &quot;</span>
                <span class="s2">&quot;while keeping others unaffected.  Because some nodes &quot;</span>
                <span class="s2">&quot;are shared between the two groups, this cannot be &quot;</span>
                <span class="s2">&quot;done.  Use unmerge_element_blocks() to unmerge the &quot;</span>
                <span class="s2">&quot;blocks if that is desired.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> shared nodes: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shared_nodes</span><span class="p">),</span> <span class="n">node_list</span><span class="p">),</span>
            <span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.translate_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.translate_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">translate_element_blocks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">check_for_merged_nodes</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translate the specified element blocks by the given offset.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.translate_element_blocks(1, [1.0, 2.0, 3.0])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_for_merged_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_no_shared_nodes</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">affected_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_nodes</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">affected_nodes</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.reflect_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.reflect_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">reflect_element_blocks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="p">,</span>
        <span class="n">point</span><span class="p">,</span>
        <span class="n">normal</span><span class="p">,</span>
        <span class="n">check_for_merged_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reflect the specified element blocks about the given plane.</span>

<span class="sd">        Since an element becomes inverted when it is reflected across a plane,</span>
<span class="sd">        this function will also uninvert the elements.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.reflect_element_blocks(1, [0, 0, 0], [1, 0, 0])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">adjust_displacement_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_field_exists</span><span class="p">()</span>
        <span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">point</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">))</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">check_for_merged_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_no_shared_nodes</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">affected_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">affected_nodes</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">point</span><span class="p">,</span> <span class="n">normal</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">a</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">normal</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="c1"># adjust displacement fields</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span><span class="p">:</span>
            <span class="n">displacement_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_values</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">affected_nodes</span><span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">displacement_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="n">displacement_fields</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">dz</span> <span class="o">=</span> <span class="n">displacement_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">dx</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">dy</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dz</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">displacement_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx</span>
                    <span class="n">displacement_fields</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dy</span>
                    <span class="n">displacement_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dz</span>
        <span class="c1"># uninvert elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invert_element_blocks</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.scale_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.scale_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">scale_element_blocks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="p">,</span>
        <span class="n">scale_factor</span><span class="p">,</span>
        <span class="n">check_for_merged_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale all nodes in the given element blocks by the given amount.</span>

<span class="sd">        By default, if a displacement field exists, this will also scale the</span>
<span class="sd">        displacement field.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.scale_element_blocks(1, 0.0254)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">adjust_displacement_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_field_exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">check_for_merged_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_no_shared_nodes</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">affected_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_nodes</span><span class="p">(</span>
            <span class="n">scale_factor</span><span class="p">,</span>
            <span class="n">affected_nodes</span><span class="p">,</span>
            <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="n">adjust_displacement_field</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.rotate_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rotate_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_element_blocks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">,</span>
        <span class="n">angle_in_degrees</span><span class="p">,</span>
        <span class="n">check_for_merged_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate all nodes in the given element blocks by the given amount.</span>

<span class="sd">        By default, if a displacement field exists, this will also rotate the</span>
<span class="sd">        displacement field.</span>

<span class="sd">        The rotation axis includes the origin and points in the direction of</span>
<span class="sd">        the &#39;axis&#39; parameter.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rotate_element_blocks(1, [1, 0, 0], 90)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adjust_displacement_field</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">adjust_displacement_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_field_exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">check_for_merged_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_no_shared_nodes</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">affected_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_nodes</span><span class="p">(</span>
            <span class="n">axis</span><span class="p">,</span>
            <span class="n">angle_in_degrees</span><span class="p">,</span>
            <span class="n">affected_nodes</span><span class="p">,</span>
            <span class="n">adjust_displacement_field</span><span class="o">=</span><span class="n">adjust_displacement_field</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.displace_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.displace_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">displace_element_blocks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">check_for_merged_nodes</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displace all nodes in the given element blocks.</span>

<span class="sd">        This function operates on the displacement field rather than the model</span>
<span class="sd">        coordinate field.  To operate on the model coordinates, use</span>
<span class="sd">        &#39;translate_element_blocks()&#39;.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.displace_element_blocks(1, [1.0, 2.0, 3.0])</span>
<span class="sd">        &gt;&gt;&gt; model.displace_element_blocks(&#39;all&#39;, [1.0, 2.0, 3.0])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_for_merged_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_no_shared_nodes</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">timestep_indices</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">timesteps</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">offset</span><span class="p">]</span>
        <span class="c1"># if no timesteps exist, issue an error</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;No timesteps defined&quot;</span><span class="p">,</span>
                <span class="s2">&quot;A displacement field cannot exist if no timesteps &quot;</span>
                <span class="s2">&quot;are defined.  To avoid this error, create a timestep &quot;</span>
                <span class="s2">&quot;before calling this function.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># get displacement field indices</span>
        <span class="n">displacement_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_displacement_field_values</span><span class="p">()</span>
        <span class="c1"># get affected nodes</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># translate nodes</span>
        <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">displacement_fields</span><span class="p">[</span><span class="n">dimension</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offset</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_rename_field_on_entity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">field_type</span><span class="p">,</span>
        <span class="n">field_name</span><span class="p">,</span>
        <span class="n">new_field_name</span><span class="p">,</span>
        <span class="n">field_name_list_function</span><span class="p">,</span>
        <span class="n">entity_type</span><span class="p">,</span>
        <span class="n">entity_list</span><span class="p">,</span>
        <span class="n">entity_list_function</span><span class="p">,</span>
        <span class="n">entity_objects</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename a field defined on an entity.&quot;&quot;&quot;</span>
        <span class="n">entity_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">entity_list</span><span class="p">,</span> <span class="n">entity_list_function</span><span class="p">(),</span> <span class="n">entity_type</span>
        <span class="p">)</span>
        <span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">field_name</span><span class="p">],</span> <span class="n">field_name_list_function</span><span class="p">(</span><span class="n">entity_list</span><span class="p">),</span> <span class="n">field_type</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">entity_list</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">entity_objects</span><span class="p">[</span><span class="n">id_</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="n">field_type</span> <span class="o">+</span> <span class="s2">&quot; not defined.&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;The given </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; is not &#39;</span>
                    <span class="s2">&quot;defined on </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">.  It cannot &quot;</span>
                    <span class="s2">&quot;be renamed.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">id_</span><span class="p">)),</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="n">new_field_name</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">new_field_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_on_entity_warning</span><span class="p">(</span>
                    <span class="n">new_field_name</span><span class="p">,</span> <span class="n">field_type</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">entity_type</span>
                <span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">new_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.rename_element_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_element_field">[docs]</a>    <span class="k">def</span> <span class="nf">rename_element_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_field_name</span><span class="p">,</span> <span class="n">new_element_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename an element field.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_element_field(&#39;p&#39;, &#39;pressure&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_field_on_entity</span><span class="p">(</span>
            <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
            <span class="n">element_field_name</span><span class="p">,</span>
            <span class="n">new_element_field_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">,</span>
            <span class="s2">&quot;element block&quot;</span><span class="p">,</span>
            <span class="n">element_block_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.rename_side_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_side_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">rename_side_set_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">side_set_field_name</span><span class="p">,</span> <span class="n">new_side_set_field_name</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename a side set field.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_side_set_field(&#39;cp&#39;, &#39;contact_pressure&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_field_on_entity</span><span class="p">(</span>
            <span class="s2">&quot;side set field&quot;</span><span class="p">,</span>
            <span class="n">side_set_field_name</span><span class="p">,</span>
            <span class="n">new_side_set_field_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">,</span>
            <span class="s2">&quot;side set&quot;</span><span class="p">,</span>
            <span class="n">side_set_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.get_side_set_name"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_side_set_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the name of a side set.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">([</span><span class="n">side_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">[</span><span class="n">side_set_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.get_all_side_set_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_all_side_set_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_side_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all side set names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="ExodusModel.get_side_set_members"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_side_set_members">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the members of a side set.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">([</span><span class="n">side_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">[</span><span class="n">side_set_id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_side_set_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dictionary of side set fields.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">([</span><span class="n">side_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">[</span><span class="n">side_set_id</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.rename_node_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_node_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">rename_node_set_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_set_field_name</span><span class="p">,</span> <span class="n">new_node_set_field_name</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename a node set field.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_node_set_field(&#39;cp&#39;, &#39;contact_pressure&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_field_on_entity</span><span class="p">(</span>
            <span class="s2">&quot;node set field&quot;</span><span class="p">,</span>
            <span class="n">node_set_field_name</span><span class="p">,</span>
            <span class="n">new_node_set_field_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">,</span>
            <span class="s2">&quot;node set&quot;</span><span class="p">,</span>
            <span class="n">node_set_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_rename_entity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">entity_type</span><span class="p">,</span>
        <span class="n">entity_name</span><span class="p">,</span>
        <span class="n">new_entity_name</span><span class="p">,</span>
        <span class="n">entity_name_list_function</span><span class="p">,</span>
        <span class="n">entity_objects</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename an entity.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">entity_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">entity_name</span><span class="p">],</span> <span class="n">entity_name_list_function</span><span class="p">(),</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">new_entity_name</span> <span class="o">==</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">new_entity_name</span> <span class="ow">in</span> <span class="n">entity_name_list_function</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">new_entity_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>
        <span class="n">entity_objects</span><span class="p">[</span><span class="n">new_entity_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_objects</span><span class="p">[</span><span class="n">entity_name</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">entity_objects</span><span class="p">[</span><span class="n">entity_name</span><span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.rename_node_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_node_field">[docs]</a>    <span class="k">def</span> <span class="nf">rename_node_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_field_name</span><span class="p">,</span> <span class="n">new_node_field_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename a node field.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_node_field(&#39;temp&#39;, &#39;temperature&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_entity</span><span class="p">(</span>
            <span class="s2">&quot;node field&quot;</span><span class="p">,</span>
            <span class="n">node_field_name</span><span class="p">,</span>
            <span class="n">new_node_field_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.rename_global_variable"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_global_variable">[docs]</a>    <span class="k">def</span> <span class="nf">rename_global_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_variable_name</span><span class="p">,</span> <span class="n">new_global_variable_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename a global variable.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_global_variable(&#39;ke&#39;, &#39;kinetic_energy&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_entity</span><span class="p">(</span>
            <span class="s2">&quot;global variable&quot;</span><span class="p">,</span>
            <span class="n">global_variable_name</span><span class="p">,</span>
            <span class="n">new_global_variable_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.rename_element_block"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_element_block">[docs]</a>    <span class="k">def</span> <span class="nf">rename_element_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">new_element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change an element block id or name.</span>

<span class="sd">        This function can be used to change either the element block id or</span>
<span class="sd">        name.  If &#39;new_element_block_id&#39; is an integer, it will change the id.</span>
<span class="sd">        If it is a string, it will change the name.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_element_block(1, 100)</span>
<span class="sd">        &gt;&gt;&gt; model.rename_element_block(1, &#39;block_1&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="c1"># if we&#39;re just changing the name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># if the same name already, just exit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_element_block_id</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1"># if the name already exists, issue a warning</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_block_exists</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">new_element_block_id</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;element block&quot;</span><span class="p">)</span>
            <span class="c1"># rename it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_element_block_id</span>
            <span class="k">return</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="c1"># rename the block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_entity</span><span class="p">(</span>
            <span class="s2">&quot;element block&quot;</span><span class="p">,</span>
            <span class="n">element_block_id</span><span class="p">,</span>
            <span class="n">new_element_block_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># adjust side sets</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">new_members</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">element_block_id</span><span class="p">:</span>
                    <span class="n">member</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_element_block_id</span>
                    <span class="n">member</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                <span class="n">new_members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
            <span class="n">members</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">new_members</span></div>

<div class="viewcode-block" id="ExodusModel.rename_node_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_node_set">[docs]</a>    <span class="k">def</span> <span class="nf">rename_node_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">,</span> <span class="n">new_node_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change a node set id or name.</span>

<span class="sd">        This function can be used to change either the node set id or name.</span>
<span class="sd">        If &#39;new_node_set_id&#39; is an integer, it will change the id. If it is a</span>
<span class="sd">        string, it will change the name.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_node_set(1, 100)</span>
<span class="sd">        &gt;&gt;&gt; model.rename_node_set(1, &#39;node_group_1&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">([</span><span class="n">node_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># if we&#39;re just changing the name:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_node_set_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># if the same name already, just exit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_name</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">new_node_set_id</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1"># if the name already exists, issue a warning</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set_exists</span><span class="p">(</span><span class="n">new_node_set_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">new_node_set_id</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;node set&quot;</span><span class="p">)</span>
            <span class="c1"># rename it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">node_set_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_node_set_id</span>
            <span class="k">return</span>
        <span class="c1"># rename it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_entity</span><span class="p">(</span>
            <span class="s2">&quot;node set&quot;</span><span class="p">,</span>
            <span class="n">node_set_id</span><span class="p">,</span>
            <span class="n">new_node_set_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.rename_side_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.rename_side_set">[docs]</a>    <span class="k">def</span> <span class="nf">rename_side_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">,</span> <span class="n">new_side_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change a side set id or name.</span>

<span class="sd">        This function can be used to change either the side set id or name.</span>
<span class="sd">        If &#39;new_side_set_id&#39; is an integer, it will change the id. If it is a</span>
<span class="sd">        string, it will change the name.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.rename_side_set(1, 100)</span>
<span class="sd">        &gt;&gt;&gt; model.rename_side_set(1, &#39;surface_1&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">([</span><span class="n">side_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># if we&#39;re just changing the name:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_side_set_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># if the same name already, just exit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_name</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">new_side_set_id</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1"># if the name already exists, issue a warning</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_exists</span><span class="p">(</span><span class="n">new_side_set_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">new_side_set_id</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;side set&quot;</span><span class="p">)</span>
            <span class="c1"># rename it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">[</span><span class="n">side_set_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_side_set_id</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rename_entity</span><span class="p">(</span>
            <span class="s2">&quot;side set&quot;</span><span class="p">,</span>
            <span class="n">side_set_id</span><span class="p">,</span>
            <span class="n">new_side_set_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_empty_field_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a warning if no timesteps exist.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
            <span class="s2">&quot;Creating an empty field&quot;</span><span class="p">,</span>
            <span class="s2">&quot;No timesteps are defined.  Because fields are only &quot;</span>
            <span class="s2">&quot;defined at each timestep, creating a field when no &quot;</span>
            <span class="s2">&quot;timesteps are defined will allow let the field to &quot;</span>
            <span class="s2">&quot;have any values.  By default, empty fields are not &quot;</span>
            <span class="s2">&quot;exported.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;To avoid this warning, create a timestep before &quot;</span>
            <span class="s2">&quot;creating a field.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.create_element_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_element_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_element_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an element field on one or more element blocks.</span>

<span class="sd">        A default value can be passed.  If no default value is given, 0.0 will</span>
<span class="sd">        be used if the element field appears to be a displacement field.</span>
<span class="sd">        Otherwise, NaN will be used.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_element_field(&#39;eqps&#39;, value=0.0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># warn if no timesteps are present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_empty_field_warning</span><span class="p">()</span>
        <span class="c1"># get list of block ids</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># get the value to assign</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">)</span>
        <span class="c1"># for each block</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="c1"># if it exists, no need to do anything</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_on_entity_warning</span><span class="p">(</span>
                    <span class="n">element_field_name</span><span class="p">,</span>
                    <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
                    <span class="n">element_block_id</span><span class="p">,</span>
                    <span class="s2">&quot;element block&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># get the element block info</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="c1"># create an empty field</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">element_count</span><span class="p">)</span>
            <span class="c1"># add the field</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="ExodusModel.create_node_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_node_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_node_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_field_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a node field and assign it a default value.</span>

<span class="sd">        A default value can be passed.  If no default value is given, 0.0 will</span>
<span class="sd">        be used if the element field appears to be a displacement field.</span>
<span class="sd">        Otherwise, NaN will be used.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_node_field(&#39;temperature&#39;, 298.15)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># issue warning if no timesteps exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_empty_field_warning</span><span class="p">()</span>
        <span class="c1"># if it exists, no need to do anything</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_field_exists</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">,</span> <span class="s2">&quot;node field&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># get the value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">)</span>
        <span class="c1"># create the new field</span>
        <span class="n">new_field_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
            <span class="n">new_field_values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_field_values</span></div>

<div class="viewcode-block" id="ExodusModel.create_node_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_node_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_node_set_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_set_field_name</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a node set field on the given node sets.</span>

<span class="sd">        A default value can be passed.  If no default value is given, 0.0 will</span>
<span class="sd">        be used if the element field appears to be a displacement field.</span>
<span class="sd">        Otherwise, NaN will be used.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_node_set_field(&#39;temperature&#39;, 13, 298.15)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">node_set_field_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="c1"># if it exists, warn about overwriting</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set_field_exists</span><span class="p">(</span><span class="n">node_set_field_name</span><span class="p">,</span> <span class="p">[</span><span class="n">node_set_id</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_on_entity_warning</span><span class="p">(</span>
                    <span class="n">node_set_field_name</span><span class="p">,</span> <span class="s2">&quot;node set field&quot;</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">,</span> <span class="s2">&quot;node set&quot;</span>
                <span class="p">)</span>
            <span class="c1"># create the new field</span>
            <span class="n">new_field_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">new_field_values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">member_count</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">node_set_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_field_values</span></div>

<div class="viewcode-block" id="ExodusModel.create_side_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_side_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_side_set_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">side_set_field_name</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a side set field.</span>

<span class="sd">        By default the field will be created on all side sets.  To create a</span>
<span class="sd">        side set field on a particular field, pass in &#39;side_set_ids&#39;.</span>

<span class="sd">        To set the value of the field, pass in &#39;value&#39;.  By default this is</span>
<span class="sd">        0 for displacement fields and NaN for all other fields.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_side_set_field(&#39;temperature&#39;, 13, 298.15)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">side_set_field_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="c1"># if it exists, warn about overwriting</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_field_exists</span><span class="p">(</span><span class="n">side_set_field_name</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_on_entity_warning</span><span class="p">(</span>
                    <span class="n">side_set_field_name</span><span class="p">,</span> <span class="s2">&quot;side set field&quot;</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">,</span> <span class="s2">&quot;side set&quot;</span>
                <span class="p">)</span>
            <span class="c1"># create the new field</span>
            <span class="n">new_field_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">new_field_values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">member_count</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">side_set_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_field_values</span></div>

<div class="viewcode-block" id="ExodusModel.create_node_set_from_side_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_node_set_from_side_set">[docs]</a>    <span class="k">def</span> <span class="nf">create_node_set_from_side_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a node set from a side set.</span>

<span class="sd">        The created node set will contain all nodes used by faces in the given</span>
<span class="sd">        side set.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_node_set_from_side_set(1, 1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_set_members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_node_set</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">,</span> <span class="n">node_set_members</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_duplicates</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="n">other_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preserve_order</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list with duplicates removed.</span>

<span class="sd">        If &#39;other_list&#39; is used, this will also remove items which appear in</span>
<span class="sd">        that list.</span>

<span class="sd">        To preserve the relative order of items, set &#39;preserve_order=True&#39;.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; _remove_duplicates([1, 3, 2, 3])</span>
<span class="sd">        [1, 3, 2]</span>
<span class="sd">        &gt;&gt;&gt; _remove_duplicates([1, 3, 2, 3], [3])</span>
<span class="sd">        [1, 2]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">preserve_order</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">other_list</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">item_list</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">item_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">other_list</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">other_list</span><span class="p">:</span>
            <span class="n">appeared</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">other_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">appeared</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">unique_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">appeared</span><span class="p">:</span>
                <span class="n">unique_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">appeared</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique_list</span>

<div class="viewcode-block" id="ExodusModel.create_node_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_node_set">[docs]</a>    <span class="k">def</span> <span class="nf">create_node_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">,</span> <span class="n">node_set_members</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a node side from the list of node indices.</span>

<span class="sd">        Node sets are unnamed when created.  To name them, use the</span>
<span class="sd">        &#39;rename_node_set&#39; function.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_node_set(1, [0, 1, 2, 3])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if it exists, warn that it will be overwritten</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set_exists</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">,</span> <span class="s2">&quot;node set&quot;</span><span class="p">)</span>
        <span class="c1"># reformat members if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_set_members</span><span class="p">:</span>
            <span class="n">node_set_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># do not allow duplicates</span>
        <span class="n">new_members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicates</span><span class="p">(</span><span class="n">node_set_members</span><span class="p">,</span> <span class="n">preserve_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_members</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_set_members</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicate nodes in set.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The node set member list contains multiple copies &quot;</span>
                <span class="s2">&quot;of some nodes.  These nodes will only be added &quot;</span>
                <span class="s2">&quot;once.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># add the new set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">new_members</span><span class="p">,</span> <span class="p">{}]</span></div>

<div class="viewcode-block" id="ExodusModel.add_nodes_to_node_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.add_nodes_to_node_set">[docs]</a>    <span class="k">def</span> <span class="nf">add_nodes_to_node_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">,</span> <span class="n">new_node_set_members</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add nodes to an existing node set.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.add_nodes_to_node_set(1, [4, 5, 6, 7])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set_exists</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Node set does not exist.&quot;</span>
                <span class="s1">&#39;The specified node set &quot;</span><span class="si">%s% d</span><span class="s1">oes not exist.  It &#39;</span>
                <span class="s2">&quot;will be created.&quot;</span> <span class="o">%</span> <span class="n">node_set_id</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_node_set</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">,</span> <span class="n">new_node_set_members</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
        <span class="c1"># Remove duplicate nodes.</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicates</span><span class="p">(</span>
            <span class="n">new_node_set_members</span><span class="p">,</span> <span class="n">other_list</span><span class="o">=</span><span class="n">members</span><span class="p">,</span> <span class="n">preserve_order</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_node_set_members</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicates nodes in set&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The node set already contains some of the nodes &quot;</span>
                <span class="s2">&quot;in the list.  These members will not be &quot;</span>
                <span class="s2">&quot;duplicated.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># Add the members.</span>
        <span class="n">members</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span>
        <span class="c1"># Add new values to each field.</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_transform_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform the expression into one that evaluates to 0 when true.</span>

<span class="sd">        For example, &#39;x=y&#39; becomes &#39;(x)-(y)&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create transformation dictionary by precedence order</span>
        <span class="n">transforms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;min(abs(L), abs(R))&quot;</span><span class="p">))</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;max(abs(L), abs(R))&quot;</span><span class="p">))</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;((L) - (R)) - abs((L) - (R))&quot;</span><span class="p">))</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;((L) - (R)) - abs((L) - (R))&quot;</span><span class="p">))</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="s2">&quot;((R) - (L)) - abs((R) - (L))&quot;</span><span class="p">))</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;((R) - (L)) - abs((R) - (L))&quot;</span><span class="p">))</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;==&quot;</span><span class="p">,</span> <span class="s2">&quot;abs((L) - (R))&quot;</span><span class="p">))</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;abs((L) - (R))&quot;</span><span class="p">))</span>
        <span class="c1"># replace occurrences of each transform</span>
        <span class="k">for</span> <span class="n">separator</span><span class="p">,</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">separator</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
                <span class="c1"># ensure parenthesis count is identical</span>
                <span class="k">if</span> <span class="n">expression</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expression</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                        <span class="s2">&quot;Unbalances parenthesis.&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;We cannot transform the given expression &quot;</span>
                        <span class="s2">&quot;because it contains unbalanced &quot;</span>
                        <span class="s2">&quot;parenthesis:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expression</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="c1"># get parenthesis depth on each character</span>
                <span class="n">next_depth</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">expression</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                        <span class="n">depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_depth</span><span class="p">)</span>
                        <span class="n">next_depth</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
                        <span class="n">next_depth</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="n">depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_depth</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_depth</span><span class="p">)</span>
                <span class="c1"># find extents of the inner expression</span>
                <span class="n">separator_index</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
                <span class="n">left_index</span> <span class="o">=</span> <span class="n">separator_index</span>
                <span class="n">right_index</span> <span class="o">=</span> <span class="n">separator_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">left_index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">depth</span><span class="p">[</span><span class="n">left_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">depth</span><span class="p">[</span><span class="n">separator_index</span><span class="p">]</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">depth</span><span class="p">[</span><span class="n">left_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">depth</span><span class="p">[</span><span class="n">separator_index</span><span class="p">]</span>
                        <span class="ow">and</span> <span class="n">expression</span><span class="p">[</span><span class="n">left_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;,&quot;</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">left_index</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">right_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">depth</span><span class="p">[</span><span class="n">right_index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">depth</span><span class="p">[</span><span class="n">separator_index</span><span class="p">]</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">depth</span><span class="p">[</span><span class="n">right_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">depth</span><span class="p">[</span><span class="n">separator_index</span><span class="p">]</span>
                        <span class="ow">and</span> <span class="n">expression</span><span class="p">[</span><span class="n">right_index</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;,&quot;</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">right_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">new_expression</span> <span class="o">=</span> <span class="n">expression</span><span class="p">[:</span><span class="n">left_index</span><span class="p">]</span>
                <span class="n">left_expression</span> <span class="o">=</span> <span class="n">expression</span><span class="p">[</span><span class="n">left_index</span><span class="p">:</span><span class="n">separator_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">right_expression</span> <span class="o">=</span> <span class="n">expression</span><span class="p">[</span>
                    <span class="n">separator_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">separator</span><span class="p">):</span> <span class="n">right_index</span>
                <span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
                        <span class="n">new_expression</span> <span class="o">+=</span> <span class="n">left_expression</span>
                    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
                        <span class="n">new_expression</span> <span class="o">+=</span> <span class="n">right_expression</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_expression</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="n">new_expression</span> <span class="o">+=</span> <span class="n">expression</span><span class="p">[</span><span class="n">right_index</span><span class="p">:]</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">new_expression</span>
        <span class="c1"># return the result</span>
        <span class="k">return</span> <span class="n">expression</span>

<div class="viewcode-block" id="ExodusModel.create_side_set_from_expression"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_side_set_from_expression">[docs]</a>    <span class="k">def</span> <span class="nf">create_side_set_from_expression</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">side_set_id</span><span class="p">,</span>
        <span class="n">expression</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">timesteps</span><span class="o">=</span><span class="s2">&quot;last_if_any&quot;</span><span class="p">,</span>
        <span class="n">zero_member_warning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a side set from faces which satisfy an expression.</span>

<span class="sd">        Only external element faces of the given element blocks are checked.</span>

<span class="sd">        For example, if the model had a symmetry plane at &#39;Y = 0&#39;, the</span>
<span class="sd">        expression &#39;Y == 0&#39; would select all element faces on this plane.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_side_set_from_expression(1, &#39;Y == 0&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Too many timesteps specified.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;We were expecting zero or one timesteps but instead &quot;</span>
                <span class="s2">&quot;found </span><span class="si">%d</span><span class="s2"> specified.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">timesteps</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">tolerance</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_length_scale</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e-6</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_exists</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="s2">&quot;side set&quot;</span><span class="p">)</span>
        <span class="n">external_faces_by_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_element_faces_by_block</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_external_element_faces</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># create list of variable names and modify them in the expression</span>
        <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">timesteps</span><span class="p">:</span>
            <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">())</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">())</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="n">eval_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_eval_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">variable_names</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">function</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda var: &quot;</span> <span class="o">+</span> <span class="n">eval_expression</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timesteps</span><span class="p">:</span>
            <span class="n">var</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">external_faces</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">external_faces_by_block</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">))</span>
                <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">external_faces</span><span class="p">:</span>
                    <span class="n">node_indices</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="n">nodes_per_element</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="n">all_passed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
                        <span class="c1"># set coordinate values</span>
                        <span class="n">var</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">var</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">var</span><span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                        <span class="c1"># set node field values</span>
                        <span class="k">if</span> <span class="n">timesteps</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                                <span class="n">var</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">node_index</span><span class="p">]</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span><span class="p">:</span>
                            <span class="n">all_passed</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">all_passed</span><span class="p">:</span>
                        <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">id_</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error_evaluating_expression</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eval_expression</span><span class="p">),</span> <span class="n">var</span><span class="p">)</span>
        <span class="c1"># create the side set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">members</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zero_member_warning</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">members</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Empty side set.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;No external element faces satisfied the given &quot;</span>
                <span class="s2">&quot;expression.  An empty side set was created.&quot;</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.create_side_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_side_set">[docs]</a>    <span class="k">def</span> <span class="nf">create_side_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">,</span> <span class="n">side_set_members</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a side set from the given element faces.</span>

<span class="sd">        If the side set already exists, the faces will be added.</span>

<span class="sd">        side_set_members should be a list of tuples of the form:</span>
<span class="sd">        * &#39;(element_block_id, local_element_index, element_side_index)&#39;</span>

<span class="sd">        Side sets are unnamed when created.  To name them, use the</span>
<span class="sd">        &#39;rename_side_set&#39; function.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_side_set(1, [(1, 0, 1), (1, 0, 2)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">side_set_members</span><span class="p">:</span>
            <span class="n">side_set_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># ensure set set id doesn&#39;t exist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_exists</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="s2">&quot;side set&quot;</span><span class="p">)</span>
        <span class="n">unique_members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicates</span><span class="p">(</span><span class="n">side_set_members</span><span class="p">,</span> <span class="n">preserve_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_members</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">side_set_members</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicate faces in set.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The face set member list contains multiple copies &quot;</span>
                <span class="s2">&quot;of some faces.  These faces will only be added &quot;</span>
                <span class="s2">&quot;once.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">unique_members</span><span class="p">,</span> <span class="p">{}]</span></div>

<div class="viewcode-block" id="ExodusModel.add_faces_to_side_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.add_faces_to_side_set">[docs]</a>    <span class="k">def</span> <span class="nf">add_faces_to_side_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">,</span> <span class="n">new_side_set_members</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the given faces to the side set.</span>

<span class="sd">        The parameter &#39;new_side_set_members&#39; should be a list of tuples of the</span>
<span class="sd">        form:</span>
<span class="sd">        * &#39;(element_block_id, local_element_index, element_side_index)&#39;</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.add_faces_to_side_set(1, [(2, 0, 3), (3, 0, 4)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_exists</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Side set does not exist.&quot;</span>
                <span class="s1">&#39;The specified side set &quot;</span><span class="si">%s% d</span><span class="s1">oes not exist.  It &#39;</span>
                <span class="s2">&quot;will be created.&quot;</span> <span class="o">%</span> <span class="n">side_set_id</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">new_side_set_members</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="c1"># remove duplicate faces</span>
        <span class="n">new_members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicates</span><span class="p">(</span>
            <span class="n">new_side_set_members</span><span class="p">,</span> <span class="n">other_list</span><span class="o">=</span><span class="n">members</span><span class="p">,</span> <span class="n">preserve_order</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_members</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_side_set_members</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Duplicates faces in set&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The node set already contains some nodes of the &quot;</span>
                <span class="s2">&quot;faces in the list to add.  These members will not &quot;</span>
                <span class="s2">&quot;be duplicated.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># add the members</span>
        <span class="n">members</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_members</span><span class="p">)</span>
        <span class="c1"># add new values to each field</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_members</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExodusModel.delete_node_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_node_field">[docs]</a>    <span class="k">def</span> <span class="nf">delete_node_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_field_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more node fields.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_node_field(&#39;temperature&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.delete_node_field(&#39;all&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.delete_node_field(&#39;disp_*&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">(),</span> <span class="s2">&quot;node field&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">node_field_name</span> <span class="ow">in</span> <span class="n">node_field_names</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.delete_timestep"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">delete_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timesteps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more timesteps.</span>

<span class="sd">        Because fields are defined on each timestep, this also deletes field</span>
<span class="sd">        values for the corresponding timestep.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_timestep(0.0)</span>
<span class="sd">        &gt;&gt;&gt; model.delete_timestep(&#39;all&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="c1"># get list of deleted indices in descending order</span>
        <span class="n">deleted_indices</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">timesteps</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">deleted_indices</span><span class="p">:</span>
            <span class="c1"># process element fields</span>
            <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="c1"># process node fields</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="c1"># process side set fields</span>
            <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="c1"># process node set fields</span>
            <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="c1"># process global variables</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="c1"># delete the timestep</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.delete_element_block"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_element_block">[docs]</a>    <span class="k">def</span> <span class="nf">delete_element_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">delete_orphaned_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more element blocks.</span>

<span class="sd">        This will also delete any references to elements in that block in</span>
<span class="sd">        side sets.</span>

<span class="sd">        By default, this will delete any nodes that become unused as a result</span>
<span class="sd">        of deleting the element blocks.  To prevent this, set</span>
<span class="sd">        &#39;delete_orphaned_nodes=False&#39;.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_element_block(1)</span>
<span class="sd">        &gt;&gt;&gt; model.delete_element_block([1, 3, 4])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># if we&#39;re not deleting anything, skip some computations.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># find unreferenced nodes</span>
        <span class="k">if</span> <span class="n">delete_orphaned_nodes</span><span class="p">:</span>
            <span class="n">unreferenced_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_unreferenced_nodes</span><span class="p">()</span>
        <span class="c1"># delete the element blocks and associated data</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="c1"># delete the element block itself</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span>
            <span class="c1"># delete faces of that element block from side set</span>
            <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
                <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="c1"># find indices to delete</span>
                <span class="n">deleted_indices</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">id_</span> <span class="o">==</span> <span class="n">element_block_id</span><span class="p">:</span>
                        <span class="n">deleted_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="c1"># delete them from members</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">deleted_indices</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">members</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="c1"># delete them from the fields</span>
                <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">deleted_indices</span><span class="p">):</span>
                            <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1"># now find the new unreferenced nodes</span>
        <span class="k">if</span> <span class="n">delete_orphaned_nodes</span><span class="p">:</span>
            <span class="n">new_unreferenced_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_unreferenced_nodes</span><span class="p">()</span>
            <span class="n">nodes_to_delete</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">new_unreferenced_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">unreferenced_nodes</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">nodes_to_delete</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_nodes</span><span class="p">(</span><span class="n">nodes_to_delete</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.delete_element_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_element_field">[docs]</a>    <span class="k">def</span> <span class="nf">delete_element_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_field_names</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more element fields.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_element_field(&#39;eqps&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.delete_element_field(&#39;all&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">element_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(),</span> <span class="s2">&quot;element field&quot;</span>
        <span class="p">)</span>
        <span class="c1"># for each field</span>
        <span class="k">for</span> <span class="n">element_field_name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="n">any_deleted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># for each element block</span>
            <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">element_field_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">any_deleted</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">del</span> <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">any_deleted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Element field not defined.&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;The element field &quot;</span><span class="si">%s</span><span class="s1">&quot; was not defined on any &#39;</span>
                    <span class="s2">&quot;of the given element blocks.  It cannot be &quot;</span>
                    <span class="s2">&quot;deleted.&quot;</span> <span class="o">%</span> <span class="n">element_field_name</span><span class="p">,</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.delete_node_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_node_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">delete_node_set_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_field_names</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more node set fields.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_node_set_field(&#39;contact_pressure&#39;, 1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
        <span class="n">node_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_set_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">(),</span> <span class="s2">&quot;node set field&quot;</span>
        <span class="p">)</span>
        <span class="c1"># for each field</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">node_set_field_names</span><span class="p">:</span>
            <span class="n">any_deleted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># for each node set</span>
            <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">any_deleted</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">del</span> <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">any_deleted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Node set field not defined.&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;The node set field &quot;</span><span class="si">%s</span><span class="s1">&quot; was not defined on any &#39;</span>
                    <span class="s2">&quot;of the given node sets.  It cannot be &quot;</span>
                    <span class="s2">&quot;deleted.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.delete_side_set_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_side_set_field">[docs]</a>    <span class="k">def</span> <span class="nf">delete_side_set_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_field_names</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more side set fields.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_side_set_field(&#39;contact_pressure&#39;, 1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="n">side_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">side_set_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">(),</span> <span class="s2">&quot;side set field&quot;</span>
        <span class="p">)</span>
        <span class="c1"># for each field</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">side_set_field_names</span><span class="p">:</span>
            <span class="n">any_deleted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># for each node set</span>
            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">any_deleted</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">del</span> <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">any_deleted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Side set field not defined.&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;The side set field &quot;</span><span class="si">%s</span><span class="s1">&quot; was not defined on any &#39;</span>
                    <span class="s2">&quot;of the given side sets.  It cannot be &quot;</span>
                    <span class="s2">&quot;deleted.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.global_variable_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.global_variable_exists">[docs]</a>    <span class="k">def</span> <span class="nf">global_variable_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_variable_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the given global variable exists.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.global_variable_exists(&#39;timestep&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">global_variable_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span></div>

<div class="viewcode-block" id="ExodusModel.side_set_field_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.side_set_field_exists">[docs]</a>    <span class="k">def</span> <span class="nf">side_set_field_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_field_name</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the side set field exists on the side sets.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.side_set_field_exists(&#39;contact_pressure&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">side_set_field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ExodusModel.node_set_field_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.node_set_field_exists">[docs]</a>    <span class="k">def</span> <span class="nf">node_set_field_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_field_name</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the node set field is defined on the node sets.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.node_set_field_exists(&#39;contact_pressure&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node_set_field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ExodusModel.element_field_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.element_field_exists">[docs]</a>    <span class="k">def</span> <span class="nf">element_field_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the element field exists on the element blocks.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.element_field_exists(&#39;eqps&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">id_</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">element_field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ExodusModel.node_field_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.node_field_exists">[docs]</a>    <span class="k">def</span> <span class="nf">node_field_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_field_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the given node field exists.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.node_field_exists(&#39;temperature&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">node_field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span></div>

<div class="viewcode-block" id="ExodusModel.element_block_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.element_block_exists">[docs]</a>    <span class="k">def</span> <span class="nf">element_block_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the given element block exists.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.element_block_exists(1)</span>
<span class="sd">        &gt;&gt;&gt; model.element_block_exists(&#39;block_name&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_element_block_names</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">()</span></div>

<div class="viewcode-block" id="ExodusModel.node_set_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.node_set_exists">[docs]</a>    <span class="k">def</span> <span class="nf">node_set_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the given node set exists.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.node_set_exists(1)</span>
<span class="sd">        &gt;&gt;&gt; model.node_set_exists(&#39;nodeset_name&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_node_set_names</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">()</span></div>

<div class="viewcode-block" id="ExodusModel.side_set_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.side_set_exists">[docs]</a>    <span class="k">def</span> <span class="nf">side_set_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the given side set exists.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.side_set_exists(1)</span>
<span class="sd">        &gt;&gt;&gt; model.node_set_exists(&#39;sideset_name&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_side_set_names</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">()</span></div>

<div class="viewcode-block" id="ExodusModel.timestep_exists"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.timestep_exists">[docs]</a>    <span class="k">def</span> <span class="nf">timestep_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return &#39;True&#39; if the given timestep exists.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.timestep_exists(0.0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span></div>

<div class="viewcode-block" id="ExodusModel.get_node_field_values"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_node_field_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_field_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_field_name</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of node field values for the given field and timestep.</span>

<span class="sd">        This returns the actual list of values, so any modifications to the</span>
<span class="sd">        list will be retained in the model.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_field_values(&#39;disp_x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_field_values(&#39;disp_x&#39;, 0.0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">node_field_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">(),</span> <span class="s2">&quot;node field&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.get_node_set_name"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_node_set_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the name of the given node set.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">([</span><span class="n">node_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">node_set_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.get_all_node_set_names"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_all_node_set_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_node_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all node set names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="ExodusModel.get_node_set_members"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_node_set_members">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of node indices that belong to the given node set.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_node_set_members(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">([</span><span class="n">node_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">node_set_id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_face_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mapping from face number to node number for an element.</span>

<span class="sd">        A list is returned with members of the form &#39;(type, numbering)&#39; where</span>
<span class="sd">        &#39;type&#39; is a string giving the face element type and &#39;numbering&#39; is a</span>
<span class="sd">        list if element indices.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FACE_MAPPING</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Undefined face mapping.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The mapping defining which nodes belong to a given &quot;</span>
                <span class="s1">&#39;face has not been defined for the &quot;</span><span class="si">%s</span><span class="s1">&quot; element &#39;</span>
                <span class="s2">&quot;type.  This could be because it has not been &quot;</span>
                <span class="s2">&quot;implemented or because the element type is &quot;</span>
                <span class="s2">&quot;invalid.  Mappings for the following element types &quot;</span>
                <span class="s2">&quot;are defined: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FACE_MAPPING</span><span class="o">.</span><span class="n">keys</span><span class="p">()))),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FACE_MAPPING</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_face_mapping_from_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the face mapping from the element block id.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.get_nodes_in_side_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_nodes_in_side_set">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_in_side_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of node indices which belong to the given side set.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_nodes_in_side_set(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">([</span><span class="n">side_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">included_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1"># store for element number in each element block</span>
        <span class="n">last_element_block_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">face_mapping</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block_id</span> <span class="o">!=</span> <span class="n">last_element_block_id</span> <span class="ow">or</span> <span class="n">face_mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">last_element_block_id</span> <span class="o">=</span> <span class="n">block_id</span>
                <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
                <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">block_id</span><span class="p">))</span>
                <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">local_index</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">included_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="n">nodes_per_element</span> <span class="o">+</span> <span class="n">local_index</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="c1"># return list after deleting duplicates</span>
        <span class="n">included_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">included_nodes</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">included_nodes</span></div>

    <span class="k">def</span> <span class="nf">_invert_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face</span><span class="p">,</span> <span class="n">face_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the connectivity of the inverted 2D face.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._invert_face(tuple(7, 2, 1, 3), &#39;quad4&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="n">face_type</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_rotate_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face</span><span class="p">,</span> <span class="n">face_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a rotation of the given 2D face.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._invert_face(tuple(7, 2, 1, 3), &#39;quad4&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROTATED_CONNECTIVITY</span><span class="p">[</span><span class="n">face_type</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_minimum_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face</span><span class="p">,</span> <span class="n">face_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a unique identifier for the given face.</span>

<span class="sd">        This finds the local face connectivity list and rotates it until the</span>
<span class="sd">        minimum such list is found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">face</span>
        <span class="n">best</span> <span class="o">=</span> <span class="n">face</span>
        <span class="n">best_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_face</span><span class="p">(</span><span class="n">face</span><span class="p">,</span> <span class="n">face_type</span><span class="p">)</span>
        <span class="n">rotate_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">face</span> <span class="o">!=</span> <span class="n">original</span><span class="p">:</span>
            <span class="n">rotate_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">face</span> <span class="o">&lt;</span> <span class="n">best</span><span class="p">:</span>
                <span class="n">best</span> <span class="o">=</span> <span class="n">face</span>
                <span class="n">best_count</span> <span class="o">=</span> <span class="n">rotate_count</span>
            <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_face</span><span class="p">(</span><span class="n">face</span><span class="p">,</span> <span class="n">face_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">best</span><span class="p">,</span> <span class="n">best_count</span>

    <span class="k">def</span> <span class="nf">_get_internal_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">set_of_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of internal element faces.</span>

<span class="sd">        If &#39;element_block_ids&#39; is specified, only faces within those elements</span>
<span class="sd">        will be considered.  If &#39;set_of_nodes&#39; is given, only faces which</span>
<span class="sd">        contain one or more nodes in that set will be returned.</span>
<span class="sd">        TODO: Not sure this handles &#39;element_block_ids&#39; correctly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># hold internal faces</span>
        <span class="n">internal_faces</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># hold faces which need matched</span>
        <span class="n">faces_to_match</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># form node mask if possible</span>
        <span class="k">if</span> <span class="n">set_of_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node_mask</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">set_of_nodes</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">))]</span>
        <span class="c1"># go through each element block</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="c1"># if we have a node mask, skip this block if no nodes in the block</span>
            <span class="c1"># are part of the set of nodes we care about</span>
            <span class="k">if</span> <span class="n">set_of_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="n">set_of_nodes</span><span class="p">):</span>
                    <span class="k">continue</span>
            <span class="n">face_mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">face_index</span><span class="p">,</span> <span class="p">(</span><span class="n">face_type</span><span class="p">,</span> <span class="n">face_mapping</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">face_mappings</span><span class="p">):</span>
                    <span class="n">this_member</span> <span class="o">=</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">)</span>
                    <span class="n">this_face</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">)</span>
                    <span class="c1"># skip the face if no nodes are relevant</span>
                    <span class="k">if</span> <span class="n">set_of_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">this_face</span> <span class="k">if</span> <span class="n">node_mask</span><span class="p">[</span><span class="n">x</span><span class="p">]]:</span>
                            <span class="k">continue</span>
                    <span class="c1"># transform into lowest form</span>
                    <span class="n">unique_face</span><span class="p">,</span> <span class="n">unique_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_face</span><span class="p">(</span>
                        <span class="n">this_face</span><span class="p">,</span> <span class="n">face_type</span>
                    <span class="p">)</span>
                    <span class="c1"># match if possible</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">faces_to_match</span><span class="o">.</span><span class="n">pop</span><span class="p">((</span><span class="n">face_type</span><span class="p">,</span> <span class="n">unique_face</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="c1"># if no match, add it</span>
                    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># invert and transform into lowest form</span>
                        <span class="n">inverted_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invert_face</span><span class="p">(</span><span class="n">this_face</span><span class="p">,</span> <span class="n">face_type</span><span class="p">)</span>
                        <span class="n">inverted_face</span><span class="p">,</span> <span class="n">inverted_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_face</span><span class="p">(</span>
                            <span class="n">inverted_face</span><span class="p">,</span> <span class="n">face_type</span>
                        <span class="p">)</span>
                        <span class="c1"># add it and continue</span>
                        <span class="n">faces_to_match</span><span class="p">[(</span><span class="n">face_type</span><span class="p">,</span> <span class="n">inverted_face</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">this_member</span><span class="p">,</span>
                            <span class="n">inverted_offset</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="c1"># set first mapping</span>
                    <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unique_offset</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_face</span><span class="p">)</span>
                    <span class="n">internal_faces</span><span class="p">[</span><span class="n">this_member</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="p">)</span>
                    <span class="c1"># set opposite mapping</span>
                    <span class="n">internal_faces</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_member</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">internal_faces</span>

    <span class="k">def</span> <span class="nf">_get_face_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the indices of the given face.</span>

<span class="sd">        &#39;member = (element_block_id, element_index, face_index)&#39;</span>

<span class="sd">        This function is slow.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">connectivity</span><span class="p">[</span><span class="n">nodes_per_element</span> <span class="o">*</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.convert_side_set_to_cohesive_zone"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.convert_side_set_to_cohesive_zone">[docs]</a>    <span class="k">def</span> <span class="nf">convert_side_set_to_cohesive_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="p">,</span> <span class="n">new_element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the given side sets into a block of cohesive zone elements.</span>

<span class="sd">        The given side set must contain faces which are internal (i.e. shared</span>
<span class="sd">        by exactly two elements).  Support for the following face types is</span>
<span class="sd">        implemented:</span>
<span class="sd">        * &#39;quad4&#39; creates &#39;hex8&#39; cohesive elements</span>
<span class="sd">        * &#39;tri3&#39; creates &#39;wedge6&#39; cohesive elements</span>
<span class="sd">        * &#39;tri6&#39; creates &#39;wedge12&#39; cohesive elements</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.convert_side_set_to_cohesive_zone(1, 2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="c1"># if nothing to operate on, just return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># order all faces by element block</span>
        <span class="n">members_by_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_element_faces_by_block</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="c1"># find face shape</span>
        <span class="n">face_type</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">members</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">members_by_block</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">element_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">))</span>
            <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">numbers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">members</span><span class="p">)</span>
            <span class="n">face_type</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">face_mapping</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">)</span>
        <span class="c1"># ensure single face type</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_type</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Multiple face types&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The side set contains multiple types of faces and &quot;</span>
                <span class="s2">&quot;cannot be converted into a cohesive zone.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># ensure face type is supported</span>
        <span class="n">face_type</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">face_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">face_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">COHESIVE_FORMULA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                <span class="s2">&quot;Unsupported face type&quot;</span><span class="p">,</span>
                <span class="s1">&#39;The side set chosen has elements of face type &quot;</span><span class="si">%s</span><span class="s1">&quot;.  &#39;</span>
                <span class="s2">&quot;At this time, only the following face types are &quot;</span>
                <span class="s2">&quot;supported:</span><span class="se">\n</span><span class="s2">* </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">face_type</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">* &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COHESIVE_FORMULA</span><span class="o">.</span><span class="n">keys</span><span class="p">()))),</span>
            <span class="p">)</span>
        <span class="c1"># for each element type, find adjacent faces</span>
        <span class="c1"># (adjacent faces in this context are faces which share one or more</span>
        <span class="c1"># nodes)</span>
        <span class="n">adjacent_faces</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">element_types</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element_type</span> <span class="ow">in</span> <span class="n">element_types</span><span class="p">:</span>
            <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
            <span class="n">face_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_mapping</span><span class="p">)</span>
            <span class="n">adjacent_face</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">face_count</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">face_one</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">face_count</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">face_two</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">face_count</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">face_mapping</span><span class="p">[</span><span class="n">face_one</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                        <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_two</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">adjacent_face</span><span class="p">[</span><span class="n">face_one</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_two</span><span class="p">)</span>
            <span class="n">adjacent_faces</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjacent_face</span>
        <span class="c1"># create a set of all nodes in the side set</span>
        <span class="n">nodes_on_surface</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">nodes_on_surface</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">))</span>
        <span class="c1"># find all relevant internal faces</span>
        <span class="n">internal_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_faces</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">members_by_block</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">set_of_nodes</span><span class="o">=</span><span class="n">nodes_on_surface</span>
        <span class="p">)</span>
        <span class="c1"># create a set of all free faces</span>
        <span class="n">free_faces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">members</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">members_by_block</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="n">face</span> <span class="o">=</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">)</span>
                <span class="n">free_faces</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                <span class="n">matching_face</span> <span class="o">=</span> <span class="n">internal_faces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">face</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_face</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                        <span class="s2">&quot;Invalid face&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;One or more members of the side set are &quot;</span>
                        <span class="s2">&quot;external faces which cannot be converted &quot;</span>
                        <span class="s2">&quot;to cohesive elements.&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">free_faces</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">matching_face</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># count the number of times each node is used</span>
        <span class="n">node_use_count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
                <span class="n">node_use_count</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># hold a list of all nodes to duplicate</span>
        <span class="n">nodes_to_duplicate</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">nodes_on_surface</span><span class="p">:</span>
            <span class="n">nodes_to_duplicate</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">node_index</span><span class="p">]</span> <span class="o">*</span> <span class="n">node_use_count</span><span class="p">[</span><span class="n">node_index</span><span class="p">])</span>
        <span class="n">nodes_to_duplicate</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="c1"># duplicate nodes</span>
        <span class="n">first_new_node_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">new_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate_nodes</span><span class="p">(</span><span class="n">nodes_to_duplicate</span><span class="p">,</span> <span class="n">new_indices</span><span class="p">)</span>
        <span class="c1"># for each duplicated node, find the first new node index</span>
        <span class="n">next_index</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">first_new_node_index</span>
        <span class="k">for</span> <span class="n">old_index</span><span class="p">,</span> <span class="n">new_index</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nodes_to_duplicate</span><span class="p">,</span> <span class="n">new_indices</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">next_index</span><span class="p">[</span><span class="n">old_index</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">next_index</span><span class="p">[</span><span class="n">old_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_index</span>
        <span class="c1"># for faster lookup, create a vector to see if a given node</span>
        <span class="c1"># is on the cohesive zone</span>
        <span class="n">node_in_zone</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="ow">in</span> <span class="n">nodes_on_surface</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">first_new_node_index</span><span class="p">)]</span>
        <span class="c1"># for each element, unmerge nodes on the cohesive zone</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectivity</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node_in_zone</span><span class="p">[</span><span class="n">value</span><span class="p">]:</span>
                    <span class="n">connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_index</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
                    <span class="n">next_index</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># find pairs of nodes which need merged</span>
        <span class="n">node_pairs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">old_face</span><span class="p">,</span> <span class="p">(</span><span class="n">new_face</span><span class="p">,</span> <span class="n">transform_count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">internal_faces</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="c1"># since the list is duplicated, only operate on one</span>
            <span class="k">if</span> <span class="n">old_face</span> <span class="o">&gt;</span> <span class="n">new_face</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># skip faces on the free surface</span>
            <span class="k">if</span> <span class="n">old_face</span> <span class="ow">in</span> <span class="n">free_faces</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># merge these nodes</span>
            <span class="n">original</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_face_indices</span><span class="p">(</span><span class="n">old_face</span><span class="p">))</span>
            <span class="n">target</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_face_indices</span><span class="p">(</span><span class="n">new_face</span><span class="p">))</span>
            <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invert_face</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">face_type</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transform_count</span><span class="p">):</span>
                <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_face</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">face_type</span><span class="p">)</span>
            <span class="n">node_pairs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span>
            <span class="p">)</span>
        <span class="c1"># merge nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merge_node_pairs</span><span class="p">(</span><span class="n">node_pairs</span><span class="p">)</span>
        <span class="c1"># delete nodes we created that are no longer referenced as well as the</span>
        <span class="c1"># original nodes which are no longer used</span>
        <span class="n">nodes_to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_unreferenced_nodes</span><span class="p">()</span>
        <span class="n">nodes_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nodes_to_delete</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">first_new_node_index</span><span class="p">]</span>
        <span class="n">nodes_to_delete</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">nodes_on_surface</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_nodes</span><span class="p">(</span><span class="n">nodes_to_delete</span><span class="p">)</span>
        <span class="c1"># get the formula for converting two faces into a cohesive element</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">COHESIVE_FORMULA</span><span class="p">[</span><span class="n">face_type</span><span class="p">]</span>
        <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NODES_PER_ELEMENT</span><span class="p">[</span><span class="n">formula</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># create cohesive zone element block connectivity by</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">free_faces</span><span class="p">:</span>
            <span class="n">other_face</span><span class="p">,</span> <span class="n">transform_count</span> <span class="o">=</span> <span class="n">internal_faces</span><span class="p">[</span><span class="n">face</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">other_face</span> <span class="o">&lt;</span> <span class="n">face</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_indices</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_indices</span><span class="p">(</span><span class="n">other_face</span><span class="p">)</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invert_face</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="n">face_type</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transform_count</span><span class="p">):</span>
                <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_face</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="n">face_type</span><span class="p">)</span>
            <span class="n">top</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bottom</span><span class="p">)</span>
            <span class="c1"># apply formula to convert two faces into an element</span>
            <span class="n">this_connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">top</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c1"># add this element to the connectivity list</span>
            <span class="n">connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">this_connectivity</span><span class="p">)</span>
        <span class="c1"># create the actual element block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
            <span class="n">new_element_block_id</span><span class="p">,</span>
            <span class="p">[</span><span class="n">formula</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="n">nodes_per_element</span><span class="p">,</span> <span class="n">nodes_per_element</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">connectivity</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.create_averaged_element_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_averaged_element_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_averaged_element_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">from_element_field_names</span><span class="p">,</span> <span class="n">new_element_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an element field by averaging the given field values.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.create_averaged_element_field([&#39;temp_1&#39;, &#39;temp_2&#39;],</span>
<span class="sd">        ...                                     &#39;temp_avg&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.create_averaged_element_field(&#39;temp_*&#39;, &#39;temp_avg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># format the arguments</span>
        <span class="n">from_element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">from_element_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(),</span> <span class="s2">&quot;element field&quot;</span>
        <span class="p">)</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># for each timestep</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="c1"># see if all fields are defined on this block</span>
            <span class="n">all_defined</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">from_element_field_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
                    <span class="n">all_defined</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">all_defined</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Fields not defined.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Not all of the requested element fields are &quot;</span>
                    <span class="s2">&quot;defined on element block </span><span class="si">%s</span><span class="s2">.  The averaged &quot;</span>
                    <span class="s2">&quot;field will not be created.&quot;</span> <span class="o">%</span> <span class="n">element_block_id</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># create the field if it doesn&#39;t exist</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">new_element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_on_entity_warning</span><span class="p">(</span>
                    <span class="n">new_element_field_name</span><span class="p">,</span>
                    <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
                    <span class="n">element_block_id</span><span class="p">,</span>
                    <span class="s2">&quot;element block&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_element_field</span><span class="p">(</span><span class="n">new_element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">)</span>
            <span class="c1"># get lists to average</span>
            <span class="n">field_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">from_element_field_names</span><span class="p">:</span>
                <span class="n">field_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">new_element_field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">new_element_field_name</span><span class="p">]</span>
            <span class="c1"># for each timestep, average the values</span>
            <span class="n">field_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">from_element_field_names</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">lists_to_average</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">]</span>
                <span class="n">averaged_field</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">field_count</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">lists_to_average</span><span class="p">)]</span>
                <span class="n">new_element_field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">averaged_field</span></div>

<div class="viewcode-block" id="ExodusModel.convert_element_field_to_node_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.convert_element_field_to_node_field">[docs]</a>    <span class="k">def</span> <span class="nf">convert_element_field_to_node_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_field_name</span><span class="p">,</span> <span class="n">node_field_name</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert an element field to a node field by performing.</span>

<span class="sd">        For each node, the value of the field at that node will be the average</span>
<span class="sd">        of the values in every element which shares that node for elements on</span>
<span class="sd">        which the field is defined.</span>

<span class="sd">        By default, the name of the node field will be the same as the element</span>
<span class="sd">        field.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.convert_element_field_to_node_field(&#39;temperature&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_field_name</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(),</span>
            <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
            <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># format the arguments</span>
        <span class="k">if</span> <span class="n">node_field_name</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">node_field_name</span> <span class="o">=</span> <span class="n">element_field_name</span>
        <span class="c1"># create the field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_node_field</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">)</span>
        <span class="c1"># store field indices</span>
        <span class="n">node_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span>
        <span class="c1"># store default value</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">)</span>
        <span class="c1"># process each timestep</span>
        <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
            <span class="c1"># initialize node field</span>
            <span class="n">node_field_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="n">node_field_elements</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="c1"># for each element block</span>
            <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
                <span class="c1"># if field doesn&#39;t exist on this element, skip it</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="c1"># store connectivity</span>
                <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="c1"># for each node within each element</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="n">element_field_values</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">]</span>
                <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nodes_per_element</span><span class="p">):</span>
                        <span class="n">this_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                            <span class="n">element_index</span> <span class="o">*</span> <span class="n">nodes_per_element</span> <span class="o">+</span> <span class="n">node_index</span>
                        <span class="p">]</span>
                        <span class="n">node_field_values</span><span class="p">[</span><span class="n">this_node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">element_field_values</span><span class="p">[</span>
                            <span class="n">element_index</span>
                        <span class="p">]</span>
                        <span class="n">node_field_elements</span><span class="p">[</span><span class="n">this_node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># average each value, or replace with default value</span>
            <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">node_field_elements</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">node_field_values</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node_field_values</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">/=</span> <span class="n">node_field_elements</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span>
            <span class="c1"># replace field values with generated values</span>
            <span class="n">node_field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_field_values</span></div>

<div class="viewcode-block" id="ExodusModel.convert_node_field_to_element_field"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.convert_node_field_to_element_field">[docs]</a>    <span class="k">def</span> <span class="nf">convert_node_field_to_element_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_field_name</span><span class="p">,</span> <span class="n">element_field_name</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a node field to an element field.</span>

<span class="sd">        For each element, the value of the field at that element will be the</span>
<span class="sd">        average of the values in each node of that element.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.convert_node_field_to_element_field(&#39;temperature&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">node_field_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">(),</span> <span class="s2">&quot;node field&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># format the arguments</span>
        <span class="k">if</span> <span class="n">element_field_name</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">element_field_name</span> <span class="o">=</span> <span class="n">node_field_name</span>
        <span class="c1"># store the node field</span>
        <span class="n">node_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">]</span>
        <span class="c1"># for each element block</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="c1"># create the field</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_element_field</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">element_field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">]</span>
            <span class="c1"># for each timestep</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="c1"># initialize element field</span>
                <span class="n">element_field_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">element_count</span>
                <span class="c1"># for each node within each element</span>
                <span class="k">for</span> <span class="n">connectivity_index</span><span class="p">,</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectivity</span><span class="p">):</span>
                    <span class="n">element_index</span> <span class="o">=</span> <span class="n">connectivity_index</span> <span class="o">//</span> <span class="n">nodes_per_element</span>
                    <span class="n">element_field_values</span><span class="p">[</span><span class="n">element_index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">node_field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span>
                        <span class="n">node_index</span>
                    <span class="p">]</span>
                <span class="c1"># average each value</span>
                <span class="n">element_field_values</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">x</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nodes_per_element</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_field_values</span>
                <span class="p">]</span>
                <span class="c1"># replace field values with generated values</span>
                <span class="n">element_field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">element_field_values</span></div>

    <span class="k">def</span> <span class="nf">_find_member_indices_to_keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_members</span><span class="p">,</span> <span class="n">members_to_delete</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of indices to keep from the list.</span>

<span class="sd">        This will handle duplicate entries correctly.  Duplicate entries will</span>
<span class="sd">        either all be deleted or all be kept.  Each index will appear in the</span>
<span class="sd">        resulting list at most once.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># find entries which are not in either list</span>
        <span class="n">all_members_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_members</span><span class="p">)</span>
        <span class="n">members_to_delete_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">members_to_delete</span><span class="p">)</span>
        <span class="n">invalid_entries</span> <span class="o">=</span> <span class="n">members_to_delete_set</span> <span class="o">-</span> <span class="n">all_members_set</span>
        <span class="k">if</span> <span class="n">invalid_entries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Invalid members&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The member list contains entries that were not &quot;</span>
                <span class="s2">&quot;members.  There were </span><span class="si">%d</span><span class="s2"> such occurrences.  These &quot;</span>
                <span class="s2">&quot;will be ignored.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">invalid_entries</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="c1"># find members to delete</span>
        <span class="n">indices_to_keep</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_members</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">members_to_delete_set</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">indices_to_keep</span>

    <span class="k">def</span> <span class="nf">_delete_side_set_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_id</span><span class="p">,</span> <span class="n">side_set_members</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the specified members from the given node set.</span>

<span class="sd">        Node set fields are updates.</span>

<span class="sd">        Members are given as (node_index).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># validate input</span>
        <span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">([</span><span class="n">side_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="c1"># find members to keep</span>
        <span class="n">indices_to_keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_member_indices_to_keep</span><span class="p">(</span><span class="n">members</span><span class="p">,</span> <span class="n">side_set_members</span><span class="p">)</span>
        <span class="c1"># delete members from node set fields</span>
        <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">all_values</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices_to_keep</span><span class="p">]</span> <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span>
            <span class="p">]</span>
        <span class="c1"># delete members</span>
        <span class="n">members</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">members</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices_to_keep</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_delete_node_set_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">,</span> <span class="n">node_set_members</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the specified members from the given node set.</span>

<span class="sd">        Node set fields are updates.</span>

<span class="sd">        Members are given as (node_index).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># validate input</span>
        <span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">([</span><span class="n">node_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">node_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span>
        <span class="c1"># find members to keep</span>
        <span class="n">indices_to_keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_member_indices_to_keep</span><span class="p">(</span>
            <span class="n">node_set</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_set_members</span>
        <span class="p">)</span>
        <span class="c1"># delete members from node set fields</span>
        <span class="n">node_set</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">these_values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices_to_keep</span><span class="p">]</span> <span class="k">for</span> <span class="n">these_values</span> <span class="ow">in</span> <span class="n">node_set</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="c1"># delete members</span>
        <span class="n">node_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_set</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices_to_keep</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_delete_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the given nodes.</span>

<span class="sd">        This will also delete all references to those nodes in node sets.  If a</span>
<span class="sd">        node is still being used by an element, it cannot be deleted.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_nodes([0, 1, 2, 3])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicates</span><span class="p">(</span><span class="n">node_list</span><span class="p">,</span> <span class="n">preserve_order</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># find node mapping</span>
        <span class="c1"># old node i refers to new node node_map[i]</span>
        <span class="n">keep_node</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
            <span class="n">keep_node</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">node_map</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">reverse_node_map</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">next_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">keep</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keep_node</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
                <span class="n">reverse_node_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">node_map</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_index</span>
                <span class="n">next_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># delete nodes</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reverse_node_map</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">new_nodes</span>
        <span class="c1"># update connectivity in each element block</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">new_connectivity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Node still used.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;A node in the list of nodes to delete is still &quot;</span>
                    <span class="s2">&quot;used by elements in element block </span><span class="si">%d</span><span class="s2"> and cannot &quot;</span>
                    <span class="s2">&quot;be deleted.&quot;</span> <span class="o">%</span> <span class="n">element_block_id</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">connectivity</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">new_connectivity</span>
        <span class="c1"># update node fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reverse_node_map</span><span class="p">]</span>
                <span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="c1"># delete nodes from node sets and fields</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="c1"># find new mapping</span>
            <span class="n">value_map</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_members</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node_map</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">new_members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_map</span><span class="p">[</span><span class="n">member</span><span class="p">])</span>
            <span class="c1"># update member list</span>
            <span class="n">members</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">new_members</span>
            <span class="c1"># delete these nodes from the field</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                    <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value_map</span><span class="p">]</span>
                    <span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>

    <span class="k">def</span> <span class="nf">_get_unreferenced_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of node indices which are not used by any element.&quot;&quot;&quot;</span>
        <span class="n">used_node</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
                <span class="n">used_node</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">unused_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">used</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">used_node</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">used</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">unused_nodes</span>

<div class="viewcode-block" id="ExodusModel.delete_unused_nodes"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_unused_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">delete_unused_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete nodes which are not used by any elements.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_unused_nodes()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes_to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_unreferenced_nodes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_nodes</span><span class="p">(</span><span class="n">nodes_to_delete</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.delete_global_variable"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_global_variable">[docs]</a>    <span class="k">def</span> <span class="nf">delete_global_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_variable_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more global variables.</span>

<span class="sd">        This function may also be called by its plural form</span>
<span class="sd">        &#39;delete_global_variables()&#39;.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_global_variable(&#39;internal_energy&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.delete_global_variable(&#39;all&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">global_variable_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">global_variable_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">(),</span> <span class="s2">&quot;global variable&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">global_variable_names</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.delete_side_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_side_set">[docs]</a>    <span class="k">def</span> <span class="nf">delete_side_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete one or more side sets.</span>

<span class="sd">        This function may also be called by its plural form</span>
<span class="sd">        &#39;delete_side_sets()&#39;.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_side_set(1)</span>
<span class="sd">        &gt;&gt;&gt; model.delete_side_set(&#39;all&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">[</span><span class="n">side_set_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.delete_empty_side_sets"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_empty_side_sets">[docs]</a>    <span class="k">def</span> <span class="nf">delete_empty_side_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all side sets with zero members.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_empty_side_sets()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_side_set</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.delete_node_set"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_node_set">[docs]</a>    <span class="k">def</span> <span class="nf">delete_node_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the given node set.</span>

<span class="sd">        This function may also be called by its plural form</span>
<span class="sd">        &#39;delete_node_sets()&#39;.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_node_set(1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExodusModel.delete_empty_node_sets"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_empty_node_sets">[docs]</a>    <span class="k">def</span> <span class="nf">delete_empty_node_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all side sets with zero members.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.delete_empty_node_sets()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_node_set</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.summarize"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.summarize">[docs]</a>    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a summary of the information in the current model.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.summarize()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The model contains the following:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> elements&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">())))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> timesteps&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> global variables&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> nodes&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> node fields&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> element blocks&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> element fields&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">()))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> node sets&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> node set fields&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">()))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> side sets&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="p">))))</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> side set fields&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">()))))</span></div>

    <span class="k">def</span> <span class="nf">_get_element_block_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dictionary of element block field values.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_node_set_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_set_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dictionary of node set field values.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">node_set_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">([</span><span class="n">node_set_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="p">[</span><span class="n">node_set_id</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="ExodusModel.get_element_count"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total number of elements in the given element blocks.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; print((&#39; %d elements&#39; % (object.get_element_count())))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExodusModel.process_element_fields"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.process_element_fields">[docs]</a>    <span class="k">def</span> <span class="nf">process_element_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process element field information to create node based fields.</span>

<span class="sd">        For element fields with 8 integration points, this takes the average.</span>
<span class="sd">        This is useful for fully integrated or selective deviatoric elements</span>
<span class="sd">        within the SIERRA/SM code.</span>

<span class="sd">        For element fields with 9 integration points, this takes the first one.</span>
<span class="sd">        This is useful for q1p0 elements within the SIERRA/SM code.</span>

<span class="sd">        This function is provided as a convenience for post processing hex8</span>
<span class="sd">        elements with multiple integration points.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.process_element_fields()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># for each element block</span>
        <span class="k">for</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_field_name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
                <span class="c1"># if it&#39;s the first integration point, count the total number</span>
                <span class="c1"># and process accordingly</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^.*_1$&quot;</span><span class="p">,</span> <span class="n">element_field_name</span><span class="p">):</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="n">element_field_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">points</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">block_id</span><span class="p">):</span>
                        <span class="n">points</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">points</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_field</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">block_id</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">block_id</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">points</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_averaged_element_field</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)],</span>
                            <span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">block_id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">block_id</span><span class="p">)</span>
        <span class="c1"># nodal average all fields</span>
        <span class="k">for</span> <span class="n">element_field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_element_field_to_node_field</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">)</span>
        <span class="c1"># delete element fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.combine_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.combine_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">combine_element_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">target_element_block_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combine multiple element blocks into a single block.</span>

<span class="sd">        By default, the target element block id will be the smallest of the</span>
<span class="sd">        merged element block ids.</span>

<span class="sd">        The element blocks to combine must have the same element type.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.combine_element_blocks(&#39;all&#39;, 1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">target_element_block_id</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">target_element_block_id</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_element_block_id</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># ensure all blocks have the same number of nodes per element</span>
        <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_block_ids</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_per_element</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Incompatible element types.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The number of nodes per element on each element &quot;</span>
                <span class="s2">&quot;block to be merged must by the same.  This is an &quot;</span>
                <span class="s2">&quot;ExodusII file requirement.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># ensure all blocks are the same type</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_block_ids</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_types</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Element types vary.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The element types of the merged blocks differ.  &quot;</span>
                <span class="s2">&quot;This may cause issues.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># create new connectivity</span>
        <span class="n">new_connectivity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="c1"># create new info</span>
        <span class="n">new_info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_block_info</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="c1"># set element count to zero</span>
        <span class="n">new_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># find a temporary element block id</span>
        <span class="n">temporary_element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
        <span class="c1"># create translation list for elements</span>
        <span class="c1"># new_block[old_block_id] = (new_block_id, element_offset)</span>
        <span class="n">new_block_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">new_block_info</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">new_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">new_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">id_</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># for fields which only exist on certain block, define them on all</span>
        <span class="n">element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">give_nonexistant_field_warning</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">give_nonexistant_field_warning</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                            <span class="s2">&quot;Inconsistent element fields.&quot;</span><span class="p">,</span>
                            <span class="s1">&#39;The element field &quot;</span><span class="si">%s</span><span class="s1">&quot; is not defined &#39;</span>
                            <span class="s2">&quot;on all element blocks included in the &quot;</span>
                            <span class="s2">&quot;merging operation.  It will be &quot;</span>
                            <span class="s2">&quot;created.  Future warnings of this type &quot;</span>
                            <span class="s2">&quot;will be suppressed.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">give_nonexistant_field_warning</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_element_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">)</span>
        <span class="c1"># create new field information</span>
        <span class="n">new_fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">id_</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">name</span><span class="p">]):</span>
                    <span class="n">new_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">new_fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="c1"># create new block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
            <span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">new_info</span><span class="p">,</span> <span class="n">new_connectivity</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">temporary_element_block_id</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_fields</span>
        <span class="c1"># translate side set members</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">new_members</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">new_block_info</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">element_index</span> <span class="o">+</span> <span class="n">new_block_info</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">face_index</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span>
            <span class="p">]</span>
            <span class="n">members</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">new_members</span>
        <span class="c1"># delete old blocks</span>
        <span class="c1"># (nodes can not be orphaned by this procedure)</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_block</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">,</span> <span class="n">delete_orphaned_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># rename element block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_block</span><span class="p">(</span><span class="n">temporary_element_block_id</span><span class="p">,</span> <span class="n">target_element_block_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.duplicate_element_block"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.duplicate_element_block">[docs]</a>    <span class="k">def</span> <span class="nf">duplicate_element_block</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">new_element_block_id</span><span class="p">,</span> <span class="n">duplicate_nodes</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an duplicate of the given element block.</span>

<span class="sd">        Nodes are duplicated by default.  The new element block references</span>
<span class="sd">        these duplicated nodes, not the original ones.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.duplicate_element_block(1, 2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">element_block_id</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_block_info</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">))</span>
        <span class="n">old_connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
        <span class="c1"># create new nodes</span>
        <span class="k">if</span> <span class="n">duplicate_nodes</span><span class="p">:</span>
            <span class="n">unique_node_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">old_connectivity</span><span class="p">))</span>
            <span class="n">new_node_indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate_nodes</span><span class="p">(</span><span class="n">unique_node_indices</span><span class="p">,</span> <span class="n">new_node_indices</span><span class="p">)</span>
            <span class="n">new_node_indices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_node_indices</span><span class="p">,</span> <span class="n">new_node_indices</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_node_indices</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">old_connectivity</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_connectivity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">old_connectivity</span><span class="p">)</span>
        <span class="c1"># create the block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span><span class="n">new_element_block_id</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">new_connectivity</span><span class="p">)</span>
        <span class="c1"># copy fields</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">new_element_block_id</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="c1"># update side sets and side set fields</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">new_members</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">source_face</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">element_block_id</span><span class="p">:</span>
                    <span class="n">new_members</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_element_block_id</span><span class="p">,</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">member</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">source_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">members</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_members</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                    <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">source_face</span><span class="p">]</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_values</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_inverted_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the connectivity pemutation to invert an element.&quot;&quot;&quot;</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVERTED_CONNECTIVITY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Unknown inversion algorithm.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The required numbering to invert an element of type &quot;</span>
                <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; is not defined.&#39;</span> <span class="o">%</span> <span class="n">element_type</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INVERTED_CONNECTIVITY</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_inverted_face_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the connectivity pemutation to invert an element face.&quot;&quot;&quot;</span>
        <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
        <span class="n">inversion_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inverted_connectivity</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
        <span class="n">original_face</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">]</span>
        <span class="n">new_face</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">inversion_mapping</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_face</span> <span class="o">=</span> <span class="p">[</span><span class="n">original_face</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_face</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                <span class="s2">&quot;Unable to determine face mapping.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;We were unable to determine how to map faces when &quot;</span>
                <span class="s1">&#39;inverting an element of type &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="n">element_type</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_face</span>

    <span class="k">def</span> <span class="nf">_invert_element_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Invert all elements within one or more element blocks.&quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="c1"># invert the connectivity</span>
            <span class="n">inverted_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inverted_connectivity</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">connectivity</span><span class="p">[</span><span class="n">element_index</span> <span class="o">*</span> <span class="n">nodes_per_element</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inverted_mapping</span>
            <span class="p">]</span>
            <span class="n">connectivity</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">new_connectivity</span>
            <span class="c1"># adjust side set members</span>
            <span class="n">new_face_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_inverted_face_mapping</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
                <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">id_</span><span class="p">:</span>
                        <span class="n">members</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_face_indices</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

<div class="viewcode-block" id="ExodusModel.create_element_block"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_element_block">[docs]</a>    <span class="k">def</span> <span class="nf">create_element_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new element block.</span>

<span class="sd">        The nodes for the elements in the block must have already been defined.</span>

<span class="sd">        The info list should be comprised of the following information.</span>
<span class="sd">        * &#39;[element_type, element_count, nodes_per_element, 0]&#39;</span>

<span class="sd">        For example, the following would be valid.</span>
<span class="sd">        * &#39;[&quot;hex8&quot;, elements, 8, 0]&#39;</span>

<span class="sd">        The connectivity list should be a shallow list of element connectivity</span>
<span class="sd">        and must be of length &#39;element_count * nodes_per_element&#39;.</span>

<span class="sd">        Element blocks are unnamed when created.  To name them, use the</span>
<span class="sd">        &#39;rename_element_block&#39; function.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_element_block(1, [&#39;hex8&#39;, 0, 8, 0])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure it doesn&#39;t exist already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_block_exists</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_error</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">,</span> <span class="s2">&quot;element block&quot;</span><span class="p">)</span>
        <span class="c1"># set up an empty connectivity if none is given</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">connectivity</span><span class="p">:</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># create the actual block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="p">{}]</span></div>

<div class="viewcode-block" id="ExodusModel.create_nodes"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">create_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_nodes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create nodes corresponding to the given coordinate list.</span>

<span class="sd">        The list must contain coordinate triples &#39;[x, y, z]&#39; defined for each</span>
<span class="sd">        new node.  The new nodes are assigned a local index starting with the</span>
<span class="sd">        current length of the nodes list.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_nodes([[0.0, 0.0, 0.0], [1.0, 2.0, 3.0]])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">+=</span> <span class="n">new_nodes</span>
        <span class="c1"># adjust node_fields</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">default_value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_exists_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Warn the user something already exists and exit.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
            <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot; already exists.&quot;</span><span class="p">,</span>
            <span class="s1">&#39;The specified </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists.  This operation cannot &#39;</span>
            <span class="s2">&quot;be completed.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_exists_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Warn the user something already exists.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
            <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot; already exists.&quot;</span><span class="p">,</span>
            <span class="s1">&#39;The specified </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists.  Information may be &#39;</span>
            <span class="s2">&quot;overwritten.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_exists_on_entity_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">base_name</span><span class="p">,</span> <span class="n">base_entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Warn the user something already exists on a given entity.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
            <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot; already exists.&quot;</span><span class="p">,</span>
            <span class="s1">&#39;The specified </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists on </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">.  Information may &#39;</span>
            <span class="s2">&quot;be overwritten.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">base_entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">base_name</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_missing_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tell the user something does not exist and exit.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
            <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot; does not exist.&quot;</span><span class="p">,</span>
            <span class="s1">&#39;The specified </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; does not exist.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_missing_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Warn the user something does not exist.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
            <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot; does not exist.&quot;</span><span class="p">,</span>
            <span class="s1">&#39;The specified </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; does not exist and will be ignored.&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_missing_on_entity_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">base_name</span><span class="p">,</span> <span class="n">base_entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tell the user something does not exist on an entity and exit.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
            <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">entity</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&quot; does not exist.&quot;</span><span class="p">,</span>
            <span class="s1">&#39;The specified </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot; does not exist on </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">.&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">base_entity</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">base_name</span><span class="p">)),</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.create_global_variable"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_global_variable">[docs]</a>    <span class="k">def</span> <span class="nf">create_global_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_variable_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new global variable.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_global_variable(&#39;gravitational_acceleration&#39;, 9.8)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_variable_exists</span><span class="p">(</span><span class="n">global_variable_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">global_variable_name</span><span class="p">,</span> <span class="s2">&quot;global variable&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">global_variable_name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">global_variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_element_centroids"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_element_centroids">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_element_centroids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_field_name_prefix</span><span class="o">=</span><span class="s2">&quot;centroid_&quot;</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and store the centroid of each element.</span>

<span class="sd">        This will approximate the element centroid as the nodal average of each</span>
<span class="sd">        element and will store that value in an element field.  Since a</span>
<span class="sd">        timestep must be defined in order for element fields to exist, one will</span>
<span class="sd">        be created if none exist.</span>

<span class="sd">        By default, the centroid will be stored in the fields &#39;centroid_x&#39;,</span>
<span class="sd">        &#39;centroid_y&#39;, and &#39;centroid_z&#39;.  Alternatively, a prefix can be given</span>
<span class="sd">        or a list of three strings can be given.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_element_centroids()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element_field_name_prefix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">centroid_field_names</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">element_field_name_prefix</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">centroid_field_names</span> <span class="o">=</span> <span class="n">element_field_name_prefix</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">centroid_field_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_exists_on_entity_warning</span><span class="p">(</span>
                        <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;element field&quot;</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="s2">&quot;element block&quot;</span>
                    <span class="p">)</span>
            <span class="c1"># calculate centroids</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[]]</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                <span class="n">this_centroid</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">connectivity_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nodes_per_element</span><span class="p">):</span>
                    <span class="n">node_index</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                        <span class="n">element_index</span> <span class="o">*</span> <span class="n">nodes_per_element</span> <span class="o">+</span> <span class="n">connectivity_index</span>
                    <span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">this_centroid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_index</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">centroid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_centroid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">nodes_per_element</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">centroid_field_names</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">centroid</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="ExodusModel.calculate_element_volumes"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.calculate_element_volumes">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_element_volumes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_field_name</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and store the volume of each element.</span>

<span class="sd">        This will approximate the element volume.  Since a timestep must be</span>
<span class="sd">        defined in order for element fields to exist, one will be created if</span>
<span class="sd">        none exist.</span>

<span class="sd">        For two dimensional elements, this calculates the area.  For one</span>
<span class="sd">        dimensional elements, this calculates the length.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.calculate_element_volumes()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="c1"># get the element type</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOLUME_FORMULA</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Unrecognized element type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;The formula for calculating the volume of &quot;</span>
                    <span class="s1">&#39;element type &quot;</span><span class="si">%s</span><span class="s1">&quot; is not implemented or not &#39;</span>
                    <span class="s2">&quot;known.  This block will be skipped.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">element_type</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="c1"># warn if field already exists</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_field_exists</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">,</span> <span class="n">element_block_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exists_on_entity_warning</span><span class="p">(</span>
                    <span class="n">element_field_name</span><span class="p">,</span>
                    <span class="s2">&quot;element field&quot;</span><span class="p">,</span>
                    <span class="n">element_block_id</span><span class="p">,</span>
                    <span class="s2">&quot;element block&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># get the formula</span>
            <span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># distance between two points</span>
                <span class="n">equation</span> <span class="o">=</span> <span class="s2">&quot;(x[0] ** 2.0 + &quot;</span> <span class="s2">&quot;x[1] ** 2.0 + &quot;</span> <span class="s2">&quot;x[2] ** 2.0) ** 0.5&quot;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># magnitude of cross product</span>
                <span class="n">equation</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;((x[0] * x[4] - x[1] * x[3]) ** 2.0 + &quot;</span>
                    <span class="s2">&quot;(x[2] * x[3] - x[0] * x[5]) ** 2.0 + &quot;</span>
                    <span class="s2">&quot;(x[1] * x[5] - x[2] * x[4]) ** 2.0) ** 0.5&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1"># triple product</span>
                <span class="n">equation</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;(x[1] * x[5] - x[2] * x[4]) * x[6] + &quot;</span>
                    <span class="s2">&quot;(x[2] * x[3] - x[0] * x[5]) * x[7] + &quot;</span>
                    <span class="s2">&quot;(x[0] * x[4] - x[1] * x[3]) * x[8]&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span><span class="s2">&quot;Unknown case&quot;</span><span class="p">)</span>
            <span class="c1"># process the formula to account for averaged nodes</span>
            <span class="n">transforms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">formula</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span>
                    <span class="n">node_list</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;n[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node_list</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;(&quot;</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;n[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot; + n[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;) / </span><span class="si">%d</span><span class="s2">.0&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot; - &quot;</span>
                    <span class="n">node_list</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;n[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node_list</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;(&quot;</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;n[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot; + n[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;) / </span><span class="si">%d</span><span class="s2">.0&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
                    <span class="n">transforms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;x[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">d</span><span class="p">),</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
                <span class="n">equation</span> <span class="o">=</span> <span class="n">equation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># store coordinates of nodes into x, y, z lists</span>
            <span class="n">function</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda n: &quot;</span> <span class="o">+</span> <span class="n">equation</span><span class="p">)</span>
            <span class="c1"># store some element block values</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">volumes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">element_count</span><span class="p">)):</span>
                <span class="c1"># get local node values</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="c1"># get local coordinates</span>
                <span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_node</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="c1"># add the volume</span>
                <span class="n">volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">*</span> <span class="n">formula</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># now make the field for each timestep</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">))]</span>
            <span class="c1"># assign the field</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="ExodusModel.get_element_block_volume"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_block_volume">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_block_volume</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">element_volume_field_name</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the total volume of the given element blocks.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_block_volume(&#39;all&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># create a timestep if none exist</span>
        <span class="n">created_timestep</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
            <span class="n">created_timestep</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># calculate temporary field with element volumes</span>
        <span class="n">created_volume_field</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">element_volume_field_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">created_volume_field</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">element_volume_field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_field_name</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_element_volumes</span><span class="p">(</span><span class="n">element_volume_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># add up the volumes</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">volume</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">element_volume_field_name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># delete the temporary timestep</span>
        <span class="k">if</span> <span class="n">created_timestep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># delete the temporary field</span>
        <span class="k">if</span> <span class="n">created_volume_field</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="n">element_volume_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">volume</span></div>

<div class="viewcode-block" id="ExodusModel.get_element_block_centroid"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_block_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_block_centroid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="p">,</span>
        <span class="n">element_volume_field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">element_centroid_field_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the centroid of the given element blocks.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_element_block_centroid(&#39;all&#39;)</span>
<span class="sd">        [1.0, 2.0, 3.0]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># format inputs</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># create a timestep if none exist</span>
        <span class="n">created_timestep</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
            <span class="n">created_timestep</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># calculate temporary field with element volumes</span>
        <span class="n">created_volume_field</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">element_volume_field_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">created_volume_field</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">element_volume_field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_field_name</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_element_volumes</span><span class="p">(</span><span class="n">element_volume_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># calculate temporary field with element centroids</span>
        <span class="n">created_centroid_fields</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">element_centroid_field_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">created_centroid_fields</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">element_centroid_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_field_name</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_element_centroids</span><span class="p">(</span>
                <span class="n">element_centroid_field_names</span><span class="p">,</span> <span class="n">element_block_ids</span>
            <span class="p">)</span>
        <span class="c1"># calculate the centroid</span>
        <span class="n">total_volume</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">centroid</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">volumes</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">element_volume_field_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">centroids</span> <span class="o">=</span> <span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="n">element_centroid_field_names</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">centroid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span> <span class="n">centroids</span><span class="p">[</span><span class="n">x</span><span class="p">]))</span>
            <span class="n">total_volume</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_volume</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="n">total_volume</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">centroid</span><span class="p">]</span>
        <span class="c1"># delete the temporary timestep</span>
        <span class="k">if</span> <span class="n">created_timestep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># delete the temporary fields</span>
        <span class="k">if</span> <span class="n">created_volume_field</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="n">element_volume_field_name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">created_centroid_fields</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">element_centroid_field_names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">centroid</span></div>

<div class="viewcode-block" id="ExodusModel.create_interpolated_timestep"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_interpolated_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">create_interpolated_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new timestep by interpolating neighboring steps.</span>

<span class="sd">        This does not extrapolate, so the given timestep to be interpolated</span>
<span class="sd">        must lie within the range of timesteps already defined.</span>

<span class="sd">        By default, &#39;cubic&#39; interpolation is used.  This can be changed to</span>
<span class="sd">        &#39;linear&#39; interpolation if desired.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.create_interpolated_timestep(0.5)</span>
<span class="sd">        &gt;&gt;&gt; model.create_interpolated_timestep(0.5, interpolation=&#39;linear&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># find neighboring timesteps and how to form the new step</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">()</span>
        <span class="c1"># make sure enough steps exist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid interpolation.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;A timestep cannot be interpolated unless 2 or &quot;</span>
                <span class="s2">&quot;more timesteps already exist.  There are </span><span class="si">%d</span><span class="s2"> defined &quot;</span>
                <span class="s2">&quot;timesteps: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">),</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">()]),</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="c1"># make sure value lies within time bounds</span>
        <span class="k">if</span> <span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">timestep</span> <span class="ow">or</span> <span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">timestep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid interpolation.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;The specified timestep </span><span class="si">%s</span><span class="s2"> does not lie within the &quot;</span>
                <span class="s2">&quot;range of timesteps already defined: [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">].&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">timestep</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="c1"># find two bounding timesteps</span>
            <span class="n">nearby</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">timestep</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">nearby</span> <span class="o">&lt;</span> <span class="n">timestep</span><span class="p">:</span>
                <span class="n">nearby</span> <span class="o">=</span> <span class="p">[</span><span class="n">nearby</span><span class="p">,</span> <span class="n">steps</span><span class="p">[</span><span class="n">steps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nearby</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nearby</span> <span class="o">=</span> <span class="p">[</span><span class="n">steps</span><span class="p">[</span><span class="n">steps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nearby</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nearby</span><span class="p">]</span>
            <span class="c1"># find proportion of each one to use</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">timestep</span> <span class="o">-</span> <span class="n">nearby</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">nearby</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nearby</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">formula</span> <span class="o">=</span> <span class="p">[(</span><span class="n">nearby</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">nearby</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">phi</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">interpolation</span> <span class="o">==</span> <span class="s2">&quot;cubic&quot;</span><span class="p">:</span>
            <span class="c1"># find four bounding timesteps</span>
            <span class="c1"># if step is within first or last segment, create</span>
            <span class="c1"># an imaginary point to do the interpolation</span>
            <span class="n">nearby</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">timestep</span><span class="p">))</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nearby</span><span class="p">)</span>
            <span class="n">four_steps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="k">if</span> <span class="n">nearby</span> <span class="o">&gt;</span> <span class="n">timestep</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">four_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">four_steps</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">four_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">four_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">four_steps</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">four_steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="n">four_steps</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">four_steps</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">four_steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">four_steps</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
            <span class="c1"># find interpolation coefficients</span>
            <span class="n">coefficients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cubic_interpolation</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="o">*</span><span class="n">four_steps</span><span class="p">)</span>
            <span class="n">formula</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">steps</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">steps</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">formula</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">formula</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formula</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">steps</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="n">formula</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">formula</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formula</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">steps</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">coefficients</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;Unknown interpolation technique&quot;</span><span class="p">,</span>
                <span class="s1">&#39;The specified interpolation technique &quot;</span><span class="si">%s</span><span class="s1">&quot; is not &#39;</span>
                <span class="s2">&quot;recognized.&quot;</span> <span class="o">%</span> <span class="n">interpolation</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># create the new timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_timestep</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># use the given formula to create the new step</span>
        <span class="c1"># formula = list of (timestep_index, contribution)</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">]</span>
        <span class="n">this_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># element fields, side set fields, node set fields</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
        <span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">thing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">new_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">phi</span>
                <span class="n">values</span><span class="p">[</span><span class="n">this_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="c1"># node fields</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">new_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">phi</span>
            <span class="n">values</span><span class="p">[</span><span class="n">this_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="c1"># global variables</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">])</span>
            <span class="n">values</span><span class="p">[</span><span class="n">this_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span></div>

    <span class="k">def</span> <span class="nf">_find_new_timestep_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_timestep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the index at which to create the new timestep.</span>

<span class="sd">        This returns the index to keep the list in monotonically increasing</span>
<span class="sd">        order.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># find the index at which to to insert this</span>
        <span class="c1"># if the new step is above all the others, put it at the end</span>
        <span class="n">higher_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">new_timestep</span><span class="p">]</span>
        <span class="c1"># if the new time is higher than all existing times, then add it to the</span>
        <span class="c1"># end</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">higher_times</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">higher_times</span><span class="p">))</span>

<div class="viewcode-block" id="ExodusModel.copy_timestep"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.copy_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">copy_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">new_timestep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a copy of an existing timestep.</span>

<span class="sd">        This copies all information from the old timestep including values</span>
<span class="sd">        of global variables, node fields, element fields, node set fields and</span>
<span class="sd">        side set fields.</span>

<span class="sd">        Example:</span>
<span class="sd">        object.copy_timestep(0.0, 1.0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">timestep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="p">[</span><span class="n">timestep</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_exists</span><span class="p">(</span><span class="n">new_timestep</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">new_timestep</span><span class="p">,</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># find the index at which to insert the new timestep</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_timestep_index</span><span class="p">(</span><span class="n">new_timestep</span><span class="p">)</span>
        <span class="c1"># get the index of the existing timestep prior to adding the new</span>
        <span class="c1"># timestep</span>
        <span class="n">old_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># insert the new timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">new_index</span><span class="p">,</span> <span class="n">new_timestep</span><span class="p">)</span>
        <span class="c1"># adjust node_fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">new_index</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">old_index</span><span class="p">]))</span>
        <span class="c1"># adjust self.global_variables</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">new_index</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">old_index</span><span class="p">])</span>
        <span class="c1"># adjust self.element_blocks, self.node_sets, self.side_sets</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
        <span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">thing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">new_index</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">old_index</span><span class="p">]))</span></div>

<div class="viewcode-block" id="ExodusModel.create_timestep"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.create_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">create_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new timestep.</span>

<span class="sd">        Field information at the created timestep is set to the default value.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.create_timestep(0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_exists</span><span class="p">(</span><span class="n">timestep</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># find the index at which to to insert this</span>
        <span class="n">timestep_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># add the given timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">timestep_index</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># adjust self.node_fields</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">timestep_index</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
        <span class="c1"># adjust element blocks fields</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">field_values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">timestep_index</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">element_count</span><span class="p">)</span>
        <span class="c1"># adjust side set fields</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">timestep_index</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">member_count</span><span class="p">)</span>
        <span class="c1"># adjust node set fields</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">timestep_index</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">member_count</span><span class="p">)</span>
        <span class="c1"># adjust self.global_variables</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">timestep_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_replace_name_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_list</span><span class="p">,</span> <span class="n">original_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the lowercase version of all strings in the given list.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._replace_name_case([&#39;x&#39;, &#39;z&#39;, &#39;fred&#39;], [&#39;X&#39;, &#39;Fred&#39;, &#39;Z&#39;])</span>
<span class="sd">        [&#39;X&#39;, &#39;Z&#39;, &#39;Fred&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_case</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">original_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_case</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                <span class="s2">&quot;Ambiguous string case.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;There are multiple strings in the list which have &quot;</span>
                <span class="s2">&quot;identical lowercase representations.  One will be &quot;</span>
                <span class="s2">&quot;chosen at random.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">new_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_case</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                    <span class="s2">&quot;Unrecognized string.&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;The string &quot;</span><span class="si">%s</span><span class="s1">&quot; appears in the new list but &#39;</span>
                    <span class="s2">&quot;not in the original list.&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">original_case</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_list</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_sort_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_field_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return field names sorted in a SIERRA-friendly manner.</span>

<span class="sd">        In order for SIERRA to recognize vectors, tensors, and element fields</span>
<span class="sd">        with multiple integration points, fields must be sorted in a specific</span>
<span class="sd">        order.  This function provides that sort order.</span>

<span class="sd">        As fields within exomerge are stored in a set, exomerge has no internal</span>
<span class="sd">        or natural field order.  This routine is only necessary for writing to</span>
<span class="sd">        ExodusII files.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">original_field_names</span><span class="p">]</span>
        <span class="c1"># Look through all fields to find multi-component fields and store</span>
        <span class="c1"># these as tuples of the following form:</span>
        <span class="c1"># (&#39;base_name&#39;, &#39;component&#39;, integration_points)</span>
        <span class="n">multicomponent_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
            <span class="c1"># see if it has an integration point</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;.*_[0-9]+$&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">integration_point</span><span class="p">)</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">integration_point</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">integration_point</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">integration_point</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># see if it possibly has a component</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;.*_.+$&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="n">component</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_MULTI_COMPONENT_FIELD_SUBSCRIPTS</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">multicomponent_fields</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">integration_point</span><span class="p">))</span>
        <span class="c1"># now sort multi-component fields</span>
        <span class="n">base_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">multicomponent_fields</span><span class="p">)</span>
        <span class="n">sorted_field_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">field_names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">base_name</span> <span class="ow">in</span> <span class="n">base_names</span><span class="p">:</span>
            <span class="c1"># find all components of this form</span>
            <span class="n">components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">multicomponent_fields</span> <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">base_name</span>
            <span class="p">)</span>
            <span class="c1"># find max integration point value</span>
            <span class="n">integration_points</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">x</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">multicomponent_fields</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">base_name</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">integration_points</span><span class="p">:</span>
                <span class="n">integration_point_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">x</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">multicomponent_fields</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">base_name</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">integration_point_count</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># see if the components match the form of something</span>
            <span class="n">matching_form</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">form</span><span class="p">,</span> <span class="n">included_components</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MULTI_COMPONENT_FIELD_SUBSCRIPTS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">included_components</span><span class="p">)</span> <span class="o">==</span> <span class="n">components</span><span class="p">:</span>
                    <span class="n">matching_form</span> <span class="o">=</span> <span class="n">form</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_form</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># see if all components and integration points are present</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MULTI_COMPONENT_FIELD_SUBSCRIPTS</span><span class="p">[</span><span class="n">matching_form</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">integration_point_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">integration_point_count</span><span class="p">)]</span>
            <span class="n">all_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">base_name</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">last</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mid</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_names</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">field_names</span><span class="p">):</span>
                <span class="n">sorted_field_names</span><span class="p">[</span><span class="n">all_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">all_names</span>
                <span class="n">field_names</span> <span class="o">=</span> <span class="n">field_names</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_names</span><span class="p">)</span>
        <span class="c1"># sort field names which are not part of multicomponent fields</span>
        <span class="n">field_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">field_names</span><span class="p">)</span>
        <span class="c1"># for each list of field names, find place to splice into list</span>
        <span class="n">place_to_insert</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_field_names</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">place</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">field_names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">place</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">place_to_insert</span><span class="p">:</span>
                <span class="n">place_to_insert</span><span class="p">[</span><span class="n">place</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">place_to_insert</span><span class="p">[</span><span class="n">place</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># splice them in</span>
        <span class="k">for</span> <span class="n">place</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">place_to_insert</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">place_to_insert</span><span class="p">[</span><span class="n">place</span><span class="p">]:</span>
                <span class="n">field_names</span><span class="p">[</span><span class="n">place</span><span class="p">:</span><span class="n">place</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_field_names</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace_name_case</span><span class="p">(</span><span class="n">field_names</span><span class="p">,</span> <span class="n">original_field_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reorder_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_list</span><span class="p">,</span> <span class="n">new_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reorder a list by permuting items.</span>

<span class="sd">        The item at index 0 in the original list is moved to index</span>
<span class="sd">        &#39;new_index[0]&#39;, and so on.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ensure arguments are valid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span><span class="p">(</span><span class="n">new_index</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">the_list</span><span class="p">),</span> <span class="nb">int</span><span class="p">])</span>
        <span class="c1"># create new list</span>
        <span class="n">the_list</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">the_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_sort_timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sort timesteps so that they are in ascending order.&quot;&quot;&quot;</span>
        <span class="n">index_map</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reorder_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">index_map</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reorder_list</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index_map</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reorder_list</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index_map</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reorder_list</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index_map</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reorder_list</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index_map</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">():</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reorder_list</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_node_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the given node map to reorder all nodes.</span>

<span class="sd">        Node i becomes node node_map[i].</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node_map</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)))</span>
        <span class="c1"># find reverse_node_map</span>
        <span class="n">reverse_node_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reverse_index_map</span><span class="p">(</span><span class="n">node_map</span><span class="p">)</span>
        <span class="c1"># reorder nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reverse_node_map</span><span class="p">]</span>
        <span class="c1"># reorder element connectivity</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">connectivity</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">]</span>
        <span class="c1"># reorder node fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span>
                <span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reverse_node_map</span><span class="p">]</span>
        <span class="c1"># reorder nodes in node sets</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">members</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_order_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Redefine node ordering in a consistent manner.</span>

<span class="sd">        This was introduced because running exodiff on two different</span>
<span class="sd">        models with the same information but differing node numbering will</span>
<span class="sd">        fail.  By running this routine before export_model, the numbering</span>
<span class="sd">        will be consistent and will avoid this problem.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define new node numbering by the order in which nodes are encountered</span>
        <span class="c1"># in element blocks by ascending element block id.  For nodes not used</span>
        <span class="c1"># in any element blocks, they are sorted by x coordinate, then y</span>
        <span class="c1"># coordinate, then z coordinate.</span>
        <span class="c1"># node i on old model becomes node_map[i]</span>
        <span class="c1"># node i in new model was reverse_node_map[i]</span>
        <span class="n">next_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">node_map</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node_map</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">node_map</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_index</span>
                    <span class="n">next_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">still_to_sort</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">map_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_map</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">map_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">still_to_sort</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">index</span><span class="p">))</span>
        <span class="n">still_to_sort</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">still_to_sort</span><span class="p">:</span>
            <span class="n">node_map</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_index</span>
            <span class="n">next_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_node_map</span><span class="p">(</span><span class="n">node_map</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.get_input_deck"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_input_deck">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_deck</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return each line of the input deck stored in the file.</span>

<span class="sd">        Many SIERRA applications, when running a problem, will store the input</span>
<span class="sd">        deck within the results file.  This function retrieves that</span>
<span class="sd">        information, if it exists.  Note that due to format restriction, the</span>
<span class="sd">        retrieved input deck may not exactly match the original file.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; object = exomerge.import_model(&#39;results.e&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.get_input_deck()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">continuation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">input_deck</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">begin_depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">first_word</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">continuation</span><span class="p">:</span>
                <span class="n">first_word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">continuation</span> <span class="ow">and</span> <span class="n">first_word</span> <span class="o">==</span> <span class="s2">&quot;begin&quot;</span><span class="p">:</span>
                <span class="n">begin_depth</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">begin_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">continuation</span><span class="p">:</span>
                    <span class="n">input_deck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_deck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">line</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">input_deck</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">continuation</span> <span class="o">=</span> <span class="n">begin_depth</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">continuation</span> <span class="ow">and</span> <span class="n">first_word</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
                <span class="n">begin_depth</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_deck</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.get_length_scale"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_length_scale">[docs]</a>    <span class="k">def</span> <span class="nf">get_length_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the length scale of the model.</span>

<span class="sd">        The length scale is defined as the largest of the following:</span>
<span class="sd">        * absolute nodal coordinate component</span>
<span class="sd">        * total range in nodal coordinate component</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_length_scale()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">d</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">d</span><span class="p">]]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">bounds</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">bounds</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="n">relative</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">bound</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">])</span>
        <span class="n">abs0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">bound</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">])</span>
        <span class="n">abs1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">bound</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">])</span>
        <span class="n">absolute</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">abs0</span><span class="p">,</span> <span class="n">abs1</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">relative</span><span class="p">,</span> <span class="n">absolute</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_reverse_index_map</span><span class="p">(</span><span class="n">index_map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the reverse map for the given index mapping scheme.&quot;&quot;&quot;</span>
        <span class="n">reverse_index_map</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_map</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">new_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index_map</span><span class="p">):</span>
            <span class="n">reverse_index_map</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">return</span> <span class="n">reverse_index_map</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_dot</span><span class="p">(</span><span class="n">vector_one</span><span class="p">,</span> <span class="n">vector_two</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dot product of two things.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vector_one</span><span class="p">,</span> <span class="n">vector_two</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_distance_squared_between</span><span class="p">(</span><span class="n">point_one</span><span class="p">,</span> <span class="n">point_two</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the distance squared between two three-dimensional points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">point_two</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">point_one</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">point_two</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">point_one</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">point_two</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">point_one</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_distance_between</span><span class="p">(</span><span class="n">point_one</span><span class="p">,</span> <span class="n">point_two</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the distance between two three-dimensional points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="p">(</span><span class="n">point_two</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">point_one</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">point_two</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">point_one</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">point_two</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">point_one</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_values_match</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">list_of_values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the list contains no items apart from the given value.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; _values_match(0, [0, 0, 0])</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; _values_match(1, [0, 1, 0])</span>
<span class="sd">        False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_values</span><span class="p">)</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_merge_node_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_groups</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge nodes in the given node groups.</span>

<span class="sd">        This updates node field and node set field values with the average of</span>
<span class="sd">        the values at the merged nodes.  If they differ, a warning is output in</span>
<span class="sd">        addition.</span>

<span class="sd">        Node sets and node set fields are updated accordingly.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._merge_node_groups({1: [2, 3], 5: [7, 8]})</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ensure slave nodes are not duplicated</span>
        <span class="n">slave_nodes_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">duplicated_slave_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slaves</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">slave</span> <span class="ow">in</span> <span class="n">slaves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">slave</span> <span class="ow">in</span> <span class="n">slave_nodes_set</span><span class="p">:</span>
                    <span class="n">duplicated_slave_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slave</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">slave_nodes_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slave</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">duplicated_slave_nodes</span><span class="p">:</span>
            <span class="n">problem_groups</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slaves</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">slaves</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">duplicated_slave_nodes</span><span class="p">:</span>
                        <span class="n">problem_groups</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">=</span> <span class="n">slaves</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">problem_groups</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                <span class="s2">&quot;Invalid merged node groups.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Slaves nodes were found in multiple merged groups.  &quot;</span>
                <span class="s2">&quot;Conflicting merged node groups:</span><span class="se">\n</span><span class="s2">  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">groups</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="c1"># ensure validity of input</span>
        <span class="c1"># slave nodes are not repeated</span>
        <span class="c1"># master nodes are never slave nodes</span>
        <span class="n">master_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">slave_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>
        <span class="n">slave_nodes_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">slave_nodes</span><span class="p">)</span>
        <span class="c1"># ensure master nodes are not slave nodes</span>
        <span class="k">for</span> <span class="n">master</span> <span class="ow">in</span> <span class="n">master_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">in</span> <span class="n">slave_nodes_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid merged node groups.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;The master node </span><span class="si">%d</span><span class="s2"> is also found in a slave node &quot;</span>
                    <span class="s2">&quot;group.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">master</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="c1"># ensure slave nodes are not in multiple groups</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">slave_nodes_set</span><span class="p">)</span> <span class="o">==</span> <span class="n">slave_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                <span class="s2">&quot;Invalid merged node groups.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Slave nodes are duplicated in multiple groups.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># First, remap all nodes such that slave nodes appear at the very</span>
        <span class="c1"># end.</span>
        <span class="n">next_master_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">first_slave_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">slave_nodes</span><span class="p">)</span>
        <span class="n">next_slave_index</span> <span class="o">=</span> <span class="n">first_slave_index</span>
        <span class="n">node_map</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">slave_node</span> <span class="ow">in</span> <span class="n">slave_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slave_node</span> <span class="o">!=</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">slave_node</span> <span class="o">-</span> <span class="n">index</span>
                <span class="k">assert</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="n">node_map</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">next_master_index</span><span class="p">,</span> <span class="n">next_master_index</span> <span class="o">+</span> <span class="n">count</span><span class="p">))</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="n">count</span>
                <span class="n">next_master_index</span> <span class="o">+=</span> <span class="n">count</span>
            <span class="n">node_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_slave_index</span><span class="p">)</span>
            <span class="n">next_slave_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">first_slave_index</span> <span class="o">-</span> <span class="n">next_master_index</span>
        <span class="n">node_map</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">next_master_index</span><span class="p">,</span> <span class="n">next_master_index</span> <span class="o">+</span> <span class="n">count</span><span class="p">))</span>
        <span class="n">next_master_index</span> <span class="o">+=</span> <span class="n">count</span>
        <span class="k">assert</span> <span class="n">next_master_index</span> <span class="o">==</span> <span class="n">first_slave_index</span>
        <span class="k">assert</span> <span class="n">next_slave_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slaves</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">assert</span> <span class="n">node_map</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">first_slave_index</span>
            <span class="k">assert</span> <span class="nb">min</span><span class="p">([</span><span class="n">node_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">slaves</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">first_slave_index</span>
        <span class="c1"># apply this node map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_node_map</span><span class="p">(</span><span class="n">node_map</span><span class="p">)</span>
        <span class="c1"># apply the mapping to node_groups</span>
        <span class="n">node_groups</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">node_map</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">[</span><span class="n">node_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slaves</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">assert</span> <span class="n">master</span> <span class="o">&lt;</span> <span class="n">first_slave_index</span>
            <span class="k">assert</span> <span class="nb">min</span><span class="p">(</span><span class="n">slaves</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">first_slave_index</span>
        <span class="c1"># get connectivity mapping</span>
        <span class="n">connectivity_map</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slaves</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">slave</span> <span class="ow">in</span> <span class="n">slaves</span><span class="p">:</span>
                <span class="n">connectivity_map</span><span class="p">[</span><span class="n">slave</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span>
        <span class="c1"># change connectivity in element_blocks</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">connectivity</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">connectivity_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">]</span>
        <span class="c1"># change self.node_fields</span>
        <span class="n">node_field_value_warnings</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slaves</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="n">master_value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">master</span><span class="p">]</span>
                    <span class="n">slave_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">slaves</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_match</span><span class="p">(</span><span class="n">master_value</span><span class="p">,</span> <span class="n">slave_values</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_field_value_warnings</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">suppress_warnings</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                                <span class="s2">&quot;Node field values do not match.&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;Nodes are being merged but values at these &quot;</span>
                                <span class="s1">&#39;nodes for node field &quot;</span><span class="si">%s</span><span class="s1">&quot; do not match.  An &#39;</span>
                                <span class="s2">&quot;averaged value will be used.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="s2">&quot;Future warnings of this type will be &quot;</span>
                                <span class="s2">&quot;suppressed.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">),</span>
                            <span class="p">)</span>
                        <span class="n">node_field_value_warnings</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">values</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">slave_values</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">slaves</span><span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">first_slave_index</span><span class="p">:]</span>
        <span class="c1"># change self.node_sets</span>
        <span class="n">node_set_member_warnings</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">node_set_value_warnings</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">members_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="n">member_indices_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slaves</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">master_included</span> <span class="o">=</span> <span class="n">master</span> <span class="ow">in</span> <span class="n">members_set</span>
                <span class="n">slaves_included</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">slaves_not_included</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">slave</span> <span class="ow">in</span> <span class="n">slaves</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">slave</span> <span class="ow">in</span> <span class="n">members_set</span><span class="p">:</span>
                        <span class="n">slaves_included</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slave</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">slaves_not_included</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slave</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">master_included</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">slaves_included</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># warn if not all nodes are in the set</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">master_included</span> <span class="ow">or</span> <span class="n">slaves_not_included</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">node_set_member_warnings</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">suppress_warnings</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                            <span class="s2">&quot;Ambiguous merge of nodes.&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Node are being merged, but only some of these &quot;</span>
                            <span class="s2">&quot;nodes belong to a given node set.  The operation &quot;</span>
                            <span class="s2">&quot;is therefore ambiguous on whether or not to &quot;</span>
                            <span class="s2">&quot;include the merged node in the set.  The merged &quot;</span>
                            <span class="s2">&quot;node will be included in the set.</span><span class="se">\n\n</span><span class="s2">Future &quot;</span>
                            <span class="s2">&quot;warnings of this type will be suppressed.&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">node_set_member_warnings</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># if master node is not included, steal the position of a</span>
                <span class="c1"># slave node</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">master_included</span><span class="p">:</span>
                    <span class="n">members</span><span class="p">[</span><span class="n">members</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">slaves_included</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="n">master</span>
                    <span class="k">del</span> <span class="n">slaves_included</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">master_included</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">slaves_included</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">master_index</span> <span class="o">=</span> <span class="n">members</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
                <span class="n">slave_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">members</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">slaves_included</span><span class="p">]</span>
                <span class="c1"># mark slaves to delete</span>
                <span class="n">member_indices_to_delete</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">slave_indices</span><span class="p">)</span>
                <span class="c1"># average values, warn if they are not the same</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                        <span class="n">slave_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">slave_indices</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_match</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">master_index</span><span class="p">],</span> <span class="n">slave_values</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">node_set_value_warnings</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">suppress_warnings</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                                    <span class="s2">&quot;Node set field values do not match.&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;Nodes are being merged but values at &quot;</span>
                                    <span class="s2">&quot;these nodes for node set field </span><span class="si">%s</span><span class="s2"> do &quot;</span>
                                    <span class="s2">&quot;not match.  An averaged values will &quot;</span>
                                    <span class="s2">&quot;be used.</span><span class="se">\n\n</span><span class="s2">Future warnings of this &quot;</span>
                                    <span class="s2">&quot;type will be suppressed.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">),</span>
                                <span class="p">)</span>
                            <span class="n">node_set_value_warnings</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">new_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">master_index</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">slave_values</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">slave_indices</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">values</span><span class="p">[</span><span class="n">master_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="c1"># delete slave members</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">member_indices_to_delete</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">members</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1"># delete those nodes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">first_slave_index</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_merge_node_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_pairs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge the given node pairs.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._merge_node_pairs([(1, 3), (2, 5), (1, 5)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create groups of nodes to merge</span>
        <span class="n">node_group</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">merge_group</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">node_pairs</span><span class="p">:</span>
            <span class="n">master</span><span class="p">,</span> <span class="n">slave</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
            <span class="n">master_group</span> <span class="o">=</span> <span class="n">node_group</span><span class="p">[</span><span class="n">master</span><span class="p">]</span>
            <span class="n">slave_group</span> <span class="o">=</span> <span class="n">node_group</span><span class="p">[</span><span class="n">slave</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">master_group</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">slave_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node_group</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">merge_group</span><span class="p">)</span>
                <span class="n">node_group</span><span class="p">[</span><span class="n">slave</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">merge_group</span><span class="p">)</span>
                <span class="n">merge_group</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">master</span><span class="p">,</span> <span class="n">slave</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">master_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node_group</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">=</span> <span class="n">slave_group</span>
                <span class="n">merge_group</span><span class="p">[</span><span class="n">slave_group</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">slave_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node_group</span><span class="p">[</span><span class="n">slave</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_group</span>
                <span class="n">merge_group</span><span class="p">[</span><span class="n">master_group</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slave</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">master_group</span> <span class="o">!=</span> <span class="n">slave_group</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">merge_group</span><span class="p">[</span><span class="n">slave_group</span><span class="p">]:</span>
                    <span class="n">node_group</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_group</span>
                <span class="n">merge_group</span><span class="p">[</span><span class="n">master_group</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">merge_group</span><span class="p">[</span><span class="n">slave_group</span><span class="p">])</span>
                <span class="n">merge_group</span><span class="p">[</span><span class="n">slave_group</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group_to_merge</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">merge_group</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">master</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">group_to_merge</span>
            <span class="n">group_to_merge</span><span class="p">[</span><span class="n">master</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">master</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merge_node_groups</span><span class="p">(</span><span class="n">group_to_merge</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.delete_duplicate_elements"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.delete_duplicate_elements">[docs]</a>    <span class="k">def</span> <span class="nf">delete_duplicate_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete duplicate elements.</span>

<span class="sd">        For this calculation, a duplicate element is an element which shares</span>
<span class="sd">        all of its nodes with another element.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># go through each block and delete elements</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="n">nodes_per_element</span> <span class="o">*</span> <span class="n">element_count</span>
            <span class="c1"># sort elements into sets which contain</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">element_count</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="n">element</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">connectivity</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="n">nodes_per_element</span><span class="p">])</span>
                <span class="n">element</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_elements</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">duplicates</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_find_close_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return groups of nodes that are close to one another.</span>

<span class="sd">        This will search for all nodes which are separated by at most</span>
<span class="sd">        &#39;tolerance&#39; and return a list of node groups.</span>

<span class="sd">        If node A is close to node B, and node B is close to node C, then each</span>
<span class="sd">        A, B, and C will belong to the same node group, regardless of whether</span>
<span class="sd">        or not node A is close to node C.</span>

<span class="sd">        Results are returned as a dict of node groups with the lowest index</span>
<span class="sd">        node being the key and the value as the list of slave nodes.  For</span>
<span class="sd">        example, if nodes 0 and 1 are close, and 2 and 3 are close, it would</span>
<span class="sd">        return:</span>
<span class="sd">        &gt;&gt;&gt; model._find_close_nodes()</span>
<span class="sd">        {0: [1], 2: [3]}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create a sorting vector</span>
        <span class="n">sorting_vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sorting_vector</span><span class="p">]))</span>
        <span class="n">sorting_vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sorting_vector</span><span class="p">]</span>
        <span class="c1"># create a list of node indices sorted by distance along that vector</span>
        <span class="n">sorted_nodal_distances</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sorting_vector</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="c1"># go through the list to find node groups</span>
        <span class="n">node_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">lower_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">upper_index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">master_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)))</span>
        <span class="k">while</span> <span class="n">lower_index</span> <span class="o">&lt;</span> <span class="n">node_count</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">upper_index</span> <span class="o">&gt;=</span> <span class="n">node_count</span>
                <span class="ow">or</span> <span class="n">sorted_nodal_distances</span><span class="p">[</span><span class="n">upper_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">-</span> <span class="n">sorted_nodal_distances</span><span class="p">[</span><span class="n">lower_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">&gt;</span> <span class="n">tolerance</span>
            <span class="p">):</span>
                <span class="n">lower_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">upper_index</span> <span class="o">=</span> <span class="n">lower_index</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">lower_element</span> <span class="o">=</span> <span class="n">sorted_nodal_distances</span><span class="p">[</span><span class="n">lower_index</span><span class="p">]</span>
            <span class="n">upper_element</span> <span class="o">=</span> <span class="n">sorted_nodal_distances</span><span class="p">[</span><span class="n">upper_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_distance_between</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">lower_element</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">upper_element</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="p">)</span>
                <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="p">):</span>
                <span class="n">one</span><span class="p">,</span> <span class="n">two</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">lower_element</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">upper_element</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">master_nodes</span><span class="p">[</span><span class="n">two</span><span class="p">]</span> <span class="o">=</span> <span class="n">one</span>
            <span class="n">upper_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># create a list of close node groups</span>
        <span class="n">close_node_groups</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">master_node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">master_nodes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="n">master_node</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">master_nodes</span><span class="p">[</span><span class="n">master_node</span><span class="p">]</span> <span class="o">!=</span> <span class="n">master_node</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">master_nodes</span><span class="p">[</span><span class="n">master_node</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">master_node</span>
                    <span class="n">master_node</span> <span class="o">=</span> <span class="n">master_nodes</span><span class="p">[</span><span class="n">master_node</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">master_node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">close_node_groups</span><span class="p">:</span>
                    <span class="n">close_node_groups</span><span class="p">[</span><span class="n">master_node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">close_node_groups</span><span class="p">[</span><span class="n">master_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># return the result</span>
        <span class="k">return</span> <span class="n">close_node_groups</span>

<div class="viewcode-block" id="ExodusModel.merge_nodes"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.merge_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">merge_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">relative_tolerance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge nodes that are closer than the given tolerance.</span>

<span class="sd">        Node fields, node sets and node set fields are updated accordingly.</span>
<span class="sd">        Using a tolerance of 0 will merge nodes at the exact same location.</span>

<span class="sd">        If &#39;relative_tolerace=True&#39;, this will multiply the tolerance by the</span>
<span class="sd">        length scale of the model as obtained from &#39;get_length_scale()&#39;.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.merge_nodes(0)</span>
<span class="sd">        &gt;&gt;&gt; model.merge_nodes()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># find the absolute tolerance</span>
        <span class="k">if</span> <span class="n">relative_tolerance</span><span class="p">:</span>
            <span class="n">tolerance</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_length_scale</span><span class="p">()</span>
        <span class="c1"># find the node groups</span>
        <span class="n">close_node_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_close_nodes</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="c1"># merge these node groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merge_node_groups</span><span class="p">(</span><span class="n">close_node_groups</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_duplicate_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">new_node_indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create duplicates of the given nodes.</span>

<span class="sd">        This updates node fields, node sets, and node set fields consistently.</span>
<span class="sd">        If a node is part of a node set, its duplicated node will be added to</span>
<span class="sd">        the node set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_node_indices</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_indices</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># update self.nodes</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_nodes</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span>
        <span class="c1"># update self.node_fields</span>
        <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slave</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">new_node_indices</span><span class="p">):</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">slave</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">master</span><span class="p">]</span>
        <span class="c1"># update self.node_sets</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="n">slave</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">new_node_indices</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">master</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                    <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slave</span><span class="p">)</span>
                    <span class="n">master_index</span> <span class="o">=</span> <span class="n">members</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">master_index</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_create_averaged_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">new_node_indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create duplicates nodes which are averaged from the given nodes.</span>

<span class="sd">        If all nodes which are being averaged are in a given node set, the</span>
<span class="sd">        newly created node is also added the node set.</span>

<span class="sd">        For example, &#39;node_indices = [(0, 1, 2)]&#39; will create a new node which</span>
<span class="sd">        is the average of nodes 1, 2, and 3.  Passing</span>
<span class="sd">        &#39;node_indices = [((0, 0.25), (1, 0.75))]&#39; will create a node which is</span>
<span class="sd">        a weighted combination of nodes 0 and 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first_node_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">new_node_indices</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_indices</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="c1"># format node_indices such that each value is of the given form:</span>
        <span class="c1"># ((index, weight), (index2, weight2), ...)</span>
        <span class="n">new_node_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index_list</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
            <span class="n">new_index_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">new_index_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">index_list</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index_list</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">specifier</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specifier</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">new_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">specifier</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">length</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">specifier</span><span class="p">)</span>
            <span class="n">new_node_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_index_list</span><span class="p">)</span>
        <span class="n">node_indices</span> <span class="o">=</span> <span class="n">new_node_indices</span>
        <span class="c1"># ensure weights add up to 1</span>
        <span class="k">for</span> <span class="n">index_list</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-14</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bug</span><span class="p">(</span>
                    <span class="s2">&quot;Incorrect weights.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;The given node averaging weights do not add up &quot;</span> <span class="s2">&quot;to 1.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># create the new nodes</span>
        <span class="n">first_new_node_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index_list</span> <span class="ow">in</span> <span class="n">node_indices</span><span class="p">:</span>
            <span class="n">this_new_node</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_new_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_nodes</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span>
        <span class="c1"># update self.node_fields</span>
        <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                <span class="n">new_values</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">weight</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">index_list</span> <span class="ow">in</span> <span class="n">node_indices</span>
                <span class="p">]</span>
                <span class="n">values</span><span class="p">[</span><span class="n">first_node_index</span><span class="p">:]</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="c1"># update self.node_sets</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">():</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">members_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="n">index_from_member_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">node_index</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">node_index</span><span class="p">,</span> <span class="n">index_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_indices</span><span class="p">):</span>
                <span class="n">check</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">members_set</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># okay, we need to add this node to the set</span>
                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_new_node_index</span> <span class="o">+</span> <span class="n">node_index</span><span class="p">)</span>
                <span class="c1"># and calculate its value for all fields</span>
                <span class="k">for</span> <span class="n">all_values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                        <span class="n">new_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                            <span class="n">weight</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="n">index_from_member_index</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">index_list</span>
                        <span class="p">)</span>
                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.unmerge_element_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.unmerge_element_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">unmerge_element_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Duplicate nodes to unmerge element blocks.</span>

<span class="sd">        For elements blocks that share one or more nodes, duplicate these nodes</span>
<span class="sd">        and unmerge the element blocks.  For example, if element block A and B</span>
<span class="sd">        share node 1, that node will be duplicated, block A will use the</span>
<span class="sd">        original node and block B will use the duplicate.</span>

<span class="sd">        Node fields, node sets, and node set fields are updated accordingly.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.unmerge_element_blocks()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Separate each pair of blocks.  Keep nodes on block id1 the same and</span>
        <span class="c1"># create new nodes for block id2.  Update node fields.  Update node</span>
        <span class="c1"># sets such that if a shared node is part of the set, the duplicated</span>
        <span class="c1"># node is also part of the set.</span>
        <span class="k">for</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">shared_nodes_set</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">id1</span><span class="p">)),</span>
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">id2</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="n">shared_nodes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">shared_nodes_set</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shared_nodes</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># on block id2, old node x becomes new node</span>
            <span class="c1"># node_offset + shared_nodes.index(x)</span>
            <span class="c1"># create the new nodes</span>
            <span class="n">new_shared_nodes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_duplicate_nodes</span><span class="p">(</span><span class="n">shared_nodes</span><span class="p">,</span> <span class="n">new_shared_nodes</span><span class="p">)</span>
            <span class="c1"># update element block 2 connectivity</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectivity</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node_index</span> <span class="ow">in</span> <span class="n">shared_nodes_set</span><span class="p">:</span>
                    <span class="n">connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_shared_nodes</span><span class="p">[</span>
                        <span class="n">shared_nodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node_index</span><span class="p">)</span>
                    <span class="p">]</span>
            <span class="c1"># blocks should no longer share nodes</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">id1</span><span class="p">)),</span>
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">id2</span><span class="p">)),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.import_model"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.import_model">[docs]</a>    <span class="k">def</span> <span class="nf">import_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">timesteps</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">node_field_names</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">element_field_names</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">global_variable_names</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">node_set_field_names</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">side_set_field_names</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import information from an ExodusII file.</span>

<span class="sd">        This will add to the current model in memory, so multiple calls will</span>
<span class="sd">        act to merge files.  As a shortcut, one may use the</span>
<span class="sd">        &#39;exomerge.import_model&#39; to create a new model from a file.</span>
<span class="sd">        &gt;&gt;&gt; model = exomerge.import_model(&#39;output.e&#39;)</span>

<span class="sd">        By default, this will import all information from the given ExodusII</span>
<span class="sd">        results file.  To import only part of a mesh file, or to load only a</span>
<span class="sd">        particular timestep, one can use the following options.</span>
<span class="sd">        &gt;&gt;&gt; model.import_model(&#39;output.e&#39;, element_block_ids=[1, 2])</span>
<span class="sd">        &gt;&gt;&gt; model.import_model(&#39;output.e&#39;, timesteps=&#39;last&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.import_model(&#39;output.e&#39;, node_field_names=&#39;disp_*&#39;)</span>

<span class="sd">        To import only the mesh without any field information, one can use the</span>
<span class="sd">        following syntax.</span>
<span class="sd">        &gt;&gt;&gt; model.import_model(&#39;output.e&#39;, timesteps=&#39;none&#39;)</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.import_model(&#39;mesh_file.g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.import_model(&#39;results_file.e&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># open the file for read</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                <span class="s2">&quot;File not found&quot;</span><span class="p">,</span> <span class="s1">&#39;The specified file &quot;</span><span class="si">%s</span><span class="s1">&quot; was not found.&#39;</span> <span class="o">%</span> <span class="n">filename</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">save_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">DummyFile</span><span class="p">()</span>
        <span class="n">exodus_file</span> <span class="o">=</span> <span class="n">exodus</span><span class="o">.</span><span class="n">exodus</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">save_stdout</span>
        <span class="c1"># format timesteps to retrieve</span>
        <span class="n">file_timesteps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">timesteps</span> <span class="o">==</span> <span class="s2">&quot;last_if_any&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_timesteps</span><span class="p">:</span>
                <span class="n">timesteps</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timesteps</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">file_timesteps</span><span class="p">,</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="c1"># format block id list</span>
        <span class="n">file_element_block_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">())</span>
        <span class="n">file_element_block_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">file_element_block_ids</span><span class="p">:</span>
            <span class="n">file_element_block_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_elem_blk_names</span><span class="p">())</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_element_block_ids</span><span class="p">),</span> <span class="s2">&quot;element block&quot;</span>
        <span class="p">)</span>
        <span class="c1"># format other id lists</span>
        <span class="n">node_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_field_names</span><span class="p">,</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">())),</span>
            <span class="s2">&quot;node field&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">file_element_field_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_element_variable_names</span><span class="p">())</span>
        <span class="n">element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">element_field_names</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_element_field_names</span><span class="p">),</span> <span class="s2">&quot;element field&quot;</span>
        <span class="p">)</span>
        <span class="n">file_side_set_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">())</span>
        <span class="n">file_side_set_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">file_side_set_ids</span><span class="p">:</span>
            <span class="n">file_side_set_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_side_set_names</span><span class="p">())</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">side_set_ids</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_side_set_ids</span><span class="p">),</span> <span class="s2">&quot;side set&quot;</span>
        <span class="p">)</span>
        <span class="n">file_node_set_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">())</span>
        <span class="n">file_node_set_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">file_node_set_ids</span><span class="p">:</span>
            <span class="n">file_node_set_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_set_names</span><span class="p">())</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_set_ids</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_node_set_ids</span><span class="p">),</span> <span class="s2">&quot;node set&quot;</span>
        <span class="p">)</span>
        <span class="n">global_variable_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">global_variable_names</span><span class="p">,</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">())),</span>
            <span class="s2">&quot;global variable&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">file_node_set_field_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_set_variable_names</span><span class="p">())</span>
        <span class="n">node_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_set_field_names</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_node_set_field_names</span><span class="p">),</span> <span class="s2">&quot;node set field&quot;</span>
        <span class="p">)</span>
        <span class="n">file_side_set_field_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">get_side_set_variable_names</span><span class="p">())</span>
        <span class="n">side_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">side_set_field_names</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_side_set_field_names</span><span class="p">),</span> <span class="s2">&quot;node set field&quot;</span>
        <span class="p">)</span>
        <span class="c1"># ensure element blocks in this file do not already exist</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_block_exists</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
                    <span class="s2">&quot;Element block already exists.&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;Cannot import element block &quot;</span><span class="si">%d</span><span class="s1">&quot; since it already &#39;</span>
                    <span class="s2">&quot;exists in the model.&quot;</span> <span class="o">%</span> <span class="n">element_block_id</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># create new nodes used in this file</span>
        <span class="n">node_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="c1"># store nodes we are going to import</span>
        <span class="c1"># if we&#39;re importing all element blocks, then import all nodes</span>
        <span class="c1"># else only import nodes in the element blocks we&#39;re choosing</span>
        <span class="c1"># note that if there are no element blocks, this means we import all</span>
        <span class="c1"># nodes</span>
        <span class="c1"># note: new_used_nodes is 1-based</span>
        <span class="k">if</span> <span class="n">element_block_ids</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_element_block_ids</span><span class="p">):</span>
            <span class="n">new_used_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_used_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">()</span>
            <span class="c1"># add nodes in blocks we are importing</span>
            <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="n">connectivity</span> <span class="o">=</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_elem_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
                    <span class="n">new_used_nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># save indices for nodes we want to import</span>
            <span class="n">new_used_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_used_nodes</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
        <span class="c1"># get new node coordinates</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">file_coords</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_used_nodes</span><span class="p">:</span>
            <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">file_coords</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
        <span class="c1"># create node mapping</span>
        <span class="c1"># node i in the file refers to node node_map[i] in the model</span>
        <span class="n">node_map</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_used_nodes</span><span class="p">):</span>
            <span class="n">node_map</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">node_offset</span>
        <span class="c1"># create new nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_nodes</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span>
        <span class="c1"># find element mapping</span>
        <span class="c1"># element i in the file refers to</span>
        <span class="c1"># - element block id file_block_from_element[i]</span>
        <span class="c1"># - local element index file_index_from_element[i]</span>
        <span class="c1"># in the model</span>
        <span class="n">elements_in_block</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">file_element_block_ids</span><span class="p">:</span>
            <span class="n">elements_in_block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">elem_blk_info</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">file_block_from_element</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">file_index_from_element</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ebid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_element_block_ids</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ebid</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="n">file_block_from_element</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">ebid</span><span class="p">]</span> <span class="o">*</span> <span class="n">elements_in_block</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">file_index_from_element</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">elements_in_block</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_block_from_element</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">elements_in_block</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">file_index_from_element</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">elements_in_block</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># create new element blocks</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">new_connectivity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_elem_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># apply node map</span>
            <span class="n">new_connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_connectivity</span><span class="p">]</span>
            <span class="c1"># get the element block name</span>
            <span class="n">element_block_name</span> <span class="o">=</span> <span class="n">file_element_block_names</span><span class="p">[</span>
                <span class="n">file_element_block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># create the element block</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
                <span class="n">element_block_id</span><span class="p">,</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">elem_blk_info</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)),</span>
                <span class="n">connectivity</span><span class="o">=</span><span class="n">new_connectivity</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">element_block_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_element_block</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">,</span> <span class="n">element_block_name</span><span class="p">)</span>
        <span class="c1"># get indices of each timestep and create new timesteps</span>
        <span class="c1"># list of (timestep_index_in_file, timestep_index_in_model)</span>
        <span class="n">timestep_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">duplicate_timesteps</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="n">timesteps</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep_exists</span><span class="p">(</span><span class="n">timestep</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_timestep</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">duplicate_timesteps</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">timestep_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">file_timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_timestep_index</span><span class="p">(</span><span class="n">timestep</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># get list of timestep indices present in the model but not included</span>
        <span class="c1"># in the import</span>
        <span class="n">included_timestep_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">]</span>
        <span class="n">excluded_timestep_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">included_timestep_indices</span><span class="p">:</span>
                <span class="n">excluded_timestep_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># create new node fields</span>
        <span class="k">for</span> <span class="n">node_field_name</span> <span class="ow">in</span> <span class="n">node_field_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_field_exists</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_node_field</span><span class="p">(</span><span class="n">node_field_name</span><span class="p">)</span>
        <span class="c1"># populate node field info</span>
        <span class="k">for</span> <span class="n">node_field_name</span> <span class="ow">in</span> <span class="n">node_field_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                <span class="n">file_node_field_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_variable_values</span><span class="p">(</span>
                        <span class="n">node_field_name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">model_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">node_field_name</span><span class="p">][</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_used_nodes</span><span class="p">:</span>
                    <span class="n">model_values</span><span class="p">[</span><span class="n">node_map</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">file_node_field_values</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># populate node sets</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="n">file_node_set_members</span> <span class="o">=</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_set_nodes</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">model_node_set_members</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># add nodes which were included</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">file_node_set_members</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">model_node_set_members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_map</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># create the node set or add to an existing set</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set_exists</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_node_set</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">,</span> <span class="n">model_node_set_members</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_nodes_to_node_set</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">,</span> <span class="n">model_node_set_members</span><span class="p">)</span>
            <span class="n">node_set_name</span> <span class="o">=</span> <span class="n">file_node_set_names</span><span class="p">[</span><span class="n">file_node_set_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">node_set_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_node_set</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">,</span> <span class="n">node_set_name</span><span class="p">)</span>
        <span class="c1"># populate side sets</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">file_side_set_members</span> <span class="o">=</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">model_side_set_members</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># add nodes which were included</span>
            <span class="k">for</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">side_number</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">file_side_set_members</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">file_block_from_element</span><span class="p">[</span><span class="n">element_index</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">model_side_set_members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">file_block_from_element</span><span class="p">[</span><span class="n">element_index</span><span class="p">],</span>
                            <span class="n">file_index_from_element</span><span class="p">[</span><span class="n">element_index</span><span class="p">],</span>
                            <span class="n">side_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="c1"># create the side set or add to an existing set</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_set_exists</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">model_side_set_members</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_faces_to_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">model_side_set_members</span><span class="p">)</span>
            <span class="n">side_set_name</span> <span class="o">=</span> <span class="n">file_side_set_names</span><span class="p">[</span><span class="n">file_side_set_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">side_set_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">side_set_name</span><span class="p">)</span>
        <span class="c1"># store truth table for node set field info</span>
        <span class="k">if</span> <span class="n">node_set_field_names</span><span class="p">:</span>
            <span class="n">file_node_set_truth_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file_node_set_id</span> <span class="ow">in</span> <span class="n">file_node_set_ids</span><span class="p">:</span>
                <span class="n">file_node_set_truth_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_set_variable_truth_table</span><span class="p">(</span><span class="n">file_node_set_id</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># populate node set fields</span>
        <span class="k">for</span> <span class="n">node_set_field_name</span> <span class="ow">in</span> <span class="n">node_set_field_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
                <span class="c1"># don&#39;t process if field does not exist in file</span>
                <span class="n">field_exists</span> <span class="o">=</span> <span class="n">file_node_set_truth_table</span><span class="p">[</span>
                    <span class="n">file_node_set_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
                <span class="p">][</span><span class="n">file_node_set_field_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node_set_field_name</span><span class="p">)]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field_exists</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># process each included timestep</span>
                <span class="n">model_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                    <span class="n">file_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_node_set_variable_values</span><span class="p">(</span>
                            <span class="n">node_set_id</span><span class="p">,</span> <span class="n">node_set_field_name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">model_values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">file_values</span>
                <span class="c1"># add default field value to excluded timestep</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">excluded_timestep_indices</span><span class="p">:</span>
                    <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">node_set_field_name</span><span class="p">)</span>
                    <span class="n">node_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">))</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_value</span><span class="p">]</span> <span class="o">*</span> <span class="n">node_count</span>
                    <span class="n">model_values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
                <span class="c1"># assign all values</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">node_set_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_values</span>
        <span class="c1"># store truth table for side set field info</span>
        <span class="k">if</span> <span class="n">side_set_field_names</span><span class="p">:</span>
            <span class="n">file_side_set_truth_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file_side_set_id</span> <span class="ow">in</span> <span class="n">file_side_set_ids</span><span class="p">:</span>
                <span class="n">file_side_set_truth_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_side_set_variable_truth_table</span><span class="p">(</span><span class="n">file_side_set_id</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># populate side set fields</span>
        <span class="k">for</span> <span class="n">side_set_field_name</span> <span class="ow">in</span> <span class="n">side_set_field_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
                <span class="c1"># don&#39;t process if field does not exist in file</span>
                <span class="n">field_exists</span> <span class="o">=</span> <span class="n">file_side_set_truth_table</span><span class="p">[</span>
                    <span class="n">file_side_set_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="p">][</span><span class="n">file_side_set_field_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">side_set_field_name</span><span class="p">)]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field_exists</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># process each included timestep</span>
                <span class="n">model_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                    <span class="n">file_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_side_set_variable_values</span><span class="p">(</span>
                            <span class="n">side_set_id</span><span class="p">,</span> <span class="n">side_set_field_name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">model_values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">file_values</span>
                <span class="c1"># add default field value to excluded timestep</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">excluded_timestep_indices</span><span class="p">:</span>
                    <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">side_set_field_name</span><span class="p">)</span>
                    <span class="n">side_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">))</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_value</span><span class="p">]</span> <span class="o">*</span> <span class="n">side_count</span>
                    <span class="n">model_values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
                <span class="c1"># assign all values</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">side_set_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_values</span>
        <span class="c1"># store truth table for element field info</span>
        <span class="k">if</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="n">file_truth_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file_element_block_id</span> <span class="ow">in</span> <span class="n">file_element_block_ids</span><span class="p">:</span>
                <span class="n">file_truth_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_element_variable_truth_table</span><span class="p">(</span><span class="n">file_element_block_id</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># populate element fields</span>
        <span class="k">for</span> <span class="n">element_field_name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
                <span class="c1"># don&#39;t process if field does not exist in file</span>
                <span class="n">field_exists</span> <span class="o">=</span> <span class="n">file_truth_table</span><span class="p">[</span>
                    <span class="n">file_element_block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="p">][</span><span class="n">file_element_field_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">)]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field_exists</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># process each included timestep</span>
                <span class="n">model_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                    <span class="n">file_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_element_variable_values</span><span class="p">(</span>
                            <span class="n">element_block_id</span><span class="p">,</span> <span class="n">element_field_name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">model_values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">file_values</span>
                <span class="c1"># add default field value to excluded timestep</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">excluded_timestep_indices</span><span class="p">:</span>
                    <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_field_value</span><span class="p">(</span><span class="n">element_field_name</span><span class="p">)</span>
                    <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_value</span><span class="p">]</span> <span class="o">*</span> <span class="n">element_count</span>
                    <span class="n">model_values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
                <span class="c1"># assign all values</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">element_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_values</span>
        <span class="c1"># get global variables</span>
        <span class="k">for</span> <span class="n">global_variable_name</span> <span class="ow">in</span> <span class="n">global_variable_names</span><span class="p">:</span>
            <span class="c1"># create the variable</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_variable_exists</span><span class="p">(</span><span class="n">global_variable_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_global_variable</span><span class="p">(</span><span class="n">global_variable_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">duplicate_timesteps</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_exists_warning</span><span class="p">(</span><span class="n">global_variable_name</span><span class="p">,</span> <span class="s2">&quot;global variable&quot;</span><span class="p">)</span>
            <span class="c1"># get values</span>
            <span class="n">model_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">global_variable_name</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                <span class="n">file_value</span> <span class="o">=</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_global_variable_value</span><span class="p">(</span>
                    <span class="n">global_variable_name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">model_values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">file_value</span>
        <span class="c1"># add info records</span>
        <span class="k">if</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">num_info_records</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span> <span class="o">+=</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_info_records</span><span class="p">()</span>
        <span class="c1"># add qa records</span>
        <span class="k">if</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">num_qa_records</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span> <span class="o">+=</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">get_qa_records</span><span class="p">()</span>
        <span class="c1"># add title if one does not already exist</span>
        <span class="c1"># else add it to an info record</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">exodus_file</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Discarded title from the &quot;</span> <span class="s2">&quot;following file:&quot;</span><span class="p">)</span>
            <span class="c1"># split filename string if filename is larger than 79 characters</span>
            <span class="n">filename_wrap_list</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">79</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># append interpreter continuation char &quot;\\&quot; to end of continuation line while splitting</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filename_wrap_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">filename_wrap_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="c1"># append multiple split list to records</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filename_wrap_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exodus_file</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
        <span class="c1"># run a check on the model to ensure arrays are correct sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">()</span>
        <span class="c1"># close the file</span>
        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">save_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">DummyFile</span><span class="p">()</span>
        <span class="n">exodus_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">save_stdout</span></div>

<div class="viewcode-block" id="ExodusModel.export_model"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.export_model">[docs]</a>    <span class="k">def</span> <span class="nf">export_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;output_exomerge.e&quot;</span><span class="p">,</span>
        <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">timesteps</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">side_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">node_set_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">global_variable_names</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">node_field_names</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">element_field_names</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">side_set_field_names</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">node_set_field_names</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the current model to an ExodusII file.</span>

<span class="sd">        Examples:</span>
<span class="sd">        &gt;&gt;&gt; model.export_model(&#39;output.g&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># verify information is valid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">()</span>
        <span class="c1"># format subset of data to export</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="n">node_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_node_set_id_list</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timesteps</span><span class="p">(),</span> <span class="s2">&quot;timestep&quot;</span><span class="p">)</span>
        <span class="c1"># If no timesteps are exported, or if no nodes are defined, then no</span>
        <span class="c1"># fields can be exported.</span>
        <span class="k">if</span> <span class="n">element_field_names</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timesteps</span><span class="p">:</span>
                <span class="n">element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element_field_names</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="k">if</span> <span class="n">global_variable_names</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timesteps</span><span class="p">:</span>
                <span class="n">global_variable_names</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">global_variable_names</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="k">if</span> <span class="n">node_field_names</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="n">node_field_names</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node_field_names</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="k">if</span> <span class="n">node_set_field_names</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="n">node_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node_set_field_names</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="k">if</span> <span class="n">side_set_field_names</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timesteps</span><span class="p">:</span>
                <span class="n">side_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">side_set_field_names</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="c1"># format each list</span>
        <span class="n">global_variable_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">global_variable_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">(),</span> <span class="s2">&quot;global variable&quot;</span>
        <span class="p">)</span>
        <span class="n">element_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">element_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_field_names</span><span class="p">(),</span> <span class="s2">&quot;element field&quot;</span>
        <span class="p">)</span>
        <span class="n">node_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_field_names</span><span class="p">(),</span> <span class="s2">&quot;node field&quot;</span>
        <span class="p">)</span>
        <span class="n">node_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">node_set_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">(),</span> <span class="s2">&quot;node set field&quot;</span>
        <span class="p">)</span>
        <span class="n">side_set_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_id_list</span><span class="p">(</span>
            <span class="n">side_set_field_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">(),</span> <span class="s2">&quot;side set field&quot;</span>
        <span class="p">)</span>
        <span class="c1"># delete the file if it exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># create file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&lt;no title supplied&gt;&quot;</span>

        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">save_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">DummyFile</span><span class="p">()</span>
        <span class="n">new_file</span> <span class="o">=</span> <span class="n">exodus</span><span class="o">.</span><span class="n">exodus</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ctype&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">node_set_ids</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">save_stdout</span>
        <span class="c1"># put timesteps into chronological order</span>
        <span class="n">timestep_indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># write times</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_time</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># write global variables</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">set_global_variable_number</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">global_variable_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_variable_names</span><span class="p">):</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_global_variable_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">put_global_variable_value</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="p">)</span>
        <span class="c1"># write nodes</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">put_coords</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">],</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">],</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># write node fields</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">set_node_variable_number</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_field_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_field_names</span><span class="p">):</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_node_variable_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">put_node_variable_values</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="p">)</span>
        <span class="c1"># write element blocks</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_elem_blk_info</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
            <span class="c1"># connectivity in file must be 1-based</span>
            <span class="n">temp_connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">]</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_elem_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">temp_connectivity</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">put_elem_blk_name</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># write element fields</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">set_element_variable_number</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element_field_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">element_field_names</span><span class="p">):</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_element_variable_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element_field_names</span><span class="p">:</span>
            <span class="n">truth_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element_field_truth_table</span><span class="p">(</span>
                <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">element_field_names</span>
            <span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">set_element_variable_truth_table</span><span class="p">(</span><span class="n">truth_table</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_block_fields</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">element_field_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                    <span class="n">new_file</span><span class="o">.</span><span class="n">put_element_variable_values</span><span class="p">(</span>
                        <span class="n">block_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">)</span>
        <span class="c1"># get first element in each block</span>
        <span class="n">element_count</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">]</span>
        <span class="n">first_element</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">element_count</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element_count</span><span class="p">))]</span>
        <span class="n">first_element</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">element_block_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">first_element</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="c1"># write side sets</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_name</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_side_set_params</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">members</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">first_element</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">members</span>
                <span class="p">]</span>
                <span class="n">sides</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">put_side_set</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">sides</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">put_side_set_name</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># write side set fields</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">set_side_set_variable_number</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">side_set_field_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">side_set_field_names</span><span class="p">):</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_side_set_variable_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">side_set_field_names</span><span class="p">:</span>
            <span class="n">truth_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_side_set_field_truth_table</span><span class="p">(</span>
                <span class="n">side_set_ids</span><span class="p">,</span> <span class="n">side_set_field_names</span>
            <span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">set_side_set_variable_truth_table</span><span class="p">(</span><span class="n">truth_table</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">side_set_id</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_side_set_fields</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">members</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">side_set_field_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                    <span class="n">new_file</span><span class="o">.</span><span class="n">put_side_set_variable_values</span><span class="p">(</span>
                        <span class="n">side_set_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">)</span>
        <span class="c1"># write node sets</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_name</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_node_set_params</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">members</span><span class="p">:</span>
                <span class="c1"># convert to 1-based indexing</span>
                <span class="n">temp_members</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">put_node_set</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">temp_members</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">put_node_set_name</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># write node set fields</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">set_node_set_variable_number</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_set_field_names</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_set_field_names</span><span class="p">):</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">put_node_set_variable_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node_set_field_names</span><span class="p">:</span>
            <span class="n">truth_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_node_set_field_truth_table</span><span class="p">(</span>
                <span class="n">node_set_ids</span><span class="p">,</span> <span class="n">node_set_field_names</span>
            <span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">set_node_set_variable_truth_table</span><span class="p">(</span><span class="n">truth_table</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_set_id</span> <span class="ow">in</span> <span class="n">node_set_ids</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_set_fields</span><span class="p">(</span><span class="n">node_set_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">members</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">node_set_field_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">timestep_index</span> <span class="ow">in</span> <span class="n">timestep_indices</span><span class="p">:</span>
                    <span class="n">new_file</span><span class="o">.</span><span class="n">put_node_set_variable_values</span><span class="p">(</span>
                        <span class="n">node_set_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timestep_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">[</span><span class="n">timestep_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">)</span>
        <span class="c1"># write info records</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">put_info_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_records</span><span class="p">)</span>
        <span class="c1"># write qa records (and append one for this program)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_qa_record</span><span class="p">())</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">put_qa_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># close file</span>
        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">save_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">DummyFile</span><span class="p">()</span>
        <span class="n">new_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">SUPPRESS_EXODUS_OUTPUT</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">save_stdout</span></div>

<div class="viewcode-block" id="ExodusModel.get_side_set_area"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_side_set_area">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total area of the given side sets.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model.get_side_set_area(&#39;all&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="c1"># we do this by first creating one or more new element block out of</span>
        <span class="c1"># the faces within the side sets and then calculating their &quot;volume.&quot;</span>
        <span class="n">new_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element_blocks_from_side_sets</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="n">total_area</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">new_blocks</span><span class="p">:</span>
            <span class="n">total_area</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_volume</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_element_block</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">delete_orphaned_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total_area</span></div>

    <span class="k">def</span> <span class="nf">_get_thickness_from_volume_and_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the thickness of a disk given the volume and area.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">volume</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># max phi (for a sphere) is 6^(-1/3) * pi^(-1/6)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="c1"># find a solution, if possible</span>
        <span class="n">max_alpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mf">6.0</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">low</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">max_alpha</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">phi</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.75</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.125</span>
        <span class="n">high_value</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">high</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">high</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">high</span> <span class="o">+</span> <span class="n">d</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">53</span><span class="p">):</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">mid_value</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">high</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">high</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">high</span> <span class="o">+</span> <span class="n">d</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">high_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">mid_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">high_value</span> <span class="o">=</span> <span class="n">mid_value</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">mid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">low</span> <span class="o">=</span> <span class="n">mid</span>
        <span class="c1"># in the case this fails, return NaN</span>
        <span class="k">if</span> <span class="n">low</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">high</span> <span class="o">==</span> <span class="n">max_alpha</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">volume</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">height</span>

    <span class="k">def</span> <span class="nf">_calculate_element_block_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the approximate thickness of the given element blocks.</span>

<span class="sd">        This approximates the thickness by calculating the volume and exposed</span>
<span class="sd">        surface area of the element blocks, then returning the thickness of a</span>
<span class="sd">        short disk with the same characteristics.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># delete any element blocks which are not of dimension 3</span>
        <span class="n">new_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_dimension</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Unexpected element block dimension&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Element blocks used to determine element edge &quot;</span>
                    <span class="s2">&quot;length are expected to be of dimension 3.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
        <span class="c1"># get the volume</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_volume</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># find the external faces and put them into a side set</span>
        <span class="n">external_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_external_element_faces</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># find all face types</span>
        <span class="n">side_set_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_side_set_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">external_faces</span><span class="p">)</span>
        <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_area</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_thickness_from_volume_and_area</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.get_element_block_extents"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_block_extents">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_block_extents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the extents of the element blocks as a list.</span>

<span class="sd">        The results are returned in the following format:</span>
<span class="sd">        [[min_x, max_x], [min_y, max_y], [min_z, max_z]]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># get a set of all nodes within the given element blocks</span>
        <span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">all_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">connectivity</span><span class="p">))</span>
        <span class="c1"># find the extents of that set</span>
        <span class="n">extents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">),</span>
                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">extents</span></div>

    <span class="k">def</span> <span class="nf">_create_element_blocks_from_side_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create new element block from the members of the given side sets.</span>

<span class="sd">        A list of new element block ids is returned.  Typically, only one</span>
<span class="sd">        ID is in the list, but since multiple face types can be present within</span>
<span class="sd">        the sideset, and element blocks can only contain a single element type,</span>
<span class="sd">        it is sometimes necessary to make more than one element block.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">side_set_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_side_set_id_list</span><span class="p">(</span><span class="n">side_set_ids</span><span class="p">)</span>
        <span class="c1"># create a dict for new face elements to create</span>
        <span class="c1"># e.g. new_elements[&#39;quad4&#39;] = [[1, 2, 3, 4], [5, 6, 7, 8], ...]</span>
        <span class="n">new_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">side_set_ids</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">these_members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_element_faces_by_block</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_block_id</span><span class="p">,</span> <span class="n">members</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">these_members</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                    <span class="n">face_type</span> <span class="o">=</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">face_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_elements</span><span class="p">:</span>
                        <span class="n">new_elements</span><span class="p">[</span><span class="n">face_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                        <span class="n">element_index</span>
                        <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="o">*</span> <span class="n">nodes_per_element</span>
                    <span class="p">]</span>
                    <span class="n">new_elements</span><span class="p">[</span><span class="n">face_type</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="p">)</span>
        <span class="c1"># now that we have the face elements in a local format, we create</span>
        <span class="c1"># the elements</span>
        <span class="n">new_block_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">connectivity</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_elements</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">new_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="n">element_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NODES_PER_ELEMENT</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NODES_PER_ELEMENT</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">element_type</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="n">nodes_per_element</span><span class="p">,</span>
                <span class="n">nodes_per_element</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span><span class="n">new_id</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">)</span>
            <span class="n">new_block_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_block_ids</span>

    <span class="k">def</span> <span class="nf">_get_element_edge_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of element edges for the given element type.</span>

<span class="sd">        The returned list is a list of 2-tuples of local element node indices.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
        <span class="c1"># if not a standard type, then we don&#39;t know the edge indices</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># if dimension is zero, it doesn&#39;t have edges</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dimension</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># create a mock element</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">elements</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NODES_PER_ELEMENT</span><span class="p">[</span><span class="n">element_type</span><span class="p">]))]</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dimension</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># iterate until dimensions are zero</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
            <span class="n">new_elements</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">connectivities</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">face_type</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">face_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_elements</span><span class="p">:</span>
                        <span class="n">new_elements</span><span class="p">[</span><span class="n">face_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">local_nodes</span> <span class="ow">in</span> <span class="n">connectivities</span><span class="p">:</span>
                        <span class="n">new_elements</span><span class="p">[</span><span class="n">face_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">local_nodes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
                        <span class="p">)</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">new_elements</span>
        <span class="c1"># now find the endpoints using the volume formula</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">assert</span> <span class="n">element_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOLUME_FORMULA</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIMENSION</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOLUME_FORMULA</span><span class="p">[</span><span class="n">element_type</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">local_nodes</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">local_nodes</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">])</span>
        <span class="c1"># now get the unique edges</span>
        <span class="n">unique_edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique_edges</span>

<div class="viewcode-block" id="ExodusModel.get_element_edge_length_info"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_element_edge_length_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_edge_length_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the minimum and average element edge lengths.</span>

<span class="sd">        Only edges within element in the specified element blocks are counted.</span>
<span class="sd">        All element blocks specified must be 3-dimensional.</span>

<span class="sd">        The result is returned as [minimum, average].</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">edge_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="c1"># get the edge endpoint info</span>
            <span class="n">endpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_edge_indices</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># form all element edges</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">edge_count</span> <span class="o">+=</span> <span class="n">element_count</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">endpoints</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">:</span>
                    <span class="n">this_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_between</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">local_node</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">local_node</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
                    <span class="p">)</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="n">this_distance</span>
                    <span class="k">if</span> <span class="n">this_distance</span> <span class="o">&lt;</span> <span class="n">minimum</span><span class="p">:</span>
                        <span class="n">minimum</span> <span class="o">=</span> <span class="n">this_distance</span>
        <span class="k">if</span> <span class="n">edge_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">total</span> <span class="o">/</span> <span class="n">edge_count</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_closest_point_distance_brute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the distance between the two closest points.&quot;&quot;&quot;</span>
        <span class="n">point_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">point_count</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_between</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">dist</span>

    <span class="k">def</span> <span class="nf">_get_closest_point_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">sorting_coord</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the distance between the two closest points.&quot;&quot;&quot;</span>
        <span class="c1"># handle cases of 3 or less points by brute force</span>
        <span class="n">point_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">point_count</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance_brute</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="c1"># find min and max values for the sorting coord</span>
        <span class="n">low</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sorting_coord</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span>
        <span class="n">high</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sorting_coord</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span>
        <span class="c1"># if min and max values are the same, change the coord and try again</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">low</span> <span class="o">==</span> <span class="n">mid</span> <span class="ow">or</span> <span class="n">mid</span> <span class="o">==</span> <span class="n">high</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trials</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance_brute</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance</span><span class="p">(</span>
                <span class="n">points</span><span class="p">,</span> <span class="p">(</span><span class="n">sorting_coord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">,</span> <span class="n">trials</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="c1"># sort into two lists</span>
        <span class="n">low_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">sorting_coord</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">]</span>
        <span class="n">high_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">sorting_coord</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mid</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">low_points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">point_count</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">high_points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">point_count</span>
        <span class="c1"># find closest pair within each set</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance</span><span class="p">(</span><span class="n">low_points</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance</span><span class="p">(</span><span class="n">high_points</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">del</span> <span class="n">low_points</span>
        <span class="k">del</span> <span class="n">high_points</span>
        <span class="c1"># find points sufficiently close to centerline</span>
        <span class="n">mid_low</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="n">dist</span>
        <span class="n">mid_high</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="n">dist</span>
        <span class="n">mid_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">points</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">sorting_coord</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mid_low</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="n">sorting_coord</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">mid_high</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid_points</span><span class="p">)</span> <span class="o">==</span> <span class="n">point_count</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance_brute</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance</span><span class="p">(</span><span class="n">mid_points</span><span class="p">,</span> <span class="p">(</span><span class="n">sorting_coord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">dist</span>

<div class="viewcode-block" id="ExodusModel.get_closest_node_distance"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.get_closest_node_distance">[docs]</a>    <span class="k">def</span> <span class="nf">get_closest_node_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the distance between the two closest nodes.&quot;&quot;&quot;</span>
        <span class="c1"># create list of all nodes</span>
        <span class="n">point_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_closest_point_distance</span><span class="p">(</span><span class="n">point_list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_input_check_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Report an error that the argument is not of the expected format.</span>

<span class="sd">        This is a helper function which gets called by _input_check in several</span>
<span class="sd">        places.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">argument_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">argument</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument_string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">argument_string</span> <span class="o">=</span> <span class="n">argument_string</span><span class="p">[:</span><span class="mi">47</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">arg_format</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">format_string</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">[:</span><span class="mi">47</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span>
            <span class="s2">&quot;Unexpected argument type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;The argument to a function failed an input check.  This &quot;</span>
            <span class="s2">&quot;is most likely due to passing an invalid argument to &quot;</span>
            <span class="s2">&quot;the function.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Argument: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Expected type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">argument_string</span><span class="p">,</span> <span class="n">format_string</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_input_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify an argument is of the expected format.</span>

<span class="sd">        For example, to check if an argument is a list of 3 integers, set</span>
<span class="sd">        arg_format=[list, 3, int]</span>

<span class="sd">        For example, to check if an argument is a list of at least 3 integers,</span>
<span class="sd">        set arg_format=[list, -3, int]</span>

<span class="sd">        To check if an argument is a list of 3 lists, each with 2 integers, set</span>
<span class="sd">        arg_format=[list, 3, list, 2, int].</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; model._argument_check([1, 2, 3], [list, 3, int])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_format</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_format</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_format</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_input_check_error</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span> <span class="o">!=</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_input_check_error</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">arg_format</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_input_check_error</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_format</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">argument</span><span class="o">.</span><span class="n">is_integer</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_input_check_error</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_input_check_error</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_input_check_error</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_input_check_error</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">arg_format</span><span class="p">)</span>

<div class="viewcode-block" id="ExodusModel.build_hex8_cube"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.build_hex8_cube">[docs]</a>    <span class="k">def</span> <span class="nf">build_hex8_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_id</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">extents</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">divisions</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an element block in the shape of a cuboid.</span>

<span class="sd">        Extent defines the extent of the block in the form</span>
<span class="sd">        &#39;[[minx, maxx], [miny, maxy], [minz, maxz]]&#39;.  If only one value per</span>
<span class="sd">        dimension is given, the minimum is assumed to be zero.  If a single</span>
<span class="sd">        value is given, it is assumed a cube with that edge length, with min=0</span>
<span class="sd">        for all dimensions.</span>

<span class="sd">        Divisions is the number of divisions per dimension.  This can be</span>
<span class="sd">        defined as a single number for all dimensions or as a list of</span>
<span class="sd">        3 numbers.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># process shortcuts on arguments</span>
        <span class="k">if</span> <span class="n">element_block_id</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">element_block_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_block_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">])</span>
            <span class="n">extents</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">extents</span><span class="p">)]]</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extents</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">])</span>
                    <span class="n">extents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">divisions</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">divisions</span> <span class="o">=</span> <span class="p">[</span><span class="n">divisions</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="c1"># verify the input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_check</span><span class="p">(</span><span class="n">divisions</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span>
        <span class="n">dimx</span><span class="p">,</span> <span class="n">dimy</span><span class="p">,</span> <span class="n">dimz</span> <span class="o">=</span> <span class="n">divisions</span>
        <span class="p">[[</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">],</span> <span class="p">[</span><span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">],</span> <span class="p">[</span><span class="n">minz</span><span class="p">,</span> <span class="n">maxz</span><span class="p">]]</span> <span class="o">=</span> <span class="n">extents</span>
        <span class="c1"># create the nodes</span>
        <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">node_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">minz</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxz</span> <span class="o">-</span> <span class="n">minz</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">dimz</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">miny</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">dimy</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">minx</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">dimx</span>
                    <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
        <span class="k">del</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
        <span class="c1"># create the connectivity matrix</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dimx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">dimx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">formula</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">dimx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dimy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">])</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">node_offset</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimx</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimy</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimz</span><span class="p">):</span>
                    <span class="n">first</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">dimy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dimx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="n">connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
        <span class="c1"># now create the actual nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_nodes</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span>
        <span class="c1"># now create the actual block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_element_block</span><span class="p">(</span>
            <span class="n">element_block_id</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;hex8&quot;</span><span class="p">,</span> <span class="n">dimx</span> <span class="o">*</span> <span class="n">dimy</span> <span class="o">*</span> <span class="n">dimz</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ExodusModel.count_degenerate_elements"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.count_degenerate_elements">[docs]</a>    <span class="k">def</span> <span class="nf">count_degenerate_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of degenerate elements in the given element blocks.</span>

<span class="sd">        A degenerate element is an element which contains one or more nodes</span>
<span class="sd">        which are a duplicate of another node within the same element.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">degenerate_element_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_blocks</span><span class="p">[</span><span class="n">element_block_id</span><span class="p">]</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">//</span> <span class="n">nodes_per_element</span>
            <span class="k">for</span> <span class="n">element_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">local_node</span><span class="p">))</span> <span class="o">!=</span> <span class="n">nodes_per_element</span><span class="p">:</span>
                    <span class="n">degenerate_element_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">degenerate_element_count</span></div>

<div class="viewcode-block" id="ExodusModel.count_disconnected_blocks"><a class="viewcode-back" href="../exomerge.html#exomerge.ExodusModel.count_disconnected_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">count_disconnected_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_block_ids</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of disconnected blocks.</span>

<span class="sd">        A disconnected block is a group of elements which are connected to</span>
<span class="sd">        each other through one or more nodes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_element_block_id_list</span><span class="p">(</span>
            <span class="n">element_block_ids</span><span class="p">,</span> <span class="n">empty_list_okay</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_in_element_block</span><span class="p">(</span><span class="n">element_block_ids</span><span class="p">)</span>
        <span class="c1"># for each node, find the lowest index node that it&#39;s connected to</span>
        <span class="n">master</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">element_block_id</span> <span class="ow">in</span> <span class="n">element_block_ids</span><span class="p">:</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">element_block_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">element_count</span><span class="p">):</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">i</span> <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="c1"># find lowest index master out of these</span>
                <span class="n">low</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">local_node</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_node</span><span class="p">:</span>
                    <span class="n">this_low</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="k">while</span> <span class="n">this_low</span> <span class="o">!=</span> <span class="n">master</span><span class="p">[</span><span class="n">this_low</span><span class="p">]:</span>
                        <span class="n">this_low</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="n">this_low</span><span class="p">]</span>
                    <span class="n">low</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">this_low</span><span class="p">)</span>
                <span class="c1"># now set the current master to the lowest index found</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_node</span><span class="p">:</span>
                    <span class="n">this_low</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="k">while</span> <span class="n">this_low</span> <span class="o">!=</span> <span class="n">master</span><span class="p">[</span><span class="n">this_low</span><span class="p">]:</span>
                        <span class="n">this_low</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="n">this_low</span><span class="p">]</span>
                        <span class="n">master</span><span class="p">[</span><span class="n">this_low</span><span class="p">]</span> <span class="o">=</span> <span class="n">low</span>
                    <span class="n">master</span><span class="p">[</span><span class="n">this_low</span><span class="p">]</span> <span class="o">=</span> <span class="n">low</span>
        <span class="c1"># now make sure master node list is one-deep</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="c1"># double check that master node list is one-deep</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">master</span><span class="p">[</span><span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="c1"># count the number of master nodes</span>
        <span class="n">block_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="n">master</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">block_count</span></div>

    <span class="k">def</span> <span class="nf">_get_mating_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_set_members_one</span><span class="p">,</span> <span class="n">side_set_members_two</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mating faces between the side sets.</span>

<span class="sd">        This will only return the faces within &#39;side_set_members_one&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># order by element block</span>
        <span class="n">members_one_by_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_element_faces_by_block</span><span class="p">(</span><span class="n">side_set_members_one</span><span class="p">)</span>
        <span class="n">members_two_by_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_element_faces_by_block</span><span class="p">(</span><span class="n">side_set_members_two</span><span class="p">)</span>
        <span class="c1"># find the nodes within set two and create a set of them</span>
        <span class="n">faces_to_match</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">members</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">members_two_by_block</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="n">face_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">faces_to_match</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">face_nodes</span><span class="p">)))</span>
        <span class="c1"># now look through the original list for duplicates</span>
        <span class="n">mating_faces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">members</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">members_one_by_block</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">nodes_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_per_element</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="n">local_node</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span>
                    <span class="n">element_index</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span><span class="p">:</span> <span class="p">(</span><span class="n">element_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">nodes_per_element</span>
                <span class="p">]</span>
                <span class="n">face_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">local_node</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_mapping</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">face_nodes</span><span class="p">))</span> <span class="ow">in</span> <span class="n">faces_to_match</span><span class="p">:</span>
                    <span class="n">mating_faces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">id_</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">face_index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mating_faces</span>
        <span class="c1"># now create a sorted list with (nodes, member)</span>
        <span class="c1"># now find duplicate entries</span>

    <span class="k">def</span> <span class="nf">_detailed_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a detailed summary of the model.&quot;&quot;&quot;</span>
        <span class="c1"># if no timesteps are defined, create one so we can store field values</span>
        <span class="c1"># it will be deleted at the nd</span>
        <span class="n">timestep_created</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
            <span class="n">timestep_created</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># print out general info</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">MODEL SUMMARY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">()</span>
        <span class="n">element_block_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;- Model contains </span><span class="si">%d</span><span class="s2"> element blocks and </span><span class="si">%d</span><span class="s2"> elements&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">element_block_count</span><span class="p">,</span> <span class="n">element_count</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># if any elements exist...</span>
        <span class="k">if</span> <span class="n">element_count</span><span class="p">:</span>
            <span class="c1"># calculate element volume field</span>
            <span class="n">element_volume_field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_field_name</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_element_volumes</span><span class="p">(</span><span class="n">element_volume_field_name</span><span class="p">)</span>
            <span class="c1"># calculate element centroid field</span>
            <span class="n">element_centroid_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_element_field_name</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_element_centroids</span><span class="p">(</span><span class="n">element_centroid_field_names</span><span class="p">)</span>
        <span class="c1"># print out element block info</span>
        <span class="k">if</span> <span class="n">element_count</span><span class="p">:</span>
            <span class="n">extents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_extents</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Extents are:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;  - </span><span class="si">%s</span><span class="s2">: </span><span class="si">%g</span><span class="s2"> to </span><span class="si">%g</span><span class="s2">, range of </span><span class="si">%g</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="s2">&quot;XYZ&quot;</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                            <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="c1"># print center of mass</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_centroid</span><span class="p">(</span>
                <span class="n">ids</span><span class="p">,</span> <span class="n">element_volume_field_name</span><span class="p">,</span> <span class="n">element_centroid_field_names</span>
            <span class="p">)</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cg</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Center of volume is at [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cg</span><span class="p">))))</span>
            <span class="c1"># print total volume</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_volume</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">element_volume_field_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Total volume is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">volume</span><span class="p">))</span>
            <span class="c1"># print total surface area</span>
            <span class="n">side_set_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_side_set_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_external_element_faces</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
            <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_area</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Total surface area is </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">area</span><span class="p">))</span>
            <span class="c1"># print number of disconnected blocks</span>
            <span class="n">connected_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_disconnected_blocks</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Contains </span><span class="si">%d</span><span class="s2"> disconnected blocks&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">connected_blocks</span><span class="p">)))</span>
            <span class="c1"># print element edge length stats</span>
            <span class="n">minimum</span><span class="p">,</span> <span class="n">average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_edge_length_info</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Average element edge length is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">average</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Smallest element edge length is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">minimum</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">node_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_closest_node_distance</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- The closest node pair is </span><span class="si">%g</span><span class="s2"> apart&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node_distance</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ELEMENT BLOCK INFO&quot;</span><span class="p">)</span>
        <span class="c1"># find external faces for each element block</span>
        <span class="k">if</span> <span class="n">element_count</span><span class="p">:</span>
            <span class="n">external_faces</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_external_element_faces</span><span class="p">(</span><span class="n">id_</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="c1"># print info on each element block</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_name</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Element block ID </span><span class="si">%d%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39; &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_dimension</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_count</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">dim_name</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">%d</span><span class="s2">-dimensional&quot;</span> <span class="o">%</span> <span class="n">dim</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s1">&#39;- Contains </span><span class="si">%d</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1"> elements&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">element_count</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># if no elements, skip detailed info on this block</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">element_count</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">extents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_extents</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Extents are:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;  - </span><span class="si">%s</span><span class="s2">: </span><span class="si">%g</span><span class="s2"> to </span><span class="si">%g</span><span class="s2">, range of </span><span class="si">%g</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="s2">&quot;XYZ&quot;</span><span class="p">[</span><span class="n">d</span><span class="p">],</span>
                            <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">extents</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="c1"># print center of mass</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_centroid</span><span class="p">(</span>
                <span class="n">id_</span><span class="p">,</span> <span class="n">element_volume_field_name</span><span class="p">,</span> <span class="n">element_centroid_field_names</span>
            <span class="p">)</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cg</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Center of volume is at [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cg</span><span class="p">))))</span>
            <span class="c1"># print total volume</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_volume</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="n">element_volume_field_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Total volume is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">volume</span><span class="p">)))</span>
            <span class="c1"># print total surface area</span>
            <span class="n">side_set_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_side_set_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">external_faces</span><span class="p">[</span><span class="n">id_</span><span class="p">])</span>
            <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_area</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Total surface area is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="p">)))</span>
            <span class="c1"># print number of disconnected blocks</span>
            <span class="n">connected_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_disconnected_blocks</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Contains </span><span class="si">%d</span><span class="s2"> disconnected blocks&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">connected_blocks</span><span class="p">)))</span>
            <span class="c1"># print element edge length stats</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">minimum</span><span class="p">,</span> <span class="n">average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_edge_length_info</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Average element edge length is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">average</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Smallest element edge length is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">minimum</span><span class="p">)))</span>
                <span class="c1"># print thickness</span>
                <span class="n">thickness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_thickness_from_volume_and_area</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Approximate thickness is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">thickness</span><span class="p">)))</span>
            <span class="c1"># print surface connectivity to other blocks</span>
            <span class="c1"># find faces connected to other blocks</span>
            <span class="n">remaining_faces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">external_faces</span><span class="p">[</span><span class="n">id_</span><span class="p">])</span>
            <span class="n">header_output</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">other_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_block_ids</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">other_id</span> <span class="o">==</span> <span class="n">id_</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">mating_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mating_faces</span><span class="p">(</span>
                    <span class="n">external_faces</span><span class="p">[</span><span class="n">id_</span><span class="p">],</span> <span class="n">external_faces</span><span class="p">[</span><span class="n">other_id</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">mating_faces</span><span class="p">:</span>
                    <span class="n">remaining_faces</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">mating_faces</span><span class="p">)</span>
                    <span class="n">side_set_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_side_set_id</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">mating_faces</span><span class="p">))</span>
                    <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_area</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">header_output</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Connected to the following element blocks:&quot;</span><span class="p">)</span>
                        <span class="n">header_output</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="s2">&quot;  - To element block </span><span class="si">%d</span><span class="s2"> though </span><span class="si">%d</span><span class="s2"> faces &quot;</span>
                            <span class="s2">&quot;(area of </span><span class="si">%g</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other_id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mating_faces</span><span class="p">),</span> <span class="n">area</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">header_output</span> <span class="ow">and</span> <span class="n">remaining_faces</span><span class="p">:</span>
                <span class="n">remaining_faces</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">remaining_faces</span><span class="p">)</span>
                <span class="n">side_set_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_side_set_id</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">,</span> <span class="n">remaining_faces</span><span class="p">)</span>
                <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_area</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_side_set</span><span class="p">(</span><span class="n">side_set_id</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;  - To the outside through </span><span class="si">%d</span><span class="s2"> faces &quot;</span>
                        <span class="s2">&quot;(area of </span><span class="si">%g</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_faces</span><span class="p">),</span> <span class="n">area</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">header_output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Not connected to any element blocks&quot;</span><span class="p">)</span>
        <span class="c1"># print node set info</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">NODE SET INFO</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> node sets defined.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">))))</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_name</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;Node set ID </span><span class="si">%d%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39; &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Contains </span><span class="si">%d</span><span class="s2"> members&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)))))</span>
            <span class="n">field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_field_names</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_names</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Has </span><span class="si">%d</span><span class="s2"> fields defined:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">field_names</span><span class="p">))))</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;  - &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)))</span>
        <span class="c1"># print node set info</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SIDE SET INFO</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> side sets defined.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">))))</span>
        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_name</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;Side set ID </span><span class="si">%d%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39; &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span>
            <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_members</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Contains </span><span class="si">%d</span><span class="s2"> members&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">member_count</span><span class="p">)))</span>
            <span class="n">parent_blocks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">members</span><span class="p">))</span>
            <span class="n">parent_string</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent_blocks</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Parent element block IDs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parent_string</span><span class="p">)))</span>
            <span class="n">face_types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">members_by_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_element_faces_by_block</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">these_members</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">members_by_block</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_element_type</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_standard_element_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">):</span>
                    <span class="n">face_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">face_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_mapping_from_id</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
                <span class="n">face_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">these_members</span><span class="p">)</span>
                <span class="n">face_types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">face_mapping</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_indices</span><span class="p">)</span>
            <span class="n">face_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">face_types</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Face types: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">face_types</span><span class="p">))))</span>
            <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_area</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Total area of </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="p">)))</span>
            <span class="n">field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_field_names</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_names</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;- Has </span><span class="si">%d</span><span class="s2"> fields defined:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">field_names</span><span class="p">))))</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;  - &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)))</span>
        <span class="c1"># delete temporary timestep if created</span>
        <span class="k">if</span> <span class="n">timestep_created</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_timestep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1999-2023 National Technology &amp; Engineering Solutions.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>